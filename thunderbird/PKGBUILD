# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
pkgbase="app-${_realname}"
pkgname=("app-x86_64-${_realname}")
epoch=1
pkgver=68.8.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="https://www.thunderbird.net/"
arch=('any')
license=('GPL' 'MPL')
replaces=("app-i686-${_realname}")
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ar.xpi"
        "ast.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ast.xpi"
        "be.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/be.xpi"
        "bg.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/bg.xpi"
        "br.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/br.xpi"
        "ca.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ca.xpi"
        "cak.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cak.xpi"
        "cs.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cs.xpi"
        "cy.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cy.xpi"
        "da.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/da.xpi"
        "de.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/de.xpi"
        "dsb.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/dsb.xpi"
        "el.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/el.xpi"
        "en-GB.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/en-GB.xpi"
        "en-US.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/en-US.xpi"
        "es-AR.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/es-AR.xpi"
        "es-ES.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/es-ES.xpi"
        "et.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/et.xpi"
        "eu.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/eu.xpi"
        "fi.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fi.xpi"
        "fr.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fr.xpi"
        "fy-NL.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fy-NL.xpi"
        "ga-IE.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ga-IE.xpi"
        "gd.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/gd.xpi"
        "gl.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/gl.xpi"
        "he.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/he.xpi"
        "hr.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hr.xpi"
        "hsb.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hsb.xpi"
        "hu.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hu.xpi"
        "hy-AM.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hy-AM.xpi"
        "id.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/id.xpi"
        "is.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/is.xpi"
        "it.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/it.xpi"
        "ja.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ja.xpi"
        "ka.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ka.xpi"
        "kab.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/kab.xpi"
        "kk.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/kk.xpi"
        "ko.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ko.xpi"
        "lt.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/lt.xpi"
        "ms.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ms.xpi"
        "nb-NO.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nb-NO.xpi"
        "nl.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nl.xpi"
        "nn-NO.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nn-NO.xpi"
        "pl.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pl.xpi"
        "pt-BR.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pt-BR.xpi"
        "pt-PT.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pt-PT.xpi"
        "rm.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/rm.xpi"
        "ro.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ro.xpi"
        "ru.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ru.xpi"
        "si.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/si.xpi"
        "sk.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sk.xpi"
        "sl.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sl.xpi"
        "sq.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sq.xpi"
        "sr.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sr.xpi"
        "sv-SE.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sv-SE.xpi"
        "tr.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/tr.xpi"
        "uk.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/uk.xpi"
        "uz.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/uz.xpi"
        "vi.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/vi.xpi"
        "zh-CN.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/zh-CN.xpi"
        "zh-TW.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/zh-TW.xpi")
sha512sums=('37ad2f957cf5d167f8e046ef76ed6cc490aeb153367a232ecc4e4106acc7e613f17bcf650f1da5110fab3f0ecbb7db3a5b52b620758e942142d4bf84770c664a'
            'ef102a92a00072b7a8f3dfde2f8421234af93506a48e069e03f851d4f961bf2c84a34cdfbc4e29e47048c4e80d6d338895494ccbd59be49c5b416e25bb9cc1d7'
            'e64a412efb0f7f6012a9e90be2cdf19eb93f0f23dc003371e9632037f32d0f1687475b3849b691a28734bd3111ceb807a2ffd8253e84ecfff62fc69d9a754e8d'
            '81f41bf69b190f362564f203aed73b5e8fff791d29a3a50660d8ffae52ab6f4e651cb7da24c2a1e71ef0d507547f93ffa7e4510b8adeb4bf76cacbbcba2faa1f'
            '6590e8a8f4a20b34f370eaf6489a13d2b096aba06b6a52a53b145630d37295fa06aced9a7b38ee1bc7612db27801503e851c3d669e3c40158ba0126f1e7c5cd9'
            '85df41b2dc5b8dd5aa5e4afc951962f88e28b47997a2b95d1e4b8a7d2b1588ebaf7b5522075efcad0437f71bc9fc8ad9c4a6584029bba5a0c32cde97a9800018'
            '1ff68acca0ed67eb84af632f3263f660ff3207a5d8ef578ab81d2e6a07fc145719708b621a4bb594d5f3e2b61868ee5ba80f945d39112f30b98d12155a265dfe'
            '4e9e513b48952f8c5a0d864de79d5abd821ec3261b10b6db917f45b52375cb993295254ddd36440117ec393f6158880d7ff815151587eb0e372f7dda58e728e3'
            'd8ae895ba79e23cbe87e6a60df68fba21a7d807be05efecffc0d877ec362419aee30ad31edaf0b3336823cdc5fe9f1e71507be7bf9916ef6fec0bc81648d9a59'
            'aa0d8a1bc245e028657684aed5c05b84ccd908e20748373fd71688859cdd7f8b9be066ea2db9d364f301781b6017c1dee597223dee63b505be1845cc89a7faa3'
            '52c53b707437fac2e00864968189502e1d2e0d2a90aa83074ab149637c4119f7720a417491c546b3ed8fcece81983361e92e289129d32c7e6067a96b3085d7eb'
            '6610d813b89e6c71c1594ad8bf9bbbad710faf20c4b0cc1edda687d93e808366ad420bb81de00332aa2aa3b5e2f9cadd8fd1dfa60ee6c29e7f630be0bde89859'
            '8c35c1c926ff56bbd9a48ba156b75d959b9b5d4746af91db4fe0170f501aa101ec98c1d9d5977ab9c89884a1fd8924438f1d7e41cca593592787376d4408eb43'
            'e71fcabb022e8db9f20982d6e9e631a1abd109a8a438ceaf0c16f9c918c21f8afddd366984e119a7b4b78ab58f5797c9ebfb96f50eff38b2f17b62a4a28d8d05'
            '3eb86972fab8f8f6a757f4f6e4c686d463e522011a9b1461d6cfbc278b3dccf2debf9489daf870c68bb019bd71955d96825fd1a519ba79e1f810ebc2f103ccb0'
            'bb9358db29355800b5781a681fd20ccced3b45332a3553a7f5928e750cb29c9d20982c6329f402f5a7a2dc08a9c419143eb545c8bfc8e3b3da1be34d8d16cfe9'
            '0195ff153d471a145e4b3e6c1be3de18c47a2e09c2cad8d82d44a809686290cf276834d253b479137bdd67c9f8fca9fc1d139f2971b13711a0e05c2195d7f212'
            '3191f40b45d7c52fa6aefcb1a6b9cb8e1f13f31006c6fc72be284c279623b1b9cfe449c0c2872a6d3c910c77808e11481cd6308001f737a9264247a242e21a57'
            '83fa31fe0205f4e05dc87fd3031624a51e994f4dff745a154e2dc024c4f27fa474fffe7b56503703c053c63256a7f558bbe82e979377f1ac6fca9b22dab62cff'
            '1ba28bb061c84dcad932cd9193eb37176e034a33cc43fb128081f1d9f2aedb197489b9d6f781b14232a71b57054291f9a572607535309b169a9bebd12d298eb2'
            'b53bbfa1123d2a290b688488f9ea93cdd6c41d89d75ba154cdbabb40a2a3d2fa3249e59227de391228bc777a3083231406c4898ba9cc04f14d87ed9e056ca559'
            '2a096d985025ed147f8ba32616012d8afb14c91043c84d45db99326be35a78890610d8919e1cc99b2231d0e0b78fa2ae933130bb6e62ccb0c0158cddacd6064a'
            '499f1aa3fb1012b8518112333c0823df234e41001ff48e5b9e0ad930d4367d3746cc51f6f73106a81ff48ae32116d3502245142987e2298b13b3c3381c9e9af0'
            '0969fe3a48f4b2917bdcced0489efb23fd4d9f982d33390490cfa02a23442037a8afcfe11fd5af5782c645307aebb2ebf0827aae13765b515028913a8139483e'
            '3cba3c458dbd4eca550fdd70d04386f29318f302c01fa66da800466cf67ee1f4719c2acae0bf7d3700276742aa3c854b2980e728f95bf79e9ba3e10857bcb557'
            '9785a5d2c8b32c81475e216fee691bdd5fa3ac1ddce38719a16b5fbd0801fe8e02beb3d5dad3d4fb81189487c34c36d06036295bfa8012c0afdffd029a75d7c2'
            '0a165f9feb97f74d58247f1cbfe9c897b0bfeba0d09e4d75d4f6697f5faeb5f5781623b61c7d6ac761ee48027fac34dede52e79923bb061b5250a2508b7e9a96'
            '92a625d64cf7abe4d4f0335632a9de11c9ecd8efcf6c2397d9b5b541b4ba742e366f54c3a880ce356ff4cca110f6c29012a2f3418c7312dd83e171cea243d554'
            '7b303dd4b3149ffb428df4c49aff566fa1641756c1bbf4c15fab3f7272724e2c6117c4d6abc818106c9c9fff0a926c3dcec07fb3c67fd60e1d787aa38c249a59'
            '3dcaaf9835b398a647eab708715145e010828b681974614528aeeaaf80358ef2585bc7b7758d12868f807d26ac3313e4966b2170ae5d3f6767c017c2d338bc51'
            'd50bca92ba798ea7388668d167475497853645b2c1af7cfdd422fc2918ef8facac5edf73dd9e69cd81e755826ca538e107364f6be424372e9bf03d524c29a8ee'
            '09b7eb622c4b10e3cdb0914922fb574f2821aa57adc6d46d44485ab399b912717722335b2c56d9204d3ced24fbed4e826a94789792f5589c361c457ba5ec0db2'
            'd986b502f0c5379a0ba8effb25bbf2cb8be44823971d9faba62ea89540f1269c0227287578107c4803e703a29228394698831bea6393bbeada3659e9b5d6017f'
            '331d2035ad0436a30c817f3d851ebda3537cf45d749421c7aeda209eb458ee386d4ec990207a353bdd3b13f921bafdbbdb699bf193d62b2e5a5dffcd30e5e5ec'
            'e8eba59d48bb036ec959b4fe1a363d99000b428917535ea086e053547372cf30b2ffb9d501ce2c17894095fe736dbdf91b72734f9ae3283972c6eed88b22de3e'
            '4528eed03fd1678edc47fd368077d8ea4710f1cf288e537d16d7873f53af5b84835647a5b5c3c521e5a223c41237bc1f921dc740bf80e754f86c38092ee22ec4'
            'b7144525dd2f66e0100c046eeeef1a2e7c3502ccbd3e2299c4eea3a204458302f9cd57602a26a76a5ca668ae452067217155697f9facb90790659ee07d7475f2'
            'c60fb7acbe241466a31627861ad7df20dd65a133c456c059176b163282763b237e7af7c7a79abeb59c297a9c4e44211bc0f14656689b2bbb33bb8c8ee75c7c72'
            '235410013f24b5e8bca7fe3c778b08b235468da1f26591e700c17a01d82fb2cee660ffc09fb5f628f4529d1c66d8f1f51c20fd4137d51ae63d3980c8e7c19789'
            '78d7d6fac174196c1d849cc947f17d89b058666d78ce376e2e1115ec76cf38ce280d84e52a89290c380910b6cbf2e00eb77d3093a30d195bf0d514b18b14f277'
            'd82fbf2a3dd715168ed03fdf2ad7b1c6420bcd5ef3d81864548a2713880eaa557aed71b8392a85ebf3fccec4e5039ac3f879a42b6ce2c81b9268c5c9bdbd311c'
            '15bb4f4d3ad35b7fdf44562921fe72b98c34c614cd909024e1c81c34b0460c1f8d620878837c04fdd94279849d2d8dd2b188ea9653a8dee8d1cbb8303a127f9b'
            'd4beb45a0a655ff5b9e190934baa58e888c9af86240c2ca6fec765ec618cf6074d8339c82f99520d0d1f0da2912c36e37b35ba65015e4e272940f9855c57ba68'
            '697aaab99bf9ce3c96701172b3080db7adf9d5879a67d8c38b9d82ed2a2451b6d3108c46bcbc10c2ff7355ec571a9fcf654bfc49362b74d9eb188658d48dd3a9'
            '91d977bec0cf733d6fe63ca7723f66516f856e6caa2c54446c3dc84d925ba4cf71b3656dcdedb87c521ae5b8d5d76317fc5858cc53d492d0fc6ad00cceb6d17b'
            '9e2b91f4416ce96b4c9980085b6834b4e3046ddd6bea3248b62e0dd927b64880ac99d7bdabba73f18471833eb66680e34e0d69c9934d7837909e3ace0a42a1f5'
            '9062344a0ccacc96faa654ad8393f91ac7a504f656ecbe3267ee53bda373e3808a46e7f1914911369628dc97f7a35c0ba744e2e32361e2205c8e0bd8ea67cc3d'
            '1fb229618dab4e1f40ab5ed2ef6f8d84cf9da98f9a896a3f88b019e8122c1412b2e9ffa2253ed71a3c9cc7715bfa5cc8e680dfef0d537f552c8a371caba3e84a'
            'd45dbb3a71d5062854257e1171ddb41def020f09ae40848d34ff66f9348030ccceb1fbf98dd643534bc75bb18cff3905d1620a9dc47bca7578300047c16b30b8'
            '4105a0f9451b3695a9cb6f81b9444b55c8fb0449553c974a9d47bdfdf5b8c38a7bca2e8b1651c461569e3b82a08a92c6cccde34511e9aa4f728a43e3577c8b12'
            '3dc6b40cc9d081f4b956554c89f17bc1c999b3864730d868c872f076ae6357add58422902c7e02f84efc7bbbd24762b057102d620f71bd9fc3055777c2ab8653'
            '5ff09dd0a1108023ddd28d9311478e9581d890e0837a05d19517775b18afb6f0e2d781471faab1e15aeaf23a9f3bbfa4b2debae15d066a9d4e7ddfd5a0adf520'
            'af4f557794db9208d423a2380a29a41a7b5e26a90598574dfc7da7993c067d567dc571d8f87b62ccaf3a19e09b4a3f1818406ee9801fb71ef67eed57e8011e2e'
            '0dbf88a55d5b6b84008469c21a5623b6f5237354c58e7bbb0c6cd73420656205e10cc3065d688119c8559870c4f36903f95ab22fb1fc31caa4c664ffa811b425'
            '92e1607b76a8fa6b8c1c4ae2973610c416ee7581bb3de556436f41a80f209b9d67732377343392f536a08bc988d9b0c86628c735a39698070e03de5f3282f4c0'
            'e094e737c4acba93b4a29baca9442cb14d4106b78935e6cad63631253a164812dcb7155c91a17fb3229b7d1c8cb1f0d05c6e69750e6b1a485d8ef16a8001e34f'
            '8f0dc18917e757327d0b52af744f51ee2358139c8f2a0db58a08bea6c99a6e7a941803f457561f81e2a98f1ce456a46cf23aa2fe477b88c79aadd2898cadc3a8'
            'd2361959001995d92196e63827eefc82d0f889a9182a083fe64f172efda38bb0628b824b20b7090af3730f0c7a623c54b12edba7c1b1a7f1759c13b33e65dabd'
            'fcf020b762531a8367e4561e20c577b469831091a7e1eebc5a53a8821a2c35e47fc476e119566d2080dd1c8f0977829ab54c49cfe3713dd4ce56517e2d64a041'
            'd29f9600072ff373ec06c8a2e4936010107f9cde0f0c7f1b7d51ddf3fa85727915eb073151a0454586f2391b92b31750c007885c1fc1294d14155bb76cf8b4a1'
            '1f2354fb0d01e0727dbbff76e397848b014457529c1a310c6cec498817f635c626e918e80c03a8100483e9b444bc3b5009ce6bc5a60c47a2379a79b6714c32a6'
            '13b46e44fddd7b6cca2054927b928e5ef6fa493af9355a178d4764bbe1037bdc6d970f03cfb7f181ac6cb61d180b9e5ad839fe899dd46245a3deb71db607fc98')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

_rmmsdll() {
    local ms

    ms=("msvbvm[0-9]+"
        "ucrtbase"
        "mfcm?[0-9]+[a-z]+"
        "msvc[rp][0-9]+(_([0-9]|codecvt_ids))?"
        "vc([ao]mp|corlib|runtime)[0-9]+(_[0-9])?"
        "concrt[0-9]+"
        "pgort[0-9]+"
        "api-ms-win-[0-9a-z-]+")
    find "${1}" -iname '*.dll' | grep -Eif <(for m in "${ms[@]}"; do echo "/${m}[.]dll$"; done) | xargs -r rm
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe" -o"ThunderbirdSetup.dir" > /dev/null
}

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "ThunderbirdSetup.dir/core"/* "${a}"
    rm "${a}"/maintenanceservice{,_installer}.exe

    # remove system DLLs
    _rmmsdll "${a}"
    sed -r -e '/(VCRUNTIME|MSVCP)140.dll/d' -e '/api-ms-win-[0-9a-z-]+.dll/d' -i "${a}/dependentlibs.list"

    mkdir "${a}/extensions"
    local f
    for f in *.xpi
    do
        cp "${f}" "${a}/extensions/langpack-${f%%.xpi}@thunderbird.mozilla.org.xpi"
    done

    _lc "${a}"/*
}
