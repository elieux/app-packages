# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=wincheater-libraries
_dirname=wincheater
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=2016.03.04
pkgrel=1
pkgdesc="Video game cheats and guides databases for WinCheater"
url="http://www.cheater.cz/winch/win_download_knihovny.htm"
arch=('any')
license=('custom')
makedepends=("unrar")
depends=("app-i686-wincheater")
provides=("${pkgbase}")
options=(!strip)
source=("Cheaty.exe::http://www.cheater.cz/download/Cheaty.exe"
        "Navody.exe::http://www.cheater.cz/download/Navody.exe"
        "Easter_Eggy.exe::http://www.cheater.cz/download/Easter_Eggy.exe"
        "Vtipy.exe::http://www.cheater.cz/download/Vtipy.exe"
        "Navody_Plus.exe::http://www.cheater.cz/download/Navody_Plus.exe"
        "Playstation.exe::http://www.cheater.cz/download/Playstation.exe"
        "Povidky.exe::http://www.cheater.cz/download/Povidky.exe"
        "Recenze.exe::http://www.cheater.cz/download/Recenze.exe"
        "SongBook.exe::http://www.cheater.cz/download/SongBook.exe"
        "Vtipne_obrazky.exe::http://www.cheater.cz/download/Vtipne_obrazky.exe"
        "filmy.exe::http://www.cheater.cz/download/filmy.exe"
        "Xbox.exe::http://www.cheater.cz/download/Xbox.exe"
        "GC_a_Nin64.exe::http://www.cheater.cz/download/GC_a_Nin64.exe"
        "GBA_a_GBC.exe::http://www.cheater.cz/download/GBA_a_GBC.exe"
        "HTML.exe::http://www.cheater.cz/download/HTML.exe"
        "Internetove_odkazy.exe::http://www.cheater.cz/download/Internetove_odkazy.exe"
        "mininavody.exe::http://www.cheater.cz/download/mininavody.exe"
        "Mobile_Eggy.exe::http://www.cheater.cz/download/Mobile_Eggy.exe"
        "citaty.exe::http://www.cheater.cz/download/citaty.exe"
        "Mobile_Melodies.exe::http://www.cheater.cz/download/Mobile_Melodies.exe"
        "cestiny.exe::http://www.cheater.cz/download/cestiny.exe"
        "internet.exe::http://www.cheater.cz/download/internet.exe"
        "Scofake.exe::http://www.cheater.cz/download/Scofake.exe"
        "ScoSoft.exe::http://www.cheater.cz/download/ScoSoft.exe")
sha512sums=('305074853bb0f5dc7ac599d2c7c1e2e3ed4170dc86b5b982e204be07879b99c28726cf1894f12aa260f4a6a54e06452cf6624d6a94ab867d4770580554872c3a'
            '654797860083c9e4943df152170a5250ba5a009c892b5e8f3a08b87d4728b15780a24feb15bd7c550ea500788c9f858e8322e7d02dadac2ac92272bcfaefdb82'
            '19d6947f2a28c60403b28c5b4afd5fb2800c3db3761b0b5d487db412f57b14a32a51ab9fa96833cb6d55fe798c9650ee24dfdcf0642e4f1699d8fd3c6432f649'
            'd94950e070deeaefc52555b37aba80d0ecce197cdf82106ca6a9e2480a2ceb0146c9072bfdbd67ec9cfa00fc423e20029945e6d1d89522757c34ac39f347c481'
            'cc621d2b472004f2b1e4cbeadcc059e5f66592d7934d640f5263d0bb31f6d3cfe4110895a24413562fffdcc4dffe96a7675a032dc7fd1d355a63d0dc55779696'
            'f3548fd73761c28c109a25d259cf0b71fb763e6502a0da4ea58e89a818145a3ab21f27acba6aa9df498ae763b59407a31bf3ed41d4c1641ae695fcc079089a46'
            '8e87f4ddb99abccb0ce1a6e205f7b98e098fd9bb025af311bbaeef8273b4ab72c4163b2071248ff188f275f2212e208657f62badb5b1dc09cc422d51f18fde34'
            'a254e81a2b2d0c0d71974aef5dc32b1bbbc48ab8a1de4fe60bca6a5a00cb0a2ad0e32994d4ed92a27bdfb1d6eb53c57348b9fe31cc4a752d77aa39b2671b1434'
            '019c68c1864cc0b21ea99b2a7f32422566334e072a9895ca2225c152b40fca35165ee5d958e6c6af828ad03856e80b1e56905656b8685fe04239831b3f4f2939'
            '2280d1d33faf18965e98f470561f98f9212093e618b223609905d4b2cf0ec0bade5c24ae68468402c35a4f35c7fb83c732d8db6ef386d603804e3bed6cc655ab'
            '41635b5e6312fc71979d5650b576e986d6d7fb81475386017aaf37347329c01770b35f17e6cf4b586ee18b7715ad33b1c41ad733670fc9728dd318b48a0c68be'
            'e43b4883183531b39668d95aa285c04fea63da3d33fcfd3d24d53012fbbdf4bb3cccc3f28973b15156bb13cd19ac3f989f04ca9f9e4b13cfc3ffe2f6b4e0fc8a'
            '658e359467c7f842ae00f3f21657b34995fb56742655b55f2eea0bbf471b0ba4d20a499d8665c25b29fcc65d1859b75e3ef1b27bdafb46b9ea8d604495e2d97b'
            '32a404dfdbbaeb78b25671e2da91697dbfacfdd1880640a9141d736cc97911efc9840e4d4a1a3ca4380a9946bd635e258dcb5ecfe8a12b2cdda20d7116ee65a5'
            '414475f236a813656ee0427914d71f61c397c446c703bebe00767781cf0423795349dc498847cac968563484cc2ad6ac9512a38baaf805010b2a4c79b8f87f5d'
            '186f626782bd6c6b62133edaf2127060c7e58468b080beedf10c89a664f9e8cd8ab2d8466e90fca7edaf086e9be44e25af10970a7e2e08b00cdc994e4bb41cae'
            '9652822ad43159366fdae1ea5468ecce70210cec81af726ae2d7ef8862829d2582ea05d565fa70a38439b23d7f3b7df3656f3964e6b30ff7ddb410b04c4a0df2'
            'c658b58f3635abb213a79905e14e0cc0dbc6096b31c21896294587cf47cc6ac194626479308ec9f5129eff1a8923e4d5b7feeab27157ff95bc4e863b11d9f8b2'
            '2d7cf93a638caf642291bf98e5e222013dcb7c1111029f3659613f2cc5bf7407a5670dbb8c495ad7eee32513a512bb26464f41d7491cddd91a3c91a820231db3'
            '92640f8b06ac4b886da03c106ea6467552949b442993a348d8c5f65f7cc9ba0fe2f78e8a71822e5af181af476341d50cbfbf574f0e5d820822c1978c6fe89ba4'
            'b41cb59c549f3bb7fd86bda936efa1dd1fbe03b4d61fa9d43696f8f8ec10faa0dd721f6c7e4c8f1c9fad257b81fee866b9425a1d5320c0b96e8dca96aa04aacb'
            'bd9998c48b6fe0a986361a18468d47be46c02cd0b2cf30b06bd593977b21dbf362615dadf631238fa7df537efa1eb6bcf328533e842ecbfede6a658fe0d12aea'
            '12a62fe08bec67e4b8e8ace8148c8bda35a94b5f4ddcd07617aa61dfb12f51c8266b40aaa3159aaabaf17930140d29d8e7f1813e56bf2a9330f0d0acac6b7969'
            'c592533196510f36a7170e6f93e353f8c1cf3b7fa44df97a9a7fb1f69276ffa6eca06801add5b78ce39447bb0ef8a4dba9705d001c5b3aa9759917522151aa3c')
noextract=("${source[@]%%::*}") # "Parsing filters is unsupported"

pkgver() {
    #find . -mindepth 1 -maxdepth 1 -name '*.sc2' -printf '%TY.%Tm.%Td\n' | sort | tail -1
    find . -mindepth 1 -maxdepth 1 -name '*.exe' -execdir bash -c 'unrar l -c- "{}" | sed "/^;/d" | sed "/^$/d" | tail -n +6 | head -n -2 | sed -r "s/[ ]+/\t/g" | cut -f 4 | sed -r "s/^([0-9][0-9])-([0-9][0-9])-([0-9][0-9])$/20\3-\2-\1/" | tr "-" "."' \; | sort | tail -1
}

_lc() {
    for f in "${@}"
    do
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

prepare() {
    for f in *.exe
    do
        unrar x -idq -tsm -o+ "${f}"
    done
    _lc *
    for f in *" "*
    do
        n="$(echo "${f}" | tr ' ' '_')"
        mv "${f}" "${n}"
    done
}

package() {
    a="${pkgdir}/apps${_apparch}/${_dirname}"
    mkdir -p "${a}"
    cp *.sc2 "${a}"
}
