# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
pkgbase="app-${_realname}"
pkgname=("app-x86_64-${_realname}")
epoch=1
pkgver=68.8.1
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="https://www.thunderbird.net/"
arch=('any')
license=('GPL' 'MPL')
replaces=("app-i686-${_realname}")
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ar.xpi"
        "ast.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ast.xpi"
        "be.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/be.xpi"
        "bg.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/bg.xpi"
        "br.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/br.xpi"
        "ca.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ca.xpi"
        "cak.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cak.xpi"
        "cs.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cs.xpi"
        "cy.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cy.xpi"
        "da.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/da.xpi"
        "de.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/de.xpi"
        "dsb.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/dsb.xpi"
        "el.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/el.xpi"
        "en-GB.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/en-GB.xpi"
        "en-US.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/en-US.xpi"
        "es-AR.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/es-AR.xpi"
        "es-ES.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/es-ES.xpi"
        "et.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/et.xpi"
        "eu.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/eu.xpi"
        "fi.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fi.xpi"
        "fr.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fr.xpi"
        "fy-NL.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fy-NL.xpi"
        "ga-IE.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ga-IE.xpi"
        "gd.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/gd.xpi"
        "gl.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/gl.xpi"
        "he.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/he.xpi"
        "hr.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hr.xpi"
        "hsb.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hsb.xpi"
        "hu.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hu.xpi"
        "hy-AM.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hy-AM.xpi"
        "id.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/id.xpi"
        "is.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/is.xpi"
        "it.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/it.xpi"
        "ja.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ja.xpi"
        "ka.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ka.xpi"
        "kab.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/kab.xpi"
        "kk.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/kk.xpi"
        "ko.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ko.xpi"
        "lt.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/lt.xpi"
        "ms.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ms.xpi"
        "nb-NO.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nb-NO.xpi"
        "nl.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nl.xpi"
        "nn-NO.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nn-NO.xpi"
        "pl.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pl.xpi"
        "pt-BR.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pt-BR.xpi"
        "pt-PT.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pt-PT.xpi"
        "rm.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/rm.xpi"
        "ro.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ro.xpi"
        "ru.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ru.xpi"
        "si.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/si.xpi"
        "sk.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sk.xpi"
        "sl.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sl.xpi"
        "sq.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sq.xpi"
        "sr.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sr.xpi"
        "sv-SE.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sv-SE.xpi"
        "tr.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/tr.xpi"
        "uk.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/uk.xpi"
        "uz.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/uz.xpi"
        "vi.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/vi.xpi"
        "zh-CN.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/zh-CN.xpi"
        "zh-TW.xpi::https://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/zh-TW.xpi")
sha512sums=('9b8e1c0b417cf57801dcc335ae865347b3242736cf928cb147ffb0c130a2732341c0862ebea1442edbc1744d848458a77066097071807cd8f8e09bf365b1ed57'
            'c2f298ad6512ba80f1a04c00e5f1f85232ca115f28907c5a2d637e660b1033a509d85f262624a6963734ee3b7237afabb3628828e8d2864bd6448d2399cdee35'
            '5aac06c7a127c00ce4b3c035b4d193ff3fccadbd936d425f7464721d0d081e738bb5c51edc2c2610711e70ccd089dcb7b09aa0cdc9f16f257319920833d3bb7c'
            'ccfe20538865664b2c7acd178618ccd351ff148f696efa81c53f840e78f8cd055e321c610bea5979ac7ac3dbb0fd4d0ae28176b8c1c5101846725ed56fabe909'
            '96d78159d5c02e57eaf0f9a037f2349c12e0f13d40d972974602047f5fdeb8ed9457a631ed02d356bc61a02c9ed8f72815d5d1b3f196bf3113b0ba69141a3e0c'
            '2b3107f4a9691e7e34101854723fccd86f783a5398de4eb3cd1a431a70d998e2ffa18fcedf1884f4436c267a473ebd4d4b0ba757587f70408b7ec28a821e0f55'
            'a72224a9d82478ab0ba0afd7abf11e526585f610440b705a752751aa813a5b83812f3761b6ae91a354b312ed1644dd075ba124c24364f8773ad1488f742369f8'
            '942126f17a12c608ab8c7e8f6497db396320831a999d84d76c39fdad4bf172002a3a63162bbe914900e172c70716bff991139e2b79acd1cdc950b483a7267368'
            'a17f8d45b0aa35475ac52a0985c550b9a4780fa05fad6eef431bc2aeec3aa1a3cf60918bd7b155680ed8f5d32bacbc984010e99f9cef0c9b9bfa831dc0943191'
            '9a39b1606a1db97db8539ef61a89cfe33eb5596e2559fbebb62edb99d083b19ff1983f866fcd1d3ebf63781b8758f94e59afddecc991fc73861834d1b7d07de1'
            '24013c9dc422524a74f783ac56287e399daccd2d0253c2e7583dad2c612829477fc74e9a884218e1ddedd092bf0511c5996fe4cca7ef8c62949ffe66f08703d7'
            'ca73800b2f729d8bd7c037d980b16298039822142b68015628aa35103d5cf26e8250c9c0ebff920851f80147232e0646f3dcf38753014147be3acea8514ed90c'
            'af5d13713d988d682074b1fd3a58dd4f151a1c654cadd1c67145fb8de933a85f3735e13749ce7f198ec4cfb90b032296c2c3baaefcee20aec3e34e6d04ff217f'
            '7a3797286bebbed580332743a3c620e015e7abfb95e5351db7d1ab8d479ef39f07f60933be9042d20884af6144b28c8b55027d0b886bb3c40d329df10b225fe7'
            '4e541726e0f02f29efa3252a98ce9424b4b3c9e583b7d92c172e5b8bc34fb15ad54b17fac7edd5d6389396e1d297df8bda12a1b8facb820991ea7daec3f998b2'
            'f8f91d32894b5684a62da04934a5ca306f9e8a950e7f2cb28ae6e676c284ce80bf9b42885ca33ad4bf56756154c3d24aee04f0d4dec65778e40be40183a1ae9c'
            'f8b23722e5587caa710a95db3b6da3e7cdffbec65b3fd78e8d66d51b6cf5a8ac364bc45e3c4a3fe4704cea6baa4288ccab6b5a85eef7226e1798fd258602dc6a'
            'bcabbe6fd65b716b75b70e4dfebfb49e26cf1012f146d86cd74f6c90253b29f4b98e7e1a59ec7eb8884a541e2c417b0bbf8cfd510e7c5a522aa225da09892df9'
            'a4feaa83e3f9fba44f2d99708ab85d3a48279dd9fb4e515ab381691cb46431404a27411f7ef029d875b1bd2ceb2de0d0c755a6327a87c3aa9e18e3332b1526da'
            '2b843b18cb2d62b5b85ed2144a9fb24621e7f70929f584cc9792d9d947765dbd643d5cf212a5e2e6c0b7e24fe576e02787fdf50731cf81c58e6645b094f01590'
            'a82c49b32aeacecbc3f873367fbf166699b3152b678818aee818e6adc46640f3f8d78f6a87e1a0992094585b67431bc1cbc1f370f9bc5a9d8653c1571719eece'
            '61b4cdafda3240c6f91bef990b6084543c3aa29d07c283fdd2047a214f79842dcc8bf4e1d82a27f6e93b1dcaa7a177203843c1bef60d55f5a97177296dfda17d'
            '2f39be86551e40fbd027eb11f441bd3fc3975efb0ab32d53421696560a2bf650dadf0bf67822b3428605f2ecff0b8adfe8e91efef01a480a7cdb27d0f55f8455'
            'a6b6d796cfeef01a8a3260e809ca9207f7a183d44f3172eaa3dbea3a70b3d5f915abe8f3e507762bed920529761fc33a3e112e308166abe8bcad7a170bbe5b29'
            '96983f623762026981cd93849b42594359887078bcdb744f7c927ac33b39822951269ec7e6b0d6158f8cf20409f328557654bf7d9c44cdd82ac91bb679828e23'
            '91fc01b264ac0d1ccae80ca61f73da5181855894dfd77a360b5d704764239f4d37bc38686e0328c06d8cdef72cecc0f950b24d42006bcfb8ac2e453405e2ec6f'
            '2d226dbb20dc411086c1017484a828578ad376eb12e782e591265850fbe3617f737008150e98f25fd7bd63ea4e096976865d7e59eac9754bb64047955b2b9721'
            'd0d66ae435b80cc33e37cc14b8e93449a7e03695429fdb9ab19e6b59e6492a2e3e6bc5d1c0e40a288d613e6aa158471b5483e21bb7672940e70b752fbcb55afd'
            'e3213cd980ce4cf5c9ce2adf92418366609e06339db7759d2d22081a864029856ce0a759962a652e81e9c30ace62a1120e8f1ebf16268ae3796a7a81783bcb20'
            '5f0fd6f485745312eff63fae22d511f2121456ad1f80593fd30553441f29d9ca7f77074f1a26d2b2667659bb5286daed03cfd45da4fce9b912d150e076b7172d'
            'b780819d73d7304a688d6b68d93cce8f8557c1a4d283bb1c9858c0f275721bb19c7f69b01fcbe032704b1d122c94ba266aea0e88d5368ce6d8002aa77e22db9c'
            'd94315902504a1c04cb3bfedba5dfc5b3509fa99c0df08cec3de9894307bf13c2d8bc1852c645e79f68d1aedf84cb57282b9b4b61095c34d51778ca008b82810'
            'a8d1698da006409cd2da9e4699e80dc84365e93e24271319586df2a02f7f32e0ab4e0d9dc004344d0bb2738ba3c89865831a65322911fa4a84f87f2e15bb9541'
            '9a525d97f8686b4f6360a943e47b437b71a83f228a523194bbb5b88b18574ccff1ce2775ea8951134b813b272e740562d9256b9f74bbfd15018b0930f87bd945'
            '11078cfe0ec218753a9394e116104abd1ef4dc3acc260cc569824a407826eec980138f6aa7cd00ba14a1ebd7a99f6619d0dc2b7f3b28d0d62c0dd1e594e8fb6d'
            'cb65bff8903f5536b83eead60db0182664970e09c39e1e40d2a08d9e810d8f5bd4a34a4d6a17b7e736900205324f6b2869ffad63ec571977182b0e69f2c33fb8'
            '6ebcdd8b3bf9958b14efe374f00602eca06f5724950a4af49fbb228b5744b4091ced6723419e8efa7d7a9cfd75f3e09c5292135373ea9230043e83cb08683315'
            '5f033762fa4adbfb0feef4ac40094b685ba8e90191e8951d8a7b57a482e476ac686ac26acf347013ef0978af1690d01ad963530c628ec271e91a01d22f1c833a'
            '4efb592d3312f1f5d036408947456cad13c983e6709f9289e6e6d6ca4840061ec7e59961e72f96f34e87ef0010e59458fb619edcbd67524db8bd2b9eaf3c3f46'
            '937c7dcb995610d7a2e8c5f8d937565ef6ca0aba4e5896e50f7b5e8c203271fc4d619cf8aaad6f89c96b2e633e04465cdf1ba5d8e1ee77ba8ca3c5714adf0c70'
            'bded9718545d64c41c21c466dbd9bd33a24161f0d95f04e060fd61e9a5b3273f853c4e2535c92ff54d0c85c6ee3322b72d8ef1fdf3716547dfb4045381e07caf'
            '36dfec9298f9e9ede7320a23440306858624111a73dd6b9870037a4cd85dfd96e94a51e7236240c62960b847d4a7e3222d53e9e6112aa35d6f83631633612790'
            'a91dfbf0edfc785a7d88b6c05df39e222ee3d1057e48c801ede5fd19058e6b50a97efe5454b942f86112d676558482da51e59c711f6370243c62b1430bc1ca77'
            '4159b7383158be01cbcbf0d76b1c8bd4ddfcd91daacc69aa8040a4d023b22b9a6bdc7b139d6ca105d1b0a51356f5ee9322b9b66bf7a0e98f87adee2840942b02'
            '52beee89363c489b7fff00ba30e4101208dc1dbcd4aceded767b9b08e1b719e5413ffbd975198e08a3919657291e8cfe0c68cab9440a7b815b9771ac91f5137d'
            '33bc3677eb7fd4ec8781926b3299c5818bad2ee3bf98155be4b22e3c17b8fa4768ac09d33a6b26e0ced1f604e0af2e7da84a1a30fa6b0d1b545ecda528fa2db1'
            '756c4c50c697d1f074e4c5fbbc50c7f3e92a70aff0996fb1c6e27a20e2fb6ed095c5f7ec1ee5b05be7e0f2b787cccc9e3f0ef100294bcb313cef7ea1cd8b1172'
            '377a16d234ca675f1ed49777f86980e0e5f3ba622b3ed2134a8c2aa851dd73f0ea8f8fd9e59bf4dfda91f87c811e7a29340cc167d5a7615146f9c6d7ef90a07a'
            '901df7a52c2c7e55c25257fb425964234745beea669257e46e52755b8ed28000e2631111c4252ba589c8639062d5dff4b396ae8e208a07bc54a8cf5da61a0e25'
            '4f296bb16d094f239ee456ccd5ac7d98c97ae95408abc38d96991d10a2a3eebb9d0377dc95a1eaa899779a5823bf09ac5edadbec2f30c73b1d5dc899ccfd0be9'
            'fbbb4cd52497dd102059c0172905711d80c347ecfd5664d0710a5bbcfa417b26d9fbddde7d8d556827538c92be103ddc6d7f9be6fc0664fb13a62f1fd7e1cace'
            'f55674486d51685f98f563b8749b0aa64f9bd6d18b56acd6c83a1c75e3e6f3845fe0f07e605b949ac6e5652740b4f7bc05f901957c9d31ec6bc8e68f8e7753c8'
            '49d8a3f70e5e768fbd8f5020785bbd6d1302e1fcbf88cd5ce0af0b4959664719704b483c7281c561fe8bddc9c32badd7b3158fb20191cd0972e977293f9959a2'
            '35d79e69ece4fa42e0f22d5a6dd04921337d7df98032c0ce1cb690f413c61d2ae4c08bbf215b02b940b21270861899d832b64372816139b05a21bf5b14233344'
            '3d037b521668aa28d97112ed443c7b51a1777cfd633bcea3811d7170f5ba06cfcfd60f087351392b2fe2237b0a209908b7d5fb05155056ec5b1fac2120d7505b'
            '91c92b39c7eec976ef4426e423b5cb6292d736be9003c2f00bc969cc76915e5b022d34335cc28557085b23c2e2a447813066c658533e247a6f8113a03e9cf01d'
            '50db60ed874248614abcb9de71d31b016178d12623f0c4a9701a6015a611d5800efb21532f82b1c6539d6f8ac8a1b5f5d3fa8de6f5fc3d77d47f8622b5c13c98'
            'b9ffba45df9eae7d634f19c80d62bf81770b35a1526f510b9d82737d00493504d9a25c3db891c3d7552c8e856866c54dfa8c1701bd992dc2d3de28d9af512570'
            '32722957bb0decb4610add864bae731c4213864241872b7661a31eba335e146c9dbf81142a4f141f93f7b1594a3a82f0c82ffab382e46acd2fa6b75d8ef825a8'
            '0c98b551c81d505d2d9ddb00981a4c5c7542dc37d9141d123bd35bfc185b17268496fea3e10a31aaf6da20852e95fc22b022f47c14a4afaa4c9529f7ba8ad6d2'
            'c0bddf6d27d1bb37bea33a7cdbf284db7b59050dc13f84f354c337177cf015c7d6f64ee916aa7ffc7488a10d4348887f93c06f0c4735d06dbedc1163235b9a84'
            '7945fbd86733ca2cc7513d0fa4689e766810effa441204c6c7d801a67546c52c05b02729300632e8321cf6effabc8d949429815d7bd0b27d3d927a00b6b77ec1')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

_rmmsdll() {
    local ms

    ms=("msvbvm[0-9]+"
        "ucrtbase"
        "mfcm?[0-9]+[a-z]+"
        "msvc[rp][0-9]+(_([0-9]|codecvt_ids))?"
        "vc([ao]mp|corlib|runtime)[0-9]+(_[0-9])?"
        "concrt[0-9]+"
        "pgort[0-9]+"
        "api-ms-win-[0-9a-z-]+")
    find "${1}" -iname '*.dll' | grep -Eif <(for m in "${ms[@]}"; do echo "/${m}[.]dll$"; done) | xargs -r rm
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe" -o"ThunderbirdSetup.dir" > /dev/null
}

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "ThunderbirdSetup.dir/core"/* "${a}"
    rm "${a}"/maintenanceservice{,_installer}.exe

    # remove system DLLs
    _rmmsdll "${a}"
    sed -r -e '/(VCRUNTIME|MSVCP)140.dll/d' -e '/api-ms-win-[0-9a-z-]+.dll/d' -i "${a}/dependentlibs.list"

    mkdir "${a}/extensions"
    local f
    for f in *.xpi
    do
        cp "${f}" "${a}/extensions/langpack-${f%%.xpi}@thunderbird.mozilla.org.xpi"
    done

    _lc "${a}"/*
}
