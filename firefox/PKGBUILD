# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=firefox
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=44.0.2
pkgrel=1
pkgdesc="Standalone, easy to customize web browser"
url="http://www.mozilla.org/firefox/"
arch=('any')
license=('GPL' 'LGPL', 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("FirefoxSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Firefox%20Setup%20${pkgver}.exe"
        "ach.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ach.xpi"
        "af.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/af.xpi"
        "an.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/an.xpi"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "as.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/as.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "az.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/az.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "bn-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-IN.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "bs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bs.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "en-ZA.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-ZA.xpi"
        "eo.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eo.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-CL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-CL.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "es-MX.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-MX.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fa.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fa.xpi"
        "ff.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ff.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "gu-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gu-IN.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hi-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hi-IN.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "kk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kk.xpi"
        "km.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/km.xpi"
        "kn.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kn.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lij.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lij.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "lv.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lv.xpi"
        "mai.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mai.xpi"
        "mk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mk.xpi"
        "ml.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ml.xpi"
        "mr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mr.xpi"
        "ms.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ms.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "or.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/or.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "son.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/son.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta.xpi"
        "te.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/te.xpi"
        "th.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/th.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "xh.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/xh.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
md5sums=('d458fc85f7fb9e4cce5780590d8772de'
         '92de121760425b4e0ea5fdad8fe5e4de'
         'ece9602e7a5bd94e01e4df2976c78f4f'
         '2ceb60dd5a74f4a024f4a5206d7e0648'
         '40309d045bb284fae087ad750bd77c97'
         '2733092b7ef5e9b13ec1c6a94897753e'
         '42b50b25926a201b5f2cc5b1a44ea0ea'
         '774b1056732c81f818a9898b55da1747'
         '2fe2861dc7bfbca776f45f377732fc56'
         'c289a7676e7aae63754da34692301384'
         'fa36c94cbd51b6fd572392a7fe617885'
         'e6863658cff38a2a8cfcde5940802885'
         'bcb1a873532ddcbe4d86cee56272b86d'
         'de665c7d43798000675458e2aa0e8a26'
         '4befc29c8fe249764752165feec692a6'
         '5c08b69834fe648414edd727cf32d557'
         '7e88e31a4b8facf59f1fb9eec98502fe'
         'dcea4fa3935b6a568f30e929de477bd4'
         '7b9bdaf8f4b4051b8f5589d3a256f45c'
         'bc1cfee56620ffe5ecae12fa807c1418'
         '09fe44098ccc845f68c3d19e9856f264'
         'cb41f2df7fe84a1bbe93f1c9cb557b81'
         'a10c9ea22c06717c89eb34554f3a06bf'
         '3e84bae5657d06ccc315589ed5b12a19'
         'd4ac06689659372b75771c7ca9fe81a3'
         'd1e55e7e6137242e41d4f94099ea869c'
         '7cb53d8091dc504c6e8057c47e0a0edc'
         '897d23c3d5439a472897e307dec160cc'
         'e76a11ae945adfa5338fb9075976139c'
         '3567c44772ceb73d3e7e7538dc038bd9'
         'b2bee39fe74da0aa1f303384781e25da'
         '3607b47f35e3884747dc8b0f6dcaffec'
         '00701ea31776762535de18a75d5dc24e'
         '43bc68bfdca0efc7bd26eb1b979bb0cd'
         'd3fcbeceed9c59dfc4f3cb17cb15059a'
         '55ad6490c4843e2468a1c8d11026bb94'
         '47ef7195c4ceddb2578a85500a774b87'
         '7585652e037e20245b31049cd0d1f54e'
         '5954ba7b8e4db8d54a2a194ea8d7600a'
         'b3a3b332601dbab622c0931c1fc7e511'
         'b6ebbae98211eb3c3fbd9d0b3fc4f3d3'
         '35de2f131e124c1ef9d9ccf5a0398336'
         '4c38f2edae5fd70d3e98b69fd9b1658f'
         'b11c3f2cf7c1379ad38837f9887d4d9a'
         '63e766ba2eb16bf6690e97ea36c6881e'
         'adce7f2fbf1fd9cb54eb2c329e69ad43'
         '56727236867d72a332dbf07459d2b766'
         'ba48bc850d73a3416266e21dbe1ef6e2'
         '5a196bedc9ad03e96ca48573d7acf55d'
         'd257e01c597573d011127a5c3a758d96'
         'b126935671f8889c9bc26a49fb3726ab'
         '419e565a4002bf92b57d229328be7dc4'
         '26a919c30bc4e22a2f420289035df52b'
         'edeb1ce42fe48547268c4c4ec2198492'
         '1a73873e77ca6a0a0bffd0feb175fc22'
         '43e9b6d6f92e45882b72738979347be3'
         'a353c9f68826ca65978fb95275afad04'
         'a7500f810dd2ec85515183eb711e6abe'
         '2a1cf985eba93a8408b34f13d9f595a6'
         '00d2e7951e0424ba0b5b798d8ffc8c54'
         '58b3c46341dee3a8ab3448108d5092a2'
         'bb3af70dcb38636345f689f7d8932ee4'
         '29828115f729b71fd7382b35c605d3b1'
         'daf8c00b798aa2afb106e030f6feb0ec'
         '401b35f416b6fa33af78f69ed1206243'
         '617a4aebd49b3c436157779165ced0e6'
         '138486b185e4ed5fce9df0c23b808c06'
         '5ae9bd32d8fb5d76a0a22db296a15c8f'
         '71e4b7f5c87e062e24a827860344d845'
         '24d7be7ff9235c50c4a81886e49b410a'
         'b3ca9ff3e2f47c85119faa5b27e4f370'
         '289eb1b57e038dc63319b2c589240966'
         '6d4c3287834a6aa6f20da37b47482da8'
         '45a4e57fc972d8fbf6fccf6e01911d8e'
         '1ed7fa5e5b98c29365044b1454156ca1'
         'e262063fce1f22a4789805eb692f3891'
         '29b68f87d1683368e2b7933deba53aba'
         'ed3b3139ab85beaff8ce2ee648c725bb'
         '3d1688f415953ab2f4d14a33cdc7ac7b'
         '9f367f0a06b20ec3e034ba31a5e72178'
         'f927e6bcc9fb251d4db11716836b9a92'
         'f8d4b9a48e160e2f63c9ae7b23b192df'
         'b01889e2ef9679a8b749810df63f8f4d'
         '291e4520bf17fe0086f943ebe1b469f2'
         'ad4b9745d4d51904ee3f0b7541629170'
         '3199b1ed8c86819997d6c4e0cd6413bd'
         'c3137c1b612c13e17dd9605a768e42ed'
         '1ae2c967297f0b31532e8df55607cf48'
         '1d5292e45a5b2788babd1445a97924a5')
noextract=("${source[@]%%::*}")

_lc() {
    for f in "${@}"
    do
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "FirefoxSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/browser/extensions/langpack-${f}@firefox.mozilla.org.xpi"
    done
}
