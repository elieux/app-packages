# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=opera2
_apparch=32
pkgname=("app-i686-${_realname}")
pkgver=27.0.1689.69
pkgrel=1
pkgdesc="A fast and free Blink-based web browser"
url="http://www.opera.com/computer"
arch=('any')
license=('custom')
makedepends=("p7zip")
options=(!strip) # digital signatures
source=("Opera_Setup.exe::http://www.opera.com/download/get/?id=38020&location=395&nothanks=yes&sub=marine")
md5sums=('4e90426ff1d88920b01fa21fb4154dd3')

prepare() {
    cd "${srcdir}"
    7z x -ry "Opera_Setup.exe" > /dev/null
    for f in *
    do
        n=$(echo "${f}" | tr 'A-Z' 'a-z')
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

build() {
    cd "${srcdir}"
    # Opera_Setup.exe -silent -installfolder="${srcdir}/exe${_apparch}" -allusers=0 -copyonly=1 -setdefaultbrowser=0 -desktopshortcut=0 -startmenushortcut=0 -pintotaskbar=0 -launchopera=0
    true
}

package() {
    mkdir -p "${pkgdir}/apps${_apparch}/${_realname}"
    cp -R * "${pkgdir}/apps${_apparch}/${_realname}"
    rm -r "${pkgdir}/apps${_apparch}"/${_realname}/{assets,root_files_list,files_list,launcher.exe,launcher.visualelementsmanifest.xml,opera.dll,opera_setup.exe,resources.pri}
    rm -r "${pkgdir}/apps${_apparch}"/${_realname}/{msvcp100.dll,msvcr100.dll}
    rm -r "${pkgdir}/apps${_apparch}"/${_realname}/{installer.exe,opera_autoupdate.exe,opera_autoupdate.licenses,opera_autoupdate.version}
}
