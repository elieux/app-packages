# Maintainer: David Macek <david.macek.0@gmail.com>

_extract_subdir() {
    local _file="$(get_filename "${1}")"
    local _dir="${_file%.*}"
    if type bsdtar | head -1 | grep -q 'is a function'
    then
        local _original_bsdtar="$(type bsdtar | tail +2)"
    fi
    bsdtar() {
        local _extra_args=()
        if [ "${1}" = "-xf" ]
        then
            mkdir -p "${_dir}"
            _extra_args=(-C "${_dir}")
        fi
        /usr/bin/bsdtar "${_extra_args[@]}" "${@}"
    }
    extract_file "${_file}"
    unset -f bsdtar
    eval "${_original_bsdtar}"
}

download_https@subdir() {
    download_file "${1/@subdir:/:}"
}

extract_https@subdir() {
    _extract_subdir "${@}"
}

_realname=keepass
_choconame=keepass
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
epoch=1
pkgver=2.52
pkgrel=1
pkgdesc="Light-weight and easy-to-use password manager"
url="https://keepass.info/"
arch=('any')
license=('GPL2')
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::https@subdir://downloads.sourceforge.net/keepass/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "TrlUtil.zip::https@subdir://keepass.info/download/v2_trlutil_2/TrlUtil-${pkgver}.zip"
        "KPScript.zip::https@subdir://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"
        "KeePass2-Arabic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Arabic.zip"
        "KeePass2-Basque.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Basque.zip"
        "KeePass2-Bulgarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Bulgarian.zip"
        "KeePass2-Burmese.zip::https://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Catalan.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Catalan.zip"
        "KeePass2-Chinese_Simplified.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::https://downloads.sourceforge.net/keepass/KeePass-2.44-Czech.zip"
        "KeePass2-Danish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Danish.zip"
        "KeePass2-Dutch.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Dutch.zip"
        "KeePass2-Estonian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.38-Estonian.zip"
        "KeePass2-Finnish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Finnish.zip"
        "KeePass2-French.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-French.zip"
        "KeePass2-German.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-German.zip"
        "KeePass2-Greek.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Greek.zip"
        "KeePass2-Hebrew-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.35-Hebrew-b.zip"
        "KeePass2-Hungarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Hungarian.zip"
        "KeePass2-Icelandic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Icelandic.zip"
        "KeePass2-Indonesian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Italian.zip"
        "KeePass2-Japanese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Japanese.zip"
        "KeePass2-Korean.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Korean.zip"
        "KeePass2-Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Latvian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Latvian.zip"
        "KeePass2-Lithuanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.46-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Persian.zip"
        "KeePass2-Polish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Polish.zip"
        "KeePass2-Portuguese_BR.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Russian.zip"
        "KeePass2-Serbian_Cyrillic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Serbian_Cyrillic.zip"
        "KeePass2-Serbian_Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Serbian_Latin.zip"
        "KeePass2-Slovak.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Slovak.zip"
        "KeePass2-Slovenian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Slovenian.zip"
        "KeePass2-Spanish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Spanish.zip"
        "KeePass2-Swedish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Swedish.zip"
        "KeePass2-Tamil.zip::https://downloads.sourceforge.net/keepass/KeePass-2.49-Tamil.zip"
        "KeePass2-Thai.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Thai.zip"
        "KeePass2-Turkish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Turkish.zip"
        "KeePass2-Ukrainian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Vietnamese.zip")
sha512sums=('83d98cb867319e7e0c59e3264e65128d7d8d9c39b8e4652e5ff1a7576a8838dd78d8edf9ec984d3a0f2fce7a337c9b79f1b6e8c327263d70272038ccc372e2fb'
            'e81146ef517e83cf6b3b88a631ba904c0696ae1dd71911d8938e33600e86c4cecc89c557515eba5616bfea3c2f7cb4ada2ac7651b02a8f792844fe98db976981'
            '1f4a32a0a110187bef7db46c4644f296b86a2dc9629bf4702201538d9193f9e271795df23c357037b6607c708f64aa2ee149fb071dde3fd75e85ac0d342399d0'
            'be3675bbbe47d929a1ca6c5dfefd31b674c7304cc4bfac914d5be9656937554919478feb363fd3a51561bcf879941fcb54b701648057422c452bf677d500a839'
            '4fef35b120c86556b9cc09860f73c3caaefbfaf3d667320a2a7d724a9a3fdac37d5dad68c7ce77616f6006bad195a9eb24f79969607965850ffd915aeeedcd78'
            'f76be4cfbbb10b67e2e9b878ff1d068ff3abb52a9039f3c1814c0c50cb39109fb71d63379f39a4cd39724384a3dc5cc6004998c17893a5d21d344737cec83a55'
            '459c6a6fb6ae14d7a4f5e1d30565d5da8bf9bb629bb9b219fdd49cbdb26f16aabfdb2bd0411ff698f728fb2b0344bb70ce0d06b0f28a800b25cf15f5a33d4d88'
            '8548df07918d101548e828e038bda9c593f909f17cd11cb568c987094b19ed66306f79e3e58d3128a3aeef20deb7061f9c1f1fc001e28aef355b42ec75a519d2'
            '6aba63073fad5a93c70e2661467c8e34dccf6ca9415c5a280a458e54f2fe2cd514a4e60a77a272eda68c4ea8658e0d35ff1150e158af7ff2e37371c34efa619d'
            '8e94f5107735abe1c22bd200bdbc2aecd9d6daff1990e5fd4b2068902471ba290857fc98cb84a691c854f2d3539c7516da59ae6e35b97b9594acef9ea328e958'
            '112e82d38a73b4fec98fb98bfe252ac3f6729e5c18643e701de134e2be261f387a5ce858cf92eb2bbee5bf57fe35adb57f830c1b9d0ccfa2d4aecb5ccd462137'
            'a3584859709ef51bbf68f1703eb82178686d1694bdbf1a8ad992f6023bcfe67269313e1279e75c5450b59e693037dd93ab87285c8f43cb60e2dcd75bfc216020'
            'f0e38f8fb1a82ccb41b64042107814f9ec9774b7028f9003ab293fea8847e1b507ce120053905e1bccf79d6a4eaaa2aa8cb6bfe392db8071d700f3dd339992ad'
            '21bda17b2e01f2cd42740ec10b28ccf073a56d2c462de0e07634ad1ca3facdfba737750811f1fafb69b2e38d180dd29aa46fdf4f71065e5e80d7cb80af014530'
            'c87d1b9beb35928f73d929fdf9bd8a3d8ff2dfcb2767257b4dd196ee735a4344fd42586a95acd594c3878b630bb67540c9dc727121d8e9ffdf58d9620b45fb36'
            '2ef568588a24db4777969f35afd5e803989ae4814bbda6c7fcb674c0b40791ba43dbbce3613f05324d7855c519642e10d7f14397fea7bc95b1b208afc1a62648'
            'ab3bdb59227a79d3a538ac8c080be410dfe418f4ed09bd06b5f40f539bf1236d8774aab85aa5546643191dd790067874b69a81c20ac425f4e346b5f0d6220184'
            '1c882e37645671052fa008948703e9d88a6ab3c20a4cf25edafbd94056ff0bb206fa9904ead50a86f3e21708640b61f37aea2e71366a17bff418760fed8732a1'
            'cf6d9c6a4361cc1a26bf4b0bf1590aa791425178a4f049f26e8da1d050d4fe66bbbd887b8e90879e24e88c3d5f15ea004ed1c2e18e5abdf48e29478690c97dd4'
            'ac15c87901e9302076c1314135672b27515b79991fb13c485b07ea454d2c93048f830abe3e0d29ff6cba24a59cff47f3fb8a704851ba81cbb70f96b8808f9494'
            '6330ec5779b877b702badfb813cfb28c32b6bbbe4f6271586f39a7f166eeb10228c31af0d5e4d98e7c0f8de48525d4756663d562f184ff79b2ce8c91dc2bfc9d'
            '4ba8244302b0242bdcc1d2a3fff4ab725f4f1ca9d25f0ea5eb8842d36e4127ca8357ff5e01fe6ccd63f5eb2c6c7b44a67cd96a5048e395dce40b38d8c96782a4'
            '3392ffd64a3df314f04474ec25d2aa0d83d8916e4e3ef2529e7a42ec8ab6384384a0c246865a2b97ffcd69579fd3cd9c5b40a20b9cd365b727ac0775b12a5a72'
            'fc4926c62a7fa7bed1394535b7245b7abe3ac33af5f3e06bb6358dbf62fcfb967e4528f85043351ee1e030960627abc74afb8f6b145c6bf3ce56f81691ba18fb'
            '60ebffe52b89959dbcbe74da49c7fb7fdd4af913810dd95bf76fa039efb2d70712545e9f08e70a7a7147a1f81885c321f6b33241e5e609b53d31ae4eeab84216'
            'ca34c23fff3002caf596ce308d4e25b78e2fc423539f9818da2e1592762a55b0b6c748cac527f55d0ed12b5b0fe0d4d402b01047c2e662050796948dbe95c6b6'
            '42d32ade642fb1e6bbc8818b8b7d27604ea3b7881da0ed38361cc8c35f1cdc5e88149808c0f27f3229695ea4c438eb229a0d1be85ee5abf2440e525400ff117e'
            'af80a6a57248c14ef710fdfac05531d42fe937105e62c15de4ecf16185e998b2c8719b4b32e1eb4bf1fc0b7cb577f97565a94d20778efd5ab65b59c5baddb3c2'
            '63d6c9cdcc615454040d2ef9172c23da80807319d89126dcde24f6e5d34a7f4539353f429ef13dc9d9133ff2174864dc14ce25ec5a0ec94980bc51e768ecc2de'
            'cd5e00e59b0d681f1b80c20734ec06ef9d317320cb56425ad2dfc55c4263c4bb16def97a2c4c7761079153abf8760dc32335a5bf26800431bc099e27b9c9d022'
            'd09412be0abb999e698d7fdc706172d4c09a52abf8dcf8a44c27ec3f3a2d97765ead60c3efaa6ba8951eecd78fb6a12133681a35a671b7e29a5f6e89a0c44908'
            '17c185bbc43090d4d22e137441e97c868c4cd6417d120bc72509b008a85a8b0eab0ca0b4e4f7f3e8030b01dc0b5e126f2d71108f176bfef59133e43b651b093a'
            '79ce06a5b5cd66d612b55c34e5c9d07252ff96093032b4e21f1ece4c9337836dac3dca1f3c6262ed578e63838f311fa0e3686c6adfcc85dbc45329a0d5d416b6'
            'e41e333a780f9beaec5d0eee71a1ab2e7351edfb894eb65e8208fd5768863a9f51a87b32df95783715619d994810622db8c8634a0536efb657c9b1391a85db59'
            'bd423ed175d4a1fbcdcb6be29072cdfeacbf68875bc13b27781b5e2b8fea849016107e44fe05063d7a5f41241338fd1ee73d2ee3cc5b65005c2c28567726c16c'
            '9400ddeee5ab997e154bed99d281afbcf3d784a11300db7aaaad35de2c6b61f1d7fa40e0d360900c671e48fa2a846b4aaa31613f30bad0ac4ac09cf7e3df31e4'
            'c5b393380b0ddbfe22ab48c4175d963a1d0e730afbf1835696708cf542ca30ead26b65d42628cb0b8fcb54ed1a545177ecb4720c21a2f86d8af4b0f3f2bc81e9'
            '7027843ebbc0d7a608d47e10c6ee71a8794b765695f0ee696b60e9a5284572cc49c1e5ab4a014065c5551b7a527be0aab0b4306b58117283d2fccc2c60fabdf9'
            'dce99d3a6460a771b128bd8beac97c394d0a173d0f814d03f74e9f4dcf467e33579163e4897d4a3f197a2f005cb37800a48f94ff054f1af2794949c422ee5507'
            '6d465aafe64f13ab710ae574b98e75f9d49448d13f447434b3257631113090213ca48bc5be0057f71735609b7ed447725f90ec5e01eadd3190913d0645820df4'
            '96dd8b7d4e68d7caafadd2b40fbffcc869da4cf2b71c746bc422820fc855bad6445b55dff3266dd43ebe516082f6412858da47114bf4826272c4104c00bb7023'
            'b201fe1c661e0d09e27d5bf087f524492ece2f2adb53d9f395c45dc6f9908d307922103a2401ae48010d263d41fc9882bfe1417ae70510b12d6dcaa6e4160e2d'
            'e9ca68ae48260fe3fb1e33e4b0a49136a4fc9b533d815008ee46c40be3dad2ce460d573198f9b1cfbaf411bd175219a7656617af87fc41c201818376481221c0'
            '742455a86facbdd1c208dd6dfd3d43881ca64e9624633057b5a38abd384c0476a69cd0d2d910113928278fceca6ed18b371300a8a9b83de7eb937f5130bbae9f'
            'ca8eaba04e7dc86e7846d07743b0cf5bba600ceb8d84f2f4d22a0e6b560612a3e81ce2642e9038150568ec72cba8bcc44ecf35769f75055df43451ba0755e8eb'
            '4f4d87d81c23e63cf0fad2793a374b27c365e10a36d744de44044d1aeb1726ed365672b5e2a8ad1d18fdf3b516a8441dbdee5db22d54611852eb92daedb00408'
            '338514bcc0fedc3ecb27d6ca724c33e31f206b12b237df76c856b22db9107c6f30456c0d8db6e0acef04b141bb01bab81c18372b6ef1f1dd4b8c4ecf1f64e0de'
            '3efd8e28d8766b6f6a07187fb074339f66a5c5133f060c7a38bcc335a4b9670daed9950c961dc8be2dd092c03ef4f4d3caab311f8c8e60eb180aa400717e7786'
            'd8976dec90b1cd044fb5a1ae53ce19d46f5ec3e82cb52db5d22e4f17142ef1fdfa1dd80978e19f17f597110b6d2f397feb5182ed3a8040957a61594317c5ced8')

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "KeePass2"/* "KPScript"/* "TrlUtil" "KeePass.config.xml" "${a}"
    cp *.lngx "${a}/Languages"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    #_lc "${a}"/*
}
