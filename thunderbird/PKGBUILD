# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=38.3.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
md5sums=('a312b6332681d3fd292078af43d6486d'
         '408feea955ea015ae32f721a2c90166e'
         'eb74777e3c6691b245db417258f356a1'
         '8529163cc3c1012b66d3fb2f58d3a5d5'
         '93281181d3f12ee8da7b8f9b893c922f'
         'cf3d4c3c6bb5e20094a26d8513c9e94e'
         'ad1cd6e300ee57b71e625a0970a80a18'
         '465eafe2a72e2d4e4f4d8efb641808c5'
         'ee1bf638262f1f00c01ac520bef553de'
         'be71afd0ecd8e10b3f0381c981008b99'
         'bea97376df7cef998bf17ce12c2a405d'
         '77352b3885eefe620ebf333813d04713'
         'a98f6bc55319cfd15359f20f69645369'
         'dc047de305108a09352fee707158c959'
         'c17948b03918fc358062fbffc4f1ede3'
         'd7127ef0692f964d8028c4905cb5c19e'
         'c97213c5e1c86a8d44933ea03b6ee1d8'
         'c4c58bac03dcbba6b209bcf0e2202d01'
         '0b661353acfe30bcc38c70ef7625235a'
         'a4e77584acae33e7985c2a34be7a26c6'
         'b526ac6c1694774f1e32a8b4fe63ac24'
         '26e9dc313a2e1cfa43bbf724a4b21a82'
         'bcd1ee57aff84cd291abea8d98477129'
         '34fccde5f0667040548266a892f29e01'
         '5de29e23370de9a1a91e4ae7eff51d08'
         '0c10dfacdfa4fae54bc762453bc559e7'
         '0e92f7592bdd59a792dad0aae3fb1b1d'
         'b76af13ef29e85c445eee5fac4dca983'
         '89c9c5623c743a57a7b64ea0e10a1b90'
         'b3d70cc8e231de2fc398206c9d930f7e'
         'b34fa2ec37acc1593bf1c8e2a82ca72d'
         '20abf91852ba76d83c33ed42658263f4'
         'fc402cf2c9963b4ce4cb2edd7233c03b'
         '539df809b4f0155b7a331d4d0be09dfe'
         'c7b8f560d3e7476b80bba05a63646ca5'
         '63bcc22364dfb61896893dbce0ba3700'
         '799fc3e2b01df38c7ffceb82e82afaba'
         'e221aac7171a056a3731a8579019c4d3'
         '594dd772bcd2e85081af882d968f8139'
         '65f4dbf34b0ef7239ddd1d76a4f312e3'
         'c7e848b3f48ec8e6e4ea087bd5216e93'
         '22c1ae6a88a27287beda6deb50c9d952'
         '7cc79328f3259d839903d0d8a3939bca'
         'deba0a9a6ad61d4b1d47df614daae191'
         '9b3572de1f430bafb95fa912b485cd68'
         '614ac8fd3787d1a451c3e79fda5d1db0'
         'a6e385762449ebc621d05c06630d26c1'
         'e680a04ce6c2fcf3d4af3834adb4cbb9'
         '0a1f8225d58658f68f2e83822c08018e'
         '3f0a598e0f8a006a901584efcb1eb6d4'
         'd9cdee9358d930ccd7887687656d13c7'
         '9551f887aebee147127da4d831fba885'
         'b8f530b15fb821a8ab0fecb50104e4b4'
         '4575dcd7b851a5084988eafa4c9731d4'
         'aed1336882e9d7d35a7bf10cf6cd4a95'
         '22b24509a6620fde04ece8316472d565')
noextract=("${source[@]%%::*}")

_lc() {
    for f in "${@}"
    do
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}/searchplugins"/* "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
