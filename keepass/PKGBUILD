# Maintainer: David Macek <david.macek.0@gmail.com>

_chocover() {
    # choco version format: 2.54.0
    echo "${1}" | sed -r -e 's/^([0-9]+)[.]([0-9]+)[.]0$/\1.\2/'
}

_extract_subdir() {
    local _file="$(get_filename "${1}")"
    local _dir="${_file%.*}"
    if type bsdtar | head -1 | grep -q 'is a function'
    then
        local _original_bsdtar="$(type bsdtar | tail +2)"
    fi
    bsdtar() {
        local _extra_args=()
        if [ "${1}" = "-xf" ]
        then
            mkdir -p "${_dir}"
            _extra_args=(-C "${_dir}")
        fi
        /usr/bin/bsdtar "${_extra_args[@]}" "${@}"
    }
    extract_file "${_file}"
    unset -f bsdtar
    eval "${_original_bsdtar}"
}

download_https@subdir() {
    download_file "${1/@subdir:/:}"
}

extract_https@subdir() {
    _extract_subdir "${@}"
}

_realname=keepass
_choconame=keepass
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
epoch=1
pkgver=2.55
pkgrel=1
pkgdesc="Light-weight and easy-to-use password manager"
url="https://keepass.info/"
arch=('any')
license=('GPL2')
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::https@subdir://downloads.sourceforge.net/keepass/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "TrlUtil.zip::https@subdir://keepass.info/download/v2_trlutil_2/TrlUtil-2.55.zip"
        "KPScript.zip::https@subdir://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"
        "KeePass2-Arabic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Arabic.zip"
        "KeePass2-Basque.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Basque.zip"
        "KeePass2-Bulgarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Bulgarian.zip"
        "KeePass2-Burmese.zip::https://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Catalan.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Catalan.zip"
        "KeePass2-Chinese_Simplified.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Czech.zip"
        "KeePass2-Danish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Danish.zip"
        "KeePass2-Dutch.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Dutch.zip"
        "KeePass2-Estonian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.38-Estonian.zip"
        "KeePass2-Finnish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Finnish.zip"
        "KeePass2-French-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-French-b.zip"
        "KeePass2-German.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-German.zip"
        "KeePass2-Greek.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Greek.zip"
        "KeePass2-Hebrew-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.35-Hebrew-b.zip"
        "KeePass2-Hungarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Hungarian.zip"
        "KeePass2-Icelandic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Icelandic.zip"
        "KeePass2-Indonesian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Italian.zip"
        "KeePass2-Japanese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Japanese.zip"
        "KeePass2-Korean.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Korean.zip"
        "KeePass2-Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Latvian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Latvian.zip"
        "KeePass2-Lithuanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Persian.zip"
        "KeePass2-Polish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Polish.zip"
        "KeePass2-Portuguese_BR.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Russian.zip"
        "KeePass2-Serbian_Cyrillic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Serbian_Cyrillic.zip"
        "KeePass2-Serbian_Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Serbian_Latin.zip"
        "KeePass2-Slovak.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Slovak.zip"
        "KeePass2-Slovenian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Slovenian.zip"
        "KeePass2-Spanish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Spanish.zip"
        "KeePass2-Swedish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Swedish.zip"
        "KeePass2-Tamil.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Tamil.zip"
        "KeePass2-Thai.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Thai.zip"
        "KeePass2-Turkish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Turkish.zip"
        "KeePass2-Ukrainian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.55-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Vietnamese.zip")
sha512sums=('986d02129b4efd83c9c9117411519e79b3ada0c42e57aa2c176b444a770aebf4b469e75b023f451b0a9748312520ad9a2cd5dd265a324aad2216023e91beb1f2'
            'f0bdaaa1df8503301ab1dbf3629eaa1cd4ecc69a719edaf49fa246a5b4ee8d26463050bd0b31c4b8afbf7f693d9d5cc858bc3d4a46856324b851e6946f897276'
            '6fc4a8550b62e3f16ce3d1ab26e00c03baaffb23b21e63f834a04135eceab195644ce3d3d6c5acba84b3caf6bea2465b80029ad7447f33c5eaffa686a5fe4365'
            'be3675bbbe47d929a1ca6c5dfefd31b674c7304cc4bfac914d5be9656937554919478feb363fd3a51561bcf879941fcb54b701648057422c452bf677d500a839'
            '4fef35b120c86556b9cc09860f73c3caaefbfaf3d667320a2a7d724a9a3fdac37d5dad68c7ce77616f6006bad195a9eb24f79969607965850ffd915aeeedcd78'
            '16343ca3e4b63577fdceba42040c04d14306d4d98d0291f61e126c59f0af5120385cab6399a6ea1dea662fb44548ef4a70f45c2b747f0a1b12b68ace6652ab9d'
            '9e34ba9bb809916a3e85d78947d26fe9c6521583ca04e68de8ddb7e3bf5881841036632e0f90b3be710b7ce6d83eb904abf11a3a79d5e9537bf3314903803880'
            '8548df07918d101548e828e038bda9c593f909f17cd11cb568c987094b19ed66306f79e3e58d3128a3aeef20deb7061f9c1f1fc001e28aef355b42ec75a519d2'
            'fd788ca2e8e8ae236e8db1afd99ee060d6ef06ee14a72f03d79793b68c090693be6bf5465702130ab92182296ef65fae95c304bd05a402aee339403d2a9d1593'
            '4c9c34fc8ff64d65f969f4d938a09c4b2d63282c848b0c0fd7253080ee937c7bb3c957d49f19e750cfe6b5f53ffd85ddb92063f753e8a5c12da0414b34f9d8b7'
            'af53514aba05824e4c2be616816d1864d96ba6be555612be5f78f4a6181f636125b3fcc764cc283729bb14ed7b949ca065b6e3e3c36b860967a019653ae391bd'
            'a3584859709ef51bbf68f1703eb82178686d1694bdbf1a8ad992f6023bcfe67269313e1279e75c5450b59e693037dd93ab87285c8f43cb60e2dcd75bfc216020'
            'a0160b644282d99940dff6c36723deb66baa238f2a204ed7d5b299fcda5bec94f9884d007ee8c2033ca1c7c48c6fa2eef88c8a0fe9cedd83c2e35e874397b336'
            '6f19f0b05bf4b0834540e58b5a8174f79ee0e0e39683bbea73811aa4ff61938ac99c59155bfdaf679d770c41c536c9af7325af07475e52d758737c25c7ba12a7'
            '544902d46451fffa4b3b871c58ade63c4ebc714f06fa7d608e283bd7a21549a969ab499efa38ad146fa431ba472b7e547879430773e21af02bf80b390e658865'
            '2ef568588a24db4777969f35afd5e803989ae4814bbda6c7fcb674c0b40791ba43dbbce3613f05324d7855c519642e10d7f14397fea7bc95b1b208afc1a62648'
            'd82524a8731adca2a052f25ce5037f235392b045025d9f23b736e3dcef7e8c00411e2cc87cd229ee6a109821f8b69e21ea96eb168d1ba692b55f5df33606230a'
            '4dfdc4622a7c05d97764c0832d085c5d7d1ee77e4894024531c5a29269699db274ca60cae72792778ff7d4c50ef54216106bcd7fd3272b2bb74d31cb26d58981'
            '1979e3dc256a1e6dfde412dc6f57cf69d2cf6d365821e9d14b9c6b24dbdf12b13ddccb4546240cc4c18be1e28ef7ffa3956c93d12c5bc56dacdfe3bb82af0158'
            '4c504954ce03948ef9d5f7a3854556ff858eda1a02150dfd273708144eed56ac62d6b7699aa9b767f4c83b0a7521ccf1590a1084dac2121e9031bfaa740dfdd6'
            '6330ec5779b877b702badfb813cfb28c32b6bbbe4f6271586f39a7f166eeb10228c31af0d5e4d98e7c0f8de48525d4756663d562f184ff79b2ce8c91dc2bfc9d'
            'bf0f321631062dc451a2196745ecaef0fc52a051334bf8c7824ff3325f728ac5754cb732947707224f21889c803d8065fa0bdf53a7031006ecb83887644fd689'
            '3392ffd64a3df314f04474ec25d2aa0d83d8916e4e3ef2529e7a42ec8ab6384384a0c246865a2b97ffcd69579fd3cd9c5b40a20b9cd365b727ac0775b12a5a72'
            'fc4926c62a7fa7bed1394535b7245b7abe3ac33af5f3e06bb6358dbf62fcfb967e4528f85043351ee1e030960627abc74afb8f6b145c6bf3ce56f81691ba18fb'
            '01d2c2eb6f54c0f878c86be787da743ef4c870345dc165d58347de686c778030b9bf96a0b1cd74abb5cc2c743e15edbd216caf9eef697fd04c0b09c46bbb19d7'
            '57bc8bab5a28261d32c74577eeb5f01e4cc9654d8b85555b8d32e21619bc605bef85f8968cabfc70f0f80370d979029908930a3d56f9d4b56cd907ef1cec2c76'
            'f8026860b10e95a7385b6135be434512c7454024c587b0525ad4ba2e72849d433afbd1a58fec839349f8388efd5f7cc998cdb6fb23ce6264ce61e1fc53d321a4'
            'af80a6a57248c14ef710fdfac05531d42fe937105e62c15de4ecf16185e998b2c8719b4b32e1eb4bf1fc0b7cb577f97565a94d20778efd5ab65b59c5baddb3c2'
            'aacc43d8a639d69b71d8599aa7c52b9d9d8a41b415bdaec51fc6eab9d5581fcf98c8e2162f3f35aa1ac72523e33e8ad4d6f7a8fd197a5d33a1e9191e224bb1ba'
            '4a72f79250fa2e59b6422a3c3d9065a5655ebe390384ccf7214ed9d4545fc0cf795890d03e1147b16f26ce8a890b41c2728bc9e7b98437b614130648741f83e6'
            'd09412be0abb999e698d7fdc706172d4c09a52abf8dcf8a44c27ec3f3a2d97765ead60c3efaa6ba8951eecd78fb6a12133681a35a671b7e29a5f6e89a0c44908'
            '17c185bbc43090d4d22e137441e97c868c4cd6417d120bc72509b008a85a8b0eab0ca0b4e4f7f3e8030b01dc0b5e126f2d71108f176bfef59133e43b651b093a'
            'e2619f4b55530e1eeb92c378ea1db2a81450cf7ee11f8adf910199c3bc96890c548447bbf41b02cbc8f6f828a97e48c4cc7bf7cb64ca2d436ba381bcdbddf8e0'
            '846347bc28528267e0442831c2d247dc24f552d3be45379efcb099f04e1ee4d8ac1bbe3f901100f01370f0a51670cc82c5290232447b63bfe43c32347e7ef3e4'
            '6cf74aa1662c62adee26da834d59a6cbca263bc97a13fd1eb8c984bfb5165345b1a10114bcf90a057b5f3e7a9ed3c4fc094614161c9c844865cca437b4f8ebe7'
            '2ae44280f37eb1b4d3dd709c001145e7488f10020ed935baacf42315cd1f9f1d28581f90a313e8b175be5ec45d583147a3b984219aca1091c8eda735dd5dd77c'
            'c5b393380b0ddbfe22ab48c4175d963a1d0e730afbf1835696708cf542ca30ead26b65d42628cb0b8fcb54ed1a545177ecb4720c21a2f86d8af4b0f3f2bc81e9'
            'c75bc52e56bd3de98ee77b83c241a0c2c25b414ec0926265ab123534d6e12a8e1a9a59634a55f19d689966134ab09c2774742ba11dc2ea26b9db57a7e0415df4'
            'a7db917db4d79834e9391e7257698ae3be356c14daaf83fa9dadfb3a31f7a1776c05768c83bdff86c486bc9424ce616b6d8d858e7efca982e7a03bf59e6799c0'
            'aee8a302b9611ae3d619163eb3ce1f056bae5ebd5a4ee1bb130cff3d3ea4f33c44ce0601bd60633b594eb4a259d43677efc0d40e2f4fe4af653598a0efc195c2'
            '93e49fc56f5157f5a3dfabc7963440df8594a9677bc2bd6b26d6a84e7d846fe920c67b93f5bf20743c284cc4e63431869c56806c64b3e7e765a34046af815878'
            'f7ebea8c5d7b3aa1d7cd084848d656f6143d29c9e76990d2e1e9fc8dca727fcb8d590945f8b3ef9224cdfb71eb4680f74257617c39e41f83d7c25195999cc115'
            'ff6de1cfe15cc5b87f717369a8ee0a5f58ed698ddb3d2b54a44537377c71e20b669275038305a003e55052a909e2ff905e2e79b5991c614ccfcdac9099249444'
            '742455a86facbdd1c208dd6dfd3d43881ca64e9624633057b5a38abd384c0476a69cd0d2d910113928278fceca6ed18b371300a8a9b83de7eb937f5130bbae9f'
            'fef4c95810539540ad280323bc1459610abc5af297596d73253aa033b1b0789d3b8eae1e9beed67df1c38efa0b7bf89d6589568240a4715cf51e089e783718e9'
            '8547d97135133f49b1a9cb66eeb0c40510cc9028ce9ab19c96c699b87be0870bfaf4e2a64ac63266285399d184e10d19a6dbfd2bd4ba23d91e81dee83dce724e'
            '3953d00f6b0655e1dc2b2f8d9ac8a9670d985f007b2d8dfe60cd10c0ac796e7ce7b300abcb65d07ae66e4da0129607dc6bf0da28f5b3150f2e22d4486167ada1'
            'c34f066948defd05317163ea62067e203ed013a92e74b1ef1141427a2d1c9bf8cfa55b02588da9086eed1863f27a28be5f5be7953ed896555c60f9adbf27a01e'
            'b2f3cd8cb26584bf28cc3ffe71048f1ef9776c65a7272a4233f878836a3b678ca7dc1a9cab01feb1a05ed4f714e949b6e913f96d7c6703981dd05f32366274c8')

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "KeePass2"/* "KPScript"/* "TrlUtil" "KeePass.config.xml" "${a}"
    cp *.lngx "${a}/Languages"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    #_lc "${a}"/*
}
