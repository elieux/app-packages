# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
pkgbase="app-${_realname}"
pkgname=("app-x86_64-${_realname}")
epoch=1
pkgver=68.2.2
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="https://www.thunderbird.net/"
arch=('any')
license=('GPL' 'MPL')
replaces=("app-i686-${_realname}")
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/bg.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ca.xpi"
        "cak.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cak.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ja.xpi"
        "ka.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ka.xpi"
        "kab.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/kab.xpi"
        "kk.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/kk.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/lt.xpi"
        "ms.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ms.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/nn-NO.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/sv-SE.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/uk.xpi"
        "uz.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/uz.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/thunderbird/releases/${pkgver}/win64/xpi/zh-TW.xpi")
sha512sums=('6d3f3b76710aa6f0eda0e88b1c75ffb02c3d564658b227bc4bc7c254b426287ef7914645cc6a9fa79d224ee2c103e879e81d80b3fbd5e1b7c3b8cc5231f33784'
            'ce70660f731d5bf989a217dc78fc7049817ed98eb59b25eca36e3f0e0ab20cf2a71235cf067089e75751d4984dc92da97cd1aa4336f74164b9c983af678b0795'
            '18dfebfe34cf8d5fb2672193a362728f20b3e9ceea8710784a3573ee6e701f052ab84c9119619a1f94d1bf21c1bcaebf7dfb8b4cc28aaeae80095d97d67791d8'
            '06122805a21e1e608aa1af2325e42e38e5b0eab00aea4e0d991f7989491571ce1267e30a878e92828a035b17fce61d28d2c9dd418635cbc2858af42d6774f204'
            '0b2c127dbbc22030a748b81fe2a38186a820a39bf990b2fdaafa4c335d68d343de3354acc5f916c8b13fb5f0751b6248181d3d8aa3b356c06c169848b2b72cda'
            '7c57b5fc583d6a39359951cc6184074b1848df80ce26df4637cd37ccf844553b9e0fd71c456bffcf1549fcf688200068bbeb7e08d89386770d1b8e71d07c5cd0'
            '0df96a1bd17c70b8092ad551fa274e7ab2ff86bdbdbcd1f697e4f6f1f00f5a9b6a244425a6472e3fded27456b4a7b20f0c322d33f8c868f625e0261f73b2c1be'
            '8ca934a6e42a1d317ee7288df6e6968553f08c6e7e0030c39730b1b5fffa202b22418986e03574ffe127ea065e6c828f9d006da711b31e9a012777f57eecde55'
            'bcaf4e140675c5b5ab558ddd55e81873be50cd2ed43416b63017045e47a359aa79ce91d60f044ea8e314cd43c1f267fc8faf80fe83397ea6cc5d65b8e72cac7c'
            'f012d1c6e500ab4ade9d1a1f438cc4bf4eabb57a8442c34f44ac4546f56c4cc1e1d86f74d0bee2c19f4bcf1e202ecfa740c5bc65d4bde68860ba3e24ac975260'
            '0102f55e80e85ce16161f8489b082c6320784bc4a8c44c23570ae596fc05349cfd4ec8d80eecacb3124f23bcc9d8fef90e42870f3b7d196cd2cfc928f612a41e'
            '5e70335ebee0db7dd7d914cac617f26cfd31b0fc76453feb4a32aa5eebbcc43b65d41324590455796c8600d607b66af92a5d672ee2d686f0127d1c0d040fddd7'
            'c342d9d4a13afd37bc603862e5db092e6dea09bb85eba63da31d483f22d771a9fed3ca9429942e1252d5114f5f799fed2c8044bf8d41d18297822e27fe568dd3'
            '71adc70945e1e1db8f49ccaec3c0e56dd3057376018a1061a9b746d7ebcc9982d47514f7602b3f05023e8528b45234adf409c2df5de3c2081cd8aede2ad2bfd7'
            'c7c7a007101214e51f5615d21c2f793acb8e6ff0c87e9e45dcbfbda4b5cd24d99aee87108487dc77b0b7e671949dc35e00997e0643b0cd47ad57aa8d8b677374'
            '7190ad700ef8e21048676042067583b6cd54c7b5f0bbb5e482d923b77d170686ca5358de9403b9b8ffc0d906f92b485a7395f15bfe0d45b97c2a2f2709b6508a'
            '31e69ebf86519811fb2e97a0396dd446dab506783d9b6a280092bbe054c7406015c21cc3c098af39976120363dee9570684bb582fd7cea5f441ece161eef0fb0'
            'a8c95b6947fd2630ef91eff3f8adaa0ed0598f4ef90777a7c7073b9ae82bf3e15b0163dad970d14f970e806c32e88c97f50593cafd65db6771d5c0e636bba055'
            'b35faccd5fed9308c9f8ce437769aeed08b6d0b75811a9cbe24c9fae55621b051353e6a2f2984501211ebf1011da257c8e313086d4b1e1e4f9287d320696cc0c'
            '2324573e9275a1da4c736583fe671ca70260b634a3ddad417a305ed42ad4df8e31471e2499a7491b247a8c1c6ad3610de08fd60b5e64571127469f6399b8ce96'
            'f92498e33e68313a168ce86c32e0380fc0413842e7e6e27a84d12e95fc550027aeed43902a2c41b449f17fc99e3172ddaae925c4f4e60aa514cf2986731ea75f'
            'a0c870c9e31cf00e5204ffbeb04faa7988162c1e3a269aac08a67dc42e172b9fe9f280f542265a68442bd21f6114f6a6432ef003259daddfc6d57b1ddd7efe25'
            'b507baf4ab397eb48664b43aa2a01ba3a5b8d456626e97f7799238f6417892afd6ed85f419f4e1806ef6f412f1dbc0a2727f5a73269a6f7cc9b29476f912dc9f'
            'a5524c39f5d5c00b330b7b65764c4fec4db51ad50ad58965ddb7c33325b9ee9d2f8d03849464e02e4e1c4b6d2e523cd46eb88b37c7cf2143ac4b7b6a70f4c6ea'
            'ef0e027dd961097d3fa51db31aa470a069c4286660d9eeb3be68d9b2ecb53bccc1f1410948439689b30c99d264b2ba8445ee92e47a16a7b907fd6be3328bd4f5'
            '484255d8056d79a1de4d11b06a5e4c69490ba4b8c64ce1f73f2aa6808136308e2d0419a36ebb29c15f2de032bd4e6d5a19dc1a55ee139e66f7013303fa60226e'
            '2f09507db5296217963f3d665b1cb1f14a1610c7f0eace7412253f8de8bf72a41309a12e2fdb94314ec116290ce6460e2f5fd67c1949c0aa54b6211d20d41a70'
            'f7617d6f0ab2a0e4fa115ac8d6bb35aaf8092ccd190d76fb5e303f3b85708af26e32900b69a3bef6bb3c963f038e22828a758696cdfe5ac6e422f639aab479cf'
            'd69143f9a126eafe7f792b30fa92d3d26273829e6eb46efabbc29b7babc9cd639ddf47bbdd94c6c197e7f9cd15651536d682a196d677f3816e39933aea94b8e9'
            'd8bce34ebdc034293b59c11398afbd0af00f2b611a6adf7119f566b706d508600c4be57b2b7baef19666ab543679e81c8bc4b85961583b58a2d2628541a9d5fc'
            'be63d47f993e3fe92ba3cd65bdfeab6315f5454542eba8244e3cc36868c717909d0e14516c1e2408fdb8bf6105810db86fcd3c767d0ed1fd865df900a26748ff'
            '43004b1d01b629f18f3e8c5015e72f4637a21b1f72cebfcd6b2e5304c6605d97e0913be80351c7a33d001c9b0ece54b8377e60c26dc144dcf93fce6180da3b33'
            '6435f30cb69a545545091c89621e6a224ede0a4139511f475713e31a4fe19fb5746929972614634c7794e4f81e5e16c44528489919317b2788181c15d3b09c2d'
            '02942f280c7faa13b0d80bb6647f7335fc02fa8060f568b1b27a931089c71bdd667835e279ebeac64aacf4f79d7494579dad3e3ca234769533633b3874a931df'
            'ad3d6f95ce19502282df5fc66eaa45e5dcac6fb2afbd35c38fc5567162ce88035acc5a8cad9c7e418f2d386c8265b6d2104852fa215c01ee84cccb7e6da207b1'
            '16bbc0a6d80f834a804a5f45a40e47d1f92f866cfbc1ef9866677a37fdbc79dcc258c3684086ef4e45664b5e3ebcf4d3808f7fb4f0809979b65f9e664b4b040d'
            '64f3d1dcd852350cfe5a6434d13f2e63c36e6bb76acd7d869314eba25ecd51b404db6518d74c64468f4982a50a1d6b64587c95e13b3209d967c9c5e216470d6c'
            'af21e28e8e4f7a897885758a72793379cd1b0ceb5117c8e27acd68f990265df22ba34c318b62af46ef5f497393dd179db22316782917a6bff280c5b494791435'
            'f1cba58bd8aa53c4da5f4da838b82e21ec9624148943405c2f64941ef4495db61cadfce1270f4068441dda8cc5bf9c3fd74005a08ecb960ffb60b999b6bdde1e'
            '8f9a6c5174644827c236636bcdcab3c633dca7edea06ac95440242823b177f3e94765cf5af23e625c6ba1d20f460332adc2ac411f5fee1cbbf19ab22468f5f38'
            'b8721817a552d7443d04aa7f87af499b0440a337f035e752d7d1cbab6eff1271ac6cb55d15486e44d1f1da907bcf0b597d4d1866e36afb4fcd518dac6a750e1b'
            'a4cfacd0dc29df06cfb720dcf24cf6eea11a5df6e42ecc569642fac7ed495c8a2d64d3b890ee57fccd220472f0195de18272216eb05426ee2e4a3c2188d3aae1'
            'd2ec3304cfadd792047d6aae241d25c56a7675bfb795c61826ad2f03ec87f547507a757a118a64c46ab9328a27d6e08823956889f84fdf8910102ff3ec1e5635'
            '9bc33a2f9bc06eeced6d7853e069803133240b76023269a23008374635fd929d9cb396e9fbe0da95c12380f15880a94ab48c82f687d71c13da21da0213b99b46'
            'bed99e9556f6c7f356caddf4187a509fab642555e95d11e53f0ffbaf7a429a32f4d417aa9a85cd3dbf5b4492b3311a563edf9b80c4e6195a66060aeec66aa6b2'
            '95a58f63ec3cf5610666170fb3e3798c1269c8bf65eb35f977887d7cf80dba9a66e7f733a8b3487c4f070238cfd80df732e896f868ef3d5fa0eac85b0ce6e11d'
            '53ee4ab40826d06fdaa1c0bd92153f3ed89474eb67d3ea323afb71ac80340cce8ceaf5c4a1f4d704d62f2a927075898531c080f879eaa0529ac41d15ff88f2e7'
            '3153723fa2db357aaed01b1b5b110d6350562799ba3f47b254b6dc2afa2b632258efd2922104999dfd6ceddf4aab097fb4580decefd6588d26bb169c85cfa18e'
            'b6027a4e259c052cb9b07bec4d4df68bc557f2eb4413d551eefc0306ef252e6cdd02ed681293bcf3ffb1306d9cfceb958695cb115490efa833f8a1b1fd1725c4'
            '877c8de303355e2dc959b4982a185937345ab071760b86a1b4eca0599d3b7e641908e8bed821f9703f849846624228b44ac514a8d2bbe6f13a2749acac311932'
            '3e1934ecabd364b8d39291ad666908475f13522259c21012a2d92b871117e8a80f90f9fd01caa380fb1ae66f31cf27a2b2350d94c719a0b49ee2e78134f2ebb5'
            'a384f63952fe37b10871ace0b42a64ab02179f06775165bb66e7544f0825e0f90da7685f084ca5be235b25b0ffd57fd5a8fd48041686f68a5fab7ded4f70a9eb'
            'cde3254356977c29892b566d17d03b1b550502912fc8765a52bc3e4d28b3064a97f483c5093e8380c2cd6bcca7e85e7cf34ba687a8d0bbe53e63b7ba37f389eb'
            'df596af32cdddfe910cc08eef0aefe2b7c304de38ffc968837908d0be9a55f40d52371f32fe8f15f3caf0b4dc336f432faee6fb43db959c5db835767a42c5467'
            '4f96df0bd0feb9b6209636f74162f6fee127ca141d1f3e996d233befcb48241f4b7809e77698f7be78c4bcfb39e75f0c0b51b9fc4a58222ba158adbdd69f2d73'
            '831ccd80bc8760ba2a0fb1fe42f418a45f45dd72d2fbd90dfe214afaa779072d3efeba6c4e16fc8d5ef2d7b49af96a7a7799dd2d89fc78958df85bfd988ce3e8'
            '951dd16cf8456217a33f5bfc0dc3cfb584804270b3501e158c701c06e2548d75eb71a7588ac03b8479849b9dd225c5fafa34441ca8642dbd2f141aaf4ebc6fbf'
            '9c1021855f6d18edeab8c9c8ee4f517fa12d61b021ca9216de4c626b4790a0bc43897e69e992eae53b59620057ef0bf86ceaf2510228d595b611e0d1c216709d'
            'a655a8c679a092cc49464d8e7051036217d2370fb1ad70cbcb5aa395088817cb1198a3286d9afbbf4a9ebc88207eb5e207fc0d2a3b539855030f4efafb86da8f'
            '23325af946d8c0e4186f94f48fc448d948f422246b87c65ffc2afdf797ad35dc3b3210741271cd159aceb27d9978eae3970c0d0678338afda69ad9dcf103fa2e'
            '86093363d7b29e5853f780ef44dd6c00c8a69eb8d65dd11cab18ac801a349d735586bbc598910e60ce68eb3d9b5d2e71f2826ab89f3f4635f09aee9871b32d2a'
            'ac74481ae381e4d61f6e75b6fe690a8b2e2943af477b28db42d74efd26592408a75a86f61e354be63b44263c4662a1cb2b65c3a6e25382a7608bebf325704a1c')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
}

package() {
    a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    sed -ri -e '/(VCRUNTIME|MSVCP)140.dll/d' -e '/api-ms-win-[0-9a-z-]+.dll/d' "${a}/dependentlibs.list"
    rm "${a}"/api-ms-win-*.dll "${a}"/ucrtbase.dll "${a}"/{vcruntime,msvcp}140.dll "${a}"/maintenanceservice{,_installer}.exe
    mkdir "${a}/extensions"
    for f in *.xpi
    do
        cp "${f}" "${a}/extensions/langpack-${f%%.xpi}@thunderbird.mozilla.org.xpi"
    done
}
