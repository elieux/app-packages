# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=firefox
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=41.0.2
pkgrel=1
pkgdesc="Standalone, easy to customize web browser"
url="http://www.mozilla.org/firefox/"
arch=('any')
license=('GPL' 'LGPL', 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("FirefoxSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Firefox%20Setup%20${pkgver}.exe"
        "ach.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ach.xpi"
        "af.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/af.xpi"
        "an.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/an.xpi"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "as.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/as.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "az.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/az.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "bn-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-IN.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "bs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bs.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "en-ZA.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-ZA.xpi"
        "eo.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eo.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-CL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-CL.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "es-MX.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-MX.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fa.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fa.xpi"
        "ff.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ff.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "gu-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gu-IN.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hi-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hi-IN.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "kk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kk.xpi"
        "km.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/km.xpi"
        "kn.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kn.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lij.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lij.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "lv.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lv.xpi"
        "mai.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mai.xpi"
        "mk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mk.xpi"
        "ml.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ml.xpi"
        "mr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mr.xpi"
        "ms.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ms.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "or.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/or.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "son.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/son.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta.xpi"
        "te.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/te.xpi"
        "th.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/th.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "xh.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/xh.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
md5sums=('5a432c2dbaec0efbe33d8a8e24bcfb95'
         'c28c86498a58adf3afa85db9b5879319'
         '1057168522ce9affda218079d68d5f5a'
         '71073cc9391c0b2f99b2d6a9626b7477'
         'e6ed628a4136124188a89259160b0e12'
         '919e18d1faad4caf90a851099267d8fa'
         '101334e4a3c1c78d43bc9d5b310db039'
         '250bccc4b6b9006c9e9f391127bdf979'
         '9c270ca12de59f66c48714b591f4526f'
         '5f67359420fa73ee877730682f0e7d67'
         '503d18fd1f2137f1c2536efcb1fe4866'
         'a86aa5c4af43c628318cc01c7f1fb710'
         '1da8baff1e5ebc25e59f78c38b505c22'
         '7ab42b8c3b5d2502507dd9273670370a'
         '18989a6935e6adf6e316b6adcbcadf0d'
         '60c0a6398d65ea42b59b3b9fd231678c'
         'cbf0243cba729511766f1782b09228aa'
         '7fcce7c58fb41871942af0677d656e75'
         '6d8d515fbc45dbb5a22b1e79d6d6c2ca'
         '53b89444957d20917952ccef35c13f1f'
         'c1208eae85cdef98a9a06f640d1c7a60'
         '79bd0fa79b44252970a05cd656bca718'
         '3354b6bcf8ac09c00fc3e9e9e085ad17'
         '45c83d822a5afc137017f666ec3153db'
         '15ef520a8fc6c4d7c09ebe3bf35d03e3'
         '94678b72dae913997ccbd0129521cff8'
         'f9edfc6a8100a752f946d0944ed55665'
         'fe42e7eefa61a2a36af3af254cfbdd38'
         '6968e6c33fdd1e94081be095cf8e3436'
         '5e2a9a2afc32644e5d36f2783927f400'
         '39371f793d201ad023a654259d1f1fae'
         '162367fac06e8685ec6226322e6b9a3d'
         '3d6a98f795707ebe8f00a72d2fe9cede'
         'f5c874f3523cafed26c89dbd9d5ac811'
         '183d4abba4513e078d5cf8a47f7a695a'
         'dfa1f273910b3ead8537447b9b4773ad'
         '17d07e3033cf7904eab4d76f9631a62a'
         'a1847ab2b915206493ac5921c83d2888'
         'c8247c6f65c46e0e574a9fe2d727c8c8'
         '3c634985d603f886d1fb18d92313c796'
         'ac4dd5ed3a98c3307a7221a8c74351c6'
         '19a9626813d7f1f9e6b0fc5ed2b3d5b5'
         '9a7c768c92f39fe85d15c5736dc23cc6'
         '9ad40f9ab25a15a97e50c8933ceb6604'
         'b3a51a02ec511ce9d7a98468c4014922'
         '6f493ce67b3f3e7e7e9b9892d4924621'
         '854bc6edf7d47be41a241ad5326293aa'
         'c85e7ac70bc2a1a3b05ad7256c8a8a3f'
         '9262d448746e94c59be0e9ed58dcdcea'
         '8698a73f80491e1118c8a9f6eb2c30b3'
         '1acc34c4850824cc9367a137806102c6'
         '99e322a4287e4be1f6c7ba150e841272'
         '1c91dab46df1b075adf603a8426567be'
         '206ade28007accdbbde688dd81bc5eed'
         'aca9badd579c0fd510a4fe93d906af78'
         'dad6daf95452d05c3950c0b22ba3f831'
         '833a1066fef442a662cf9967ecc0ae6b'
         '6f3a9e7204d0613bc203a5e2a2fe0a3a'
         '9caba3b61b1cd8878884cc18695729f7'
         '56378e6e8cd6ea629baf3e102a20b360'
         'cb324815a71bb89e3c36dd6a451aaa1c'
         '908829f1a82f9a2935d727747d36c918'
         'c509cba1f15150a3daef410934b37947'
         '6949213b1c584e3cdf30b63b2d75bb11'
         '2dc1349c07f5692f9b0f1493f6711333'
         'c01d38dd45eb0394c47d5436c646d16e'
         'e0c8de9885bb3ed1ad0c46b63d1e5779'
         '9cb6977f9726f501c7a20b5d86b7ac18'
         '170193f73082a211ac58b2b400e386d6'
         '2a6840066b37df4d96c015497bed46c6'
         '60605075d68fa8654024d76f5593b51e'
         'd6596e0f19f355cea14d1ba8c6aa995e'
         '17bde6f7aff4627fad649fe0ea2c79ff'
         'fcb17bf7a27e4a7d7d7c94a80cd48a1b'
         'd0c619de5a991545d36a2c74d0900552'
         '62ff89ee843ee21e58679ac54348e53c'
         'a898f1adeda712b5ea44544b6dffbdf5'
         '89e7b30af4fb63b0dacffa06d8c4526f'
         'f67e113b7d1bdc2ce45b806bc2c4e0b3'
         '890eb5e29554ecd3ac15107ecff7754a'
         'dac9d23a6b16b956a2f893018cbf7bec'
         'b96f8804e29a673c103bc9daa0b6fe3a'
         'bfea16ffbdd7079ec12b0c192ece063a'
         '00c6c0f190ae5789e99a7ceb315ba251'
         '391bbcceeb1a0d71bec339d7f4e0a3a0'
         'e9a2683ccdcdbe8c9a95233a605a0bdb'
         'acf897b80949fce9b841299c15af886f'
         '6a8ac70c61ef96d6d654daa25fbbcd81'
         'c07d848d9d6f1318b08f3fdc8fb162ca')
noextract=("${source[@]%%::*}")

_lc() {
    for f in "${@}"
    do
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "FirefoxSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/browser/extensions/langpack-${f}@firefox.mozilla.org.xpi"
    done
}
