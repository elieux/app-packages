# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=31.5.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird Setup ${pkgver}.exe"
        "ar.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "da.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "el.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hu.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "ko.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
md5sums=('3aa7334147077e81517ef6943fcb50c0'
         '53dea789ee723c32f8595825067668e0'
         '017c65f411313fd4a99fa39f27b4c803'
         '4c07aabb9a4d2317ab1250c1c6af6a4f'
         '3897e809d5a8f2ae8670ccc209536c80'
         'bfb4e332c3cba4f171e11d1d145a71d1'
         '64f1feb2d7a1a57c293ca5377724d8f4'
         '3ac02bd274897e479a8575b46975b86f'
         '48310907e28c9d60e87f3a687163f7a4'
         '8971e82da75efa13668a59c0d0275e39'
         'e925ab3ad407e2a46f2f6c198ecddff6'
         'd2cc3b62f2f94b68f2041c9b34206673'
         'c85cf3913abd441b867bfaaa2b6c2250'
         '4137891b862d122d6e5c3b2539202d8b'
         '8d980aaad103e8f95cd6f998f795f84b'
         '3828ebbea48d30d4b23bcf6bd093629c'
         '84af9ee02c743582f7535741c43031a8'
         '953708fe8a01fa009790ec13a6fcc4de'
         '3e62857297fb61175821c1b79522ac04'
         '19d3545fd52c59707b997fa35417d851'
         'f922c8d59cbaeb0c74af713e61eae26e'
         '9818305822c961e6bb0d5de72eddfb74'
         'c31898caf32042911c20ee47187e4558'
         'd7677a2e4d703637692a8db4714b82f5'
         '1a719eb1b16ace311c6c8f253cc3a99a'
         'fd8791dd8e41ffefcc03b6caf56d3371'
         '895b7264bbae69830420729058eaf0a2'
         'dab7c2607cfddb4522a647964717968e'
         '7ca79eaad516c7a3f14868e9eca5a47e'
         'f982e6c48873e5dde2dfe2f39a0d5956'
         'c60cb4542b68bdf428d6af939e54fed2'
         '88f243d3fad2aec138d267087ff83c69'
         '71beaa6cb956a8e9ff6bd0f23980beb8'
         '965ce4ef529ee844ec7dffbf1ab8ee3d'
         'f676d7ed9dc86f602674d45e3ee4f661'
         'c8417b15abfadea72c7dcf1e979abff2'
         '49e15cd74027c2fb49c4e0489a744f4a'
         '06e4169dc4ac908aaf4b7e0bcb441624'
         '549e2372932f442de2acfcfc2034ce51'
         '415bcd4535d42e2a3ca63ebbea78bc97'
         '2fa518ded097fd156f0d5430bab624e2'
         '749453283e11e0c599b03b1b58a1f7b3'
         'fde0ef7653f99396d32ebe52174489c9'
         'd4ba0495253d2a6e47e3178051e18f1b'
         '003c2ea85233db1e3b26d69262af7f3a'
         'a89c296a27b2b85c5843a84e4c71f57c'
         'e49874c7246480462eec7dbf1b55e350'
         '911ad4187d447ba55633eeda771974e5'
         'fccae7120e15c78f71ee1cf9f2c652b0'
         '9a16b1daa3448eba3b2524053c8969dc'
         'c305ba0e4f439afbe250d595e6a37bb2'
         'dc22e33cc6873405f3c03e86c2d3f902'
         '32c7a6cd57ce0e1247d289058b7c49bd'
         '14ee617dd6147abdaad0f06df8de19e8'
         '30704703618fbca552984be062a47325'
         '0c14d6a1fa8d6efcf1fb1064de7f98e2')
noextract=("${source[@]%%::*}")

_lc() {
    for f in "${@}"
    do
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]100.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}/searchplugins"/* "${a}"/{msvcp100.dll,msvcr100.dll} "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
