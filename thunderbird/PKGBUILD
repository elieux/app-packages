# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=52.3.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "kab.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kab.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
sha512sums=('bf701345e8c8d38b12c48715a26256f2d40ae9763cb34969ee30cc050fa3a3806eabe96e6ddc2f380ffd1961274f8906774e85819e0b077342d06636ef84bd74'
            'f42f1a6f6b43d07225d23d052781746027c22b864fbc45a05258fb74332c67521217ddddc1a7ca6ab27398b368921a6f71f210062f8b8b3e5bba39571eb14c0e'
            '7280ba535935e973d65518c3bc49bf6e9613507a23caffd8b9a33d0dca85dba62498b74b8a7fb96479ad51baf36af238cb45e75f5d312ea7138086530790acdc'
            'da5e98872444e46e31a213893d1074ac01b557a6135c612954c6ea1a5e9184d28dd4c04a75b61f269deb41b70fa67cca19f966f57d514a98039cb5abfac93618'
            '0b1b7faf0ab8a190b6ea6b8914572f65ae69b98911489beb32ff3919961d5309b9cef87b8416d483148155cb3e65c4923719f9d327c1f557589caa8f96aecd91'
            'e97d74b7b3156b7b4f64e6b614e6e118d39f66b1d6f314efcc2da41b206df5e75b898a889232a9fa241dfec383f056a3069aae4e9bd42c74a4e2a5dce9717930'
            '518153dcf0a079f32092ee2fd20cada4d83997a51a4855d668aacb76085b9879024c8c00f80b3ad4f8c90566e4488bdcb51d44eeb34f0816cdac30db9db04160'
            'c760cdb61cffa33f758df7d6a8da6dd4a03a4a85f3cf526fbdce68eba6eae2dfc8501e1e926d7fc3a5d733df2a09c34975473a7ae884e61bc92d0743e0895a7a'
            '28be1a0b811202c46ba23fdacc3aac7d69957b78becabe4b2ef857a2449a9d7cc04a0a64942310228ffe8292e25399185ee01431c4164a18b08e94c2e42606bf'
            '23f88e8e505b1bd3abe7886616e2ab905adf53f4e195f99c8aa9152610dfcdd3d07fe318c57f1cace3ca87d20674e61165ad67e89e9cd569630356d65d1d0f0e'
            '8e7342f853755fc80305f43632d902814f33eee9c11f0fa24d81c41c1e1a092d95143a4292010e2d8c1b63bd2f4e7e5481dedccb0e9bee9bdf0f2310c7726cfa'
            'bc1033e1a0fe7e9929c7c8286f9e7b54af8985e2c8cd8307e859f35b31aff6890b877c631d8cacace48bd728b9eaaa3b6cd6cf4a9271df9880805d5ea63e800b'
            'df059330d2525e3f292abf0880b42727719443068479cc9b8cf380a20dbad9387f3832ecda661890092100a8c119bae17d378b1a0657a41a64394310e34c4ed0'
            '163f407f73458b835a4e00965d27219792c804e6050c50f430ddc2ed1b1ec6ac385009b848598b67fe4ae5f2914397f1af1db2abef5dab765510c825b2fb1bef'
            'c1a82bc9f6d7cfb3965119295436c64d11303fcd6361f1afd937304940fe056dd95105b3747b2c5ccb470b6d9991860b975811e94209e99e03009851176635bc'
            'b57b88e692bba27c617056c82428044aa616e29c5c5c3885e09ee8607f09895f9a34cf1e3c8a0842ff723fd617adbec76f861dd09d6905a68c6408ccd5940f40'
            'ce25c843569ffe1ae563955dc72c964fb0da1f2511b18fdb52379ffeacc1f4a278579559bedee5db6b42f85c3e0b9919ccef45b770b43a050898c9cbb61c95f0'
            'b6d5a8569854deb1b8dacd05a20136d9a65a011896427309c0a55514b3e5a1596c2dad25528a287ddadfa602a398efc255bfe2a696e600c58f8cdeb2350a7526'
            'cc0dc93435880c9cd4c31c75c3e5c3c92d49a3ce168f4faa1c6ea4c30592e00f770d3b605e9245b415e93102383f072bc2279017f15d09d47b6bb7a27503f5b9'
            'e44bfdfdccd03327a7c921ec0d0ae6d2bded897035cccc42071c17b5a80b048c316640de536d1e1300fc27b0eab98e7f55942b0c720805c1736c96976644d6dd'
            '4d5e9e4cc6c1dbc53de17821b91214845af00ebf7413b2b610625a94f83d4fed4a695bb8108507fad8e620f1e171f2eeb9711e83abbdc5478afe9fda34d04fcb'
            '71802beab108a08fb3c0aefd7a33b5882b9b0eef536b09c2e1f7c7d81494ef2834ceeb9c67b76988853349aafedf9a1eecec9bd7004cffa113d9392aa535e841'
            'e9f92ba56b9e2ab4c717904cc86dba75451de873af090ede9be01ec09bea2fdb26f1990b6cd53f941f22c84a5f141aa68c4c6b5653f5fd5f240b27fba6edbf23'
            'eac01977097d595cafb077c1318ba397b136ea003824ecdf2bc10a35dac165615ac0c97803c326bb13da1f0173953c135782baebedd368c8c3eef270651191bf'
            '0f226e707472b555cbaf32d168a20675d7554f251f54896dba6a4abd196e25fbec6e9f9709dc4877fffee68d10d50a285da4778a65609d63cde51fa2726ba18e'
            'ea7977f249d0b4671fdb65fe9aec7bc18f4538b01854914263b8d48108013f4f61ed964df09dc09847261e05b86bc7410e3664b8f0d53a870c4f252fc550cea7'
            'e6ce1e24d7039f8ec94ad76722c3c1e339c33f3b105653ad90d558e3644967f39fee6182bbbf0642324f28e8a21030fb3790293f1e891864c305e8291ecbf434'
            '14980af035605bb063bf247f2a75c091f3bb350e2a0411cb8819d067edfeb7da77c1cf4104c868f5f9d011b0d11906822c3fb4664a7daa9cbf46750950156daf'
            'e19ffeddbff411250507e1e779596031aa573a9a4c710a90d6f571c62a4fd2dea2045c05da640f62678d22d19ce0c48d9212ff588cb0dfd568a680cc744cb3d6'
            'c7c087bdbb648fbb2077efc4bfc276f7b9058fd07bf50f8f02d8531d5c2ea9d9dabf6e2667bce50f94e6bb7c815d807011f1eec4b277edd5a8a18ed2304f50ac'
            'b2645e224dde01253525a24ad44ace50ce621cd4bcd092054d2090c2f52eaa493cb184da51893bf51833b954793458c243d6b16ebdb5afab687b0a8e4837b242'
            '2391988e14bd0f5c27a52650af4e17f5fa89cad65ab80a85f776097d72166487e3aca1b5fb8ae7b5731e98834c4643e9278aaa49755d497500c23b8073a85cab'
            '2df10606f63b885051594a04545eabb062edd98c9fa483f6901f8c7749ae9da095234c580d859a70f595bc1a3db5b226721db19bb1dfd10253f94e6352c92886'
            '93af18dec752bf69baf4a9bdd8c41eb0b0c635acb2c9dc7a96ef4537c971801a34e56c08829f4ddafcc7ae1a068771ff044f3c093438660e82fa94acf1c9df10'
            '98d7344467075c00007e165eecd7a4155cabe6308c4ebddd072e1a53cf29490a118739e24e87de38ac029b98bc1a30e4bea2d3513ff5d6b71d8a46fdf33eea66'
            '8e0abe40d3f3368882914f74232a3a308da254a3f1e9e95fa8773282fbbf72d9e27482504c527bb85dfeebbd23a9463072286bf915a9f81263a2ccb07a1662fc'
            '2dff4a5e6551f05627d838e1dc6bca93af434a0c6e72dd863b012be53798889f65fd0862d1f098bce7f0fd6683fc5f8f628d8855026b03bed3f4c4551a5c7de3'
            '54f13d1e16d2f977487bc9375fc1a18f044b84aaddfebc6542d1322a2efd55a6e611ce3e71caa8f9183b8adf78ba68ce7ecb3b4f036be647fe4c77ca6b9b8f85'
            '873be663211197de3d3b6185c514e7f0713e684daff68f55bfa6ec5960f3a29d7ebbe5242455b4598f3c8c9c77db25692501584d07a95c55e265f14169f79bf5'
            'ddbbfc0c1979fbef52263848056cddd5b0eda9593333aabc7251e8fc8e731e428a647231b6f9adc2d5bd12d16e983ebf66702c8ba135243ddeed40ffe5e70878'
            '9b6a13d9f18a166df9bd485f08e2aa80c198f98b0bce1dddfda2bc0f0c73d03e06250f2737435bf2211a61cd88b5336994c05cf927486ade43d0bd074a357e75'
            '93494227744ea51e29b750b0980d0594c72569944d1629138eacb94db597cac25b6a149c23b47b99f88891a592c9e2931c738b9f11cc6c450a9de14eaa0908c0'
            'db1b5733bb16de35395c9defc8595c95d1a079967839a17e84ee4f898a40c1b93fc71d00e0126a62b64b5023f27031b68642a6ed304a7e5d3c105cf3890e0be0'
            '9013ec75855e58fc9fa5c03dc8a00e46e857c9d7d8556e84ae79a361ca0e0666df6cb86874eab5ce7d193c893f929180b5bb9eac8fcf7a9fde6736df7a4db955'
            'ba13ec32c92df2a980d0a9ed34ad9bd28a7b6f1eac3aa76be1147978a87c51ea11b050ba3ad289fb151172ac988554979b5dc9265e6e8de079ebbfaa21868e51'
            '3ccb95b5b01106d9d01b793d835a0b6116faed89056f31f526c6ed0a981689be66430155a3f447123f0468fb59c267b18f205c6e9d51bff0520598faa75756f2'
            '0232c9b4d50fc3cc995fd2d47324dd49703ea2d3424a4dd8da248389042d7830784f88b0a3dd8f0aa71a0e58f0af262f4ddddcfd05da2642f985824fcf03e460'
            '085e7d1c61cd85545e65e2e5d9a70789070332af4c142ba6062bbfc6c572fe435813baf2fc22a340565aa95b6a483efac8d728d912ae94d58d573e1dbccfeba5'
            '9b42d8be39ef4dfb18ed5c6050ea01abb3f05b8fbda0d87fbb893c7b3b0ba774c424d26d95f37a7ba5f7bce9213459ae7d6ccebc13182549038a6c5026ee0745'
            '1276afe25c2a80bdea67cbbe3863d6104a53a9a2ef22e151335d3a163752ed2d0b11e2f4661fd9ac7f409e2b7ce19879a1fd96d4826ed6ffc918ca502dbad79a'
            '2882492c1aa1a90c591ba6935cd19bb2f85b94569ced83447cdbde65cdca3aedb170ce84cbe5cee7427246c29a17a97d7d202147c37885b742f1a6210b9c57d5'
            '8e3babb612d29dbba6cafdaceaa2aa1aa8560cc14757f8580ffa3ec0e33aa861aa6940501a1b3cd25b9dd25ae25914ed9c8f504dab5ded80fcc19e1ef281a838'
            '47bae861e7523c8de6ceae6e58d386f6a5454ffb12c0c8070afe3953e8e637fed42a502470d12b75c6f2cb71d78f5cbcd92d61b3ac1253c04ab874d5a04d5664'
            '579b3ed5bf07b5354cd8f175449e873c28448e1cdac31be104d77d5f086ec993fcba647245882c541aa81683070a7105c3f8178998e03f73ed8b0251803aa3c2'
            '03e0100cb4b17fadf9a34f25cca53749c790f9ec95d4cef5d0330bbb04276bfe7720f9c27172a8d776b4b2255e3417d1ebbdba0de185c7edd09e0018f9516089'
            '9384841ef62cf3e69cc8c9447e8bc0bd092b944a38d622e68cdaf7d66510f0c0da55e61cbbd11dd5390360f1380ee2c45abcf09d776efde994eb77504cfb50fa'
            '95a39622e31a9f9b4a1daa9fc859c32fd9f2c9296b36c448b552834fa9d3c9eab7ee6f7f659bc4bd7e47a5b095aaf671b1ee6a0e6854f223be22b4168a4ebd0c'
            '1778bb1c99000a067cfe810fd6c89eb9c13da078ac6e88afaa6f6d198f9edb831cdbda2786f68bf88a578ba6284e92a5b07a21c9c5bbbb21478521a8f9f57fcb'
            '955e2db7c4e1bf7ec27a70ccdcf2b08576ffb47cb3a9f72f0765bc828fc08821a9e881760f7c91c614542f47b4b4256eea139c6ef1dc22492bd92245935df399'
            'e488c830930e92656f3991e3099c4b5287108b80fff57efc63bd41c4c0e4f4c92057a0ab9dbe6e528db234bc2ae0cbde2add724350420fe7b119e06e4f7fab56')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    sed -ri -e '/(VCRUNTIME|MSVCP)140.dll/d' -e '/api-ms-win-[0-9a-z-]+.dll/d' "${a}/dependentlibs.list"
    rm "${a}"/api-ms-win-*.dll "${a}"/ucrtbase.dll "${a}"/{vcruntime,msvcp}140.dll "${a}"/maintenanceservice{,_installer}.exe
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
