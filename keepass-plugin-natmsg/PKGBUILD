# Maintainer: David Macek <david.macek.0@gmail.com>
#
# To get proper proxy detection:
# - in KeePassNatMsg.dll
# - class KeePassNatMsg.NativeMessaging.WindowsHost
# - ProxyPath getter
# - replace with: return Path.Combine(System.Reflection.Assembly.GetExecutingAssembly().Location, "..", "natmsg");

_realname=keepass-plugin-natmsg
_choconame=keepass-plugin-keepassnatmsg
_dirname=keepass
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
epoch=1
pkgver=2.0.16
pkgrel=1
pkgdesc="KeePass plugin to expose credentials securely to a browser using Native Messaging"
url="https://github.com/smorks/keepassnatmsg"
arch=('any')
license=('GPL3')
provides=("${pkgbase}")
options=(!strip)
source=("KeePassNatMsg.binaries.zip::https://github.com/smorks/keepassnatmsg/releases/download/v${pkgver}/KeePassNatMsg-v${pkgver}-binaries.zip"
        "README.md::https://github.com/smorks/keepassnatmsg/raw/v${pkgver}/README.md")
sha512sums=('2edbfbb659c2253bff00c38b985d7ab8fa13f0148afec2a704db92e997d0af5704b42308b69fe2d2b65f1163382d722668db1bd66c8d4083961db578e1c30856'
            'd5f5be009fe4122c0c6a2bec62c734e5e133738e0938d33c39d224a8bf10b2f3f6fad54b6218603c7e47c3d0cf6f10a2d007050770cecd4ca3a3486f83c70de0')

package() {
    depends=("app-keepass" "app-keepass-plugin-natmsg-host")

    local a="${pkgdir}/apps/${_dirname}"
    mkdir -p "${a}/Plugins" "${a}/Plugins/natmsg"
    cp "KeePassNatMsg"/*.dll "${a}/Plugins"
    cp *.md "${a}/Plugins/natmsg"
}
