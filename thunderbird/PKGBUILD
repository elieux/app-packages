# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=38.2.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird Setup ${pkgver}.exe"
        "ar.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "da.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "el.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hu.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "ko.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
md5sums=('af0db1f2525d9145243357b37b9ba3c5'
         '5c53e90e682c46d322bcefff0710ef77'
         '33e779f05953a6b7e05891426d6ebfd8'
         '563c5fc6561772b82abb5c3fea56d2a2'
         '93dde62b7f5f740ef48d0121f8c47c26'
         '0d9aaa26ebca2d2b13edacee2ec74456'
         '7ef4462c5f3b079b50e11e89dfe71360'
         '2c34c8d6406adb445e6c341397507532'
         '96aae61b4784212ae5ca78733a8056fa'
         '748f3f57ab607df7cbe5b2c228a8c7f8'
         '70824fa044fcbd3d52e181cf546d98d8'
         '823139b14f3762b85baba2923f8b676b'
         '36ffabb84c5336165d1fe50324bd0934'
         'febaf1f33753c6ddd7a10ff92c854459'
         'c657cd86f8accb116ea8c01ffb6611f1'
         '5a8eca4b9bbf42fec0150fd264bc6606'
         '78c52e8e854e4c35c7fc16d02d12f7e5'
         '425cf3fb4e22f928ab8564a4cb1e49b5'
         'afd74ca6cd12982cde0945132b666d9d'
         'b56dab4a1ce202ac3ad3a698c9342928'
         'ff8c543eb5a9103209f515eb977d5562'
         '1dbc3b00412c9eefb747345e15839553'
         'c66acc762f44ee4e58832fd1d101b8c3'
         '17e7866bfd0605d829afb63ace2db967'
         '1a89b295c57ee73d81bec680048fb793'
         '8b55ea0233e8da6457c3e3d8a231cb06'
         '8ef703ba0441ce36562620cd8eac0329'
         '2fa905139481544c32aca7329fc06729'
         '95b8cda36e126e2babb0b0b283cdbe7b'
         '529f656bf3a122891b675880cd4ea8bc'
         '73cc3cfc4c39244299958f2b8c5e2ed1'
         'b185f4838ac6f06f522f25ba85b4969b'
         '7247d94260f234de85801cd27168c953'
         '531eb4f520651f9011856b1a2eee02dc'
         'ed24947d82c5395afe5809a504b304da'
         '974da7378a7ab39524a9eb831097cde9'
         'd95fdb3fe33fe32af972fa9cc2c8985e'
         'c5fae29a623bec2e3771de8963252d31'
         'bfd12ae2d9072b20be35bcbdc549dbe0'
         '77a5f703a22ce7cca2cd4f5cd73e07b1'
         'cf24bb81fb585c47de7121b00ee3de3f'
         'dfd257cbfd95ce10cba38939fcff541b'
         '65bdf900bf742c20b75d2444256f71dd'
         '41bc874aeabb964dfede11e1e523b5a9'
         '7bd605c3965c7d21f29e71ffdac49e34'
         'b0e0a5714f923fe03e5cfe8b3c1fec2d'
         'a4c4d8478e9e1b8f851c7dec5c37f080'
         'de428b6292b9721f436367589cbd9648'
         'b58c14e3e1d9d387e5782842b6c5dd66'
         'adfc96412de3af7595e8b5d4571e4be4'
         'bcc4ef7927e86f4644a179ab4b02b69b'
         '33f58fd1d4944966323aa81e0bc17ecb'
         '788aea2cb22186bd0aabbfd6186cb420'
         'c2a726e6d84a26c52c6d7a830bef8e2c'
         'eda95aaeb5522676100def6edb8f106c'
         '7e965a4d24f30045631a767499964aa6')
noextract=("${source[@]%%::*}")

_lc() {
    for f in "${@}"
    do
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}/searchplugins"/* "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
