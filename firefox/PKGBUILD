# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=firefox
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=38.0.1
pkgrel=1
pkgdesc="Standalone, easy to customize web browser"
url="http://www.mozilla.org/firefox/"
arch=('any')
license=('GPL' 'LGPL', 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("FirefoxSetup.exe::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Firefox Setup ${pkgver}.exe"
        "ach.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ach.xpi"
        "af.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/af.xpi"
        "an.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/an.xpi"
        "ar.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "as.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/as.xpi"
        "ast.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "az.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/az.xpi"
        "be.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "bn-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-IN.xpi"
        "br.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "bs.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bs.xpi"
        "ca.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "en-ZA.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-ZA.xpi"
        "eo.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eo.xpi"
        "es-AR.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-CL.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-CL.xpi"
        "es-ES.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "es-MX.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-MX.xpi"
        "et.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fa.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fa.xpi"
        "ff.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ff.xpi"
        "fi.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "gu-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gu-IN.xpi"
        "he.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hi-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hi-IN.xpi"
        "hr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "kk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kk.xpi"
        "km.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/km.xpi"
        "kn.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kn.xpi"
        "ko.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lij.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lij.xpi"
        "lt.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "lv.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lv.xpi"
        "mai.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mai.xpi"
        "mk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mk.xpi"
        "ml.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ml.xpi"
        "mr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mr.xpi"
        "ms.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ms.xpi"
        "nb-NO.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "or.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/or.xpi"
        "pa-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "son.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/son.xpi"
        "sq.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta.xpi"
        "te.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/te.xpi"
        "th.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/th.xpi"
        "tr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "xh.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/xh.xpi"
        "zh-CN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
md5sums=('363660b7dd4e29d1938a778176607993'
         '827f1cdbf40764de238f615102d32eef'
         'bfd5aab5bd40ac1d904ae8a0a4de9ea8'
         '21c1cd04f33e092db232c4f9acb58603'
         '89a9ce5b3d05d7ea3750c0e846d76fb1'
         'c0c927d1a477c88c08033e63da6e4be0'
         'f5815f9eefbe4cbda8c824e8bbdfb9ae'
         '4873b1bec1720e6d399be229062cedce'
         '48c9dc23d50ce926ac6f4357758f5502'
         'd4a1f18a8e73803076c5bd9d970c6966'
         '17aebfedfc448f955ec7dbfbeb8f6090'
         'fc7c4c03f3c925fd9c999b9ca99d5bf5'
         '7ae49926ab02a214098518580bf02f1b'
         '9bf79ea4e86559ce8d0af13859ea56f9'
         '6ce2a3c0cc82b1618a1d02411647f7e7'
         '792327e9255f918b9b71f3480b326127'
         '8db4ec5d489cd25b3d76e416e453c9b8'
         '88b9c9a6b40faf617da4f55257559f15'
         '1e20ac7904b92a4c9ec77ae325c6cc55'
         'ef8ab7535fe233c739d5306d5f41f533'
         'b183188da51c701058afa637d8463b08'
         '0c671d893e9ce8817ebb7c911e9df15e'
         '280c0538d23176b9c4c77e638de16e48'
         '33dd86a7df6b93016755c4e1c5b4b7c6'
         '5ad30c07b7239bb2c766179d4f937a54'
         '003682141c8e3af94d90c6957974a22e'
         '3a89e2ded307971c42ad746e0379967a'
         'e1ba22db66abd332aeb8030eb5a045fd'
         '2c844e248ddaf97baf3f9187de6edea4'
         'de40751303d2a8549b0eb1cc42403141'
         '54438897349f3dc4ca74c8babd1c1322'
         'fb219047592427de433bd3a8240c5176'
         '811eb33f6f97b8bfde10019770b3bea4'
         '998da241cbb09f0db82c28e0ca4abfef'
         'e15666fcb3c068e0260a0af76626179d'
         '5a7157a69499ea8c3e88f1e7e1659adc'
         'fd2eb6151326041dd3419ea9a9be00e5'
         'f284fc54b2a092a699617527f6d7107a'
         'd406844472b7628376ccb3759fe04ace'
         '07e0443d01d8ae81a0f39dd716b0e815'
         'a11e435026259d3b1f762a8f7583b3b9'
         'a8182bd2be135d430b5485ff0e3ac266'
         'e0216ce5956b20a5a29f3033739ab490'
         'c001d9ca3e573182f566083c710195f0'
         '712e04246aafb5c5fd92f9236841c527'
         '18016df6ed6daec778fe740d586f909a'
         'd10ea49eac2d31f399c4eeac9be6b0cf'
         '40e818556aaaa52d964da0624ec1d057'
         'f06a52c7f7c38d99ed70a87e287ebfbe'
         '19e17a66bee4b2280c8e1d2b918f5902'
         'e762f5cf8122c583680e60be229f1297'
         '3b1a573e3ea685381b45fed26ec8d69f'
         '72b258bffc23d1956e7fff54c31f51e8'
         '491e0d9f5cb9eb8b656f2e02b4e06066'
         'f5663f5c6090f882e5ad37c419505765'
         '1efd11de5805c062ac251de7643f107e'
         'e5676ca843b8d8e925601cef4d714fe4'
         '24119f352ab99a9c0137293137c1a0bb'
         '044ac908168e6ad64fda01f1deb0e4fe'
         '2904cba1e4ef359028ad399a5f8253d0'
         'caf108a3a28319dbc484871e643d5165'
         'eaa33a94cd7bc6b0d25bb164b07ec394'
         '84c46156272daff3da049ce63a0d3529'
         '9999688da6fd1164f9f4556965a7da10'
         '60be872b50d981ca35712b8863ab8345'
         '0f5565ddfcc13a8960b52dc1f04f8230'
         '4364ea0a2aed91ae2758247dad7b35de'
         'cde4ea4dc55c0a8a0a2350fb82140cfc'
         'd9a03413e3edfe67ec888e6b39eddac6'
         '41749b2eb17cedaa41363c43eb6cd3e5'
         '870d52f2f186866ae2308eb56d47929d'
         'd1a35e66a78f54418e1c6faa517bec70'
         '90709ac9ba3b200a01bb2cb0bfd5f621'
         '5bbaec7c7e699b680075fbe97f618d02'
         'd7d5ddd5c2b8d574ffb88ca96e6a3226'
         'cf7e94c5ce05d6f91aef069eb419f2e1'
         'fc5a712774755bd931477db377efc9b1'
         '0f1d4a21fb39484c39c5727f5b3e1065'
         'b6e4b48325bdb34935089b5922687df2'
         '9d5d2b1d5b640f8f3adc623f59d071c3'
         '26f261f739b3a2fb3319f2150ca780cc'
         '602f2ca89e9c4ffa671a4da8d5ae922c'
         '54c2803c8ca149b5147dcb00658ebb64'
         '3794891550b0e9e442654dd6413a812d'
         '599bc5d97f28a85a1d7054557dd9b520'
         '13f4c4cb747ae15217a68b4e33832ef5'
         'e12a415f4417582e18796db6ddef0e28'
         'fae87eb199c3580547464b3f052ac1e5'
         '018455d079cbd7735027629d94afabdb')
noextract=("${source[@]%%::*}")

_lc() {
    for f in "${@}"
    do
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "FirefoxSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}/browser/searchplugins"/* "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/browser/extensions/langpack-${f}@firefox.mozilla.org.xpi"
    done
}
