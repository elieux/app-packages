# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=firefox
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=40.0.2
pkgrel=1
pkgdesc="Standalone, easy to customize web browser"
url="http://www.mozilla.org/firefox/"
arch=('any')
license=('GPL' 'LGPL', 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("FirefoxSetup.exe::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Firefox Setup ${pkgver}.exe"
        "ach.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ach.xpi"
        "af.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/af.xpi"
        "an.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/an.xpi"
        "ar.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "as.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/as.xpi"
        "ast.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "az.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/az.xpi"
        "be.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "bn-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-IN.xpi"
        "br.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "bs.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bs.xpi"
        "ca.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "en-ZA.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-ZA.xpi"
        "eo.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eo.xpi"
        "es-AR.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-CL.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-CL.xpi"
        "es-ES.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "es-MX.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-MX.xpi"
        "et.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fa.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fa.xpi"
        "ff.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ff.xpi"
        "fi.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "gu-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gu-IN.xpi"
        "he.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hi-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hi-IN.xpi"
        "hr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "kk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kk.xpi"
        "km.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/km.xpi"
        "kn.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kn.xpi"
        "ko.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lij.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lij.xpi"
        "lt.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "lv.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lv.xpi"
        "mai.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mai.xpi"
        "mk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mk.xpi"
        "ml.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ml.xpi"
        "mr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/mr.xpi"
        "ms.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ms.xpi"
        "nb-NO.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "or.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/or.xpi"
        "pa-IN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "son.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/son.xpi"
        "sq.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta.xpi"
        "te.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/te.xpi"
        "th.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/th.xpi"
        "tr.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "xh.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/xh.xpi"
        "zh-CN.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::ftp://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
md5sums=('a9a79980c12faa085cac72ea01e623cb'
         '90a209f62969b15e07ed9999c19f85a8'
         '71a4bf9adc37070beb930ba4f82eb04b'
         'e24847823aa06c4c6ee7580b7bc47024'
         '67248c1370b1e3ae482d5d3c1dcf3cb8'
         'c162b41144dadc70972f67ea15191803'
         '1976495eef45938958e82c7140314d9c'
         '6c8c88ce18d509e71913179b5a4d9780'
         '70ad9c99a3cb8858cfa448bcb7da0567'
         '9a7baa950eb17ae952e4dd2cb6be7719'
         '678be8cd41ea5c0497c60d90dc0a2452'
         '47d77b747aa3f6519a23d0da06af1cc1'
         '2a63d00d17767e048602f00827d3eff1'
         'd57d96d1f10c35d5f642d080f78c7767'
         '77482893925e95980a041bbf42b29ae7'
         '7365572c194d06ecd3f60727749029db'
         '3eb663146ed4ac078cac7b067cd1c8fd'
         '1b71cac5b2ccc3f0395f56617ec24d80'
         '8f47f901ec82eeacd257160f91e5e025'
         'cebec60970badde7204d9e977e83c19b'
         '6087c541399e6798c7199b4e6a1238c4'
         'd75c2d6e9b28f256baf014be7670ff0a'
         'f813cd105e0b4b1d4f705aee1e6877e5'
         'c931b1253eb02bcfcb24b6a690e45c26'
         '3ad2892036d0414cece78940185a0962'
         '4b7a362d53cc1ee047b654b60b80c73f'
         'c3470b951c66b88e6e6182da185d8e53'
         '77c40e2ce190696e903dde08a5b22691'
         'b8a614eac6a1c18fffb9b493d7f74c7f'
         'aaf640df8c88929827534da5d6654c12'
         '3a2ade500147efdaf0d98f2698ab16b2'
         'ab0aa08296251a0bff0e4cc463c71a54'
         'a5f10433f26d82b72641cccb2f6fed60'
         '2ed10d663c4db603a2535e2b6c5843e3'
         '5fe7c516d8ea483a24cc05b45d7f2cf8'
         '74ec33c1b9c02460e264f927bcf2207f'
         '403fc2984be18bdf3060268681bd201e'
         '02b67aace9cbde95d2a86e4740e2740e'
         '7c1d66f9ed739644a7075c2917f17c55'
         '014acb40af4354a0f7f007d8c720c0ee'
         '460c2a076b70a277e0f8b74c3a0970a2'
         '8c0c745f9b99e6715574d5a5df7d5416'
         '50633a38122f61de2b5d5fa82e53391d'
         'a17512076098afff276f2a05c512addf'
         '54e72a6579b91ba06ef238fdc34f5c06'
         'd8e9e26e44dc2a3aa101c907f6f10b38'
         '2822f6e0b4e9417efe848b2f98a75569'
         'e94b0572d72e24a50a1f4fb59fbc7799'
         '10cfcdc6e4b66c96206d2b5fabad4614'
         '34f878b087570287a905f0251acb1602'
         '492abd139a4fed4bcf199843e8d2fbf0'
         'a1c39277ae1bb0cb074a36818fb71368'
         'a2b5667b8c9994de32f5d13a276a5f7d'
         'd56818810aa00e87f2b958472366f36e'
         '2e2dcca6b6fa335ddc3a95b0d9c8b233'
         '155846397d314c7ea8b95685eaec2314'
         'bd292835cee7e0f4b1a39e9bcc9144f8'
         'b9368aa944680d07125d6c0ddd630e37'
         '0abfce62160048b731c6625d41a61a03'
         '8f7b7aa44b2181cdd2a18242504010f8'
         'cf7ca4d8539259dd53c4a59e42b7d3cb'
         'e21967f1c884c8519101d47ef28599b9'
         '7182abf6d0ded7b406a6a682829b4ce6'
         '073aa248961f80b7b60e7c263e1a1636'
         '06e42cbbc370049e8962e9331753f7c3'
         '6c4e1ee54027851e05459b6d4b5369fd'
         'e2dc2e6ecc2ced3e80752d7d1d39067e'
         'ad1f67d90d46bb7e109dede464f279a4'
         'fa76e6b249800f76cec4d2f7beddd669'
         'a32aeb58d65f0fbab417f039987f636a'
         '5622a787fb12c15449c49b62adc5c26c'
         'a27154dd0606af6a5ace10ceac5953a8'
         'd968c8fc613b4cff73c518a561ba0186'
         '98409386a625f7491f9df3f7fd69d97d'
         'fc8091b759dad23e80a9c0e04e8c56fd'
         'b4502080d97f51100bb385728e7aeb22'
         '91cf8956e14513747aafb14b2bd1674a'
         'eefbe777bbc99f2a89f828660e0b580f'
         '50d9ccc0955b31c90a3719e669fca190'
         '5666ebd4aaa82e9387d9a709e503aa9d'
         '5d5f549dad3ca1760f361e87245288c3'
         '1f76d328eec82d1ef332927e0dc5dc6b'
         '33c1aebd7b1abe19f1b88a69086ae403'
         '04a61f6039b9333bd4b7354604b2572d'
         '3793a966c458303796088d541ed95917'
         '8baaf0e86897721de59b59b383ef7ab1'
         'ed82209d03482879c6aeb744195433f8'
         'cebd4a35a8b4f4e0420838bd1938a59d'
         '441b05d168fe2745f1847afe6c411ea0')
noextract=("${source[@]%%::*}")

_lc() {
    for f in "${@}"
    do
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${f}" "${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "FirefoxSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}/browser/searchplugins"/* "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/browser/extensions/langpack-${f}@firefox.mozilla.org.xpi"
    done
}
