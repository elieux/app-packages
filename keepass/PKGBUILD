# Maintainer: David Macek <david.macek.0@gmail.com>

_extract_subdir() {
    local _file="$(get_filename "${1}")"
    local _dir="${_file%.*}"
    if type bsdtar | head -1 | grep -q 'is a function'
    then
        local _original_bsdtar="$(type bsdtar | tail +2)"
    fi
    bsdtar() {
        local _extra_args=()
        if [ "${1}" = "-xf" ]
        then
            mkdir -p "${_dir}"
            _extra_args=(-C "${_dir}")
        fi
        /usr/bin/bsdtar "${_extra_args[@]}" "${@}"
    }
    extract_file "${_file}"
    unset -f bsdtar
    eval "${_original_bsdtar}"
}

download_https@subdir() {
    download_file "${1/@subdir:/:}"
}

extract_https@subdir() {
    _extract_subdir "${@}"
}

_realname=keepass
_choconame=keepass
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
epoch=1
pkgver=2.51.1
pkgrel=2
pkgdesc="Light-weight and easy-to-use password manager"
url="https://keepass.info/"
arch=('any')
license=('GPL2')
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::https@subdir://downloads.sourceforge.net/keepass/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "TrlUtil.zip::https@subdir://keepass.info/download/v2_trlutil_2/TrlUtil-${pkgver}.zip"
        "KPScript.zip::https@subdir://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"
        "KeePass2-Arabic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.39-Arabic.zip"
        "KeePass2-Basque.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Basque.zip"
        "KeePass2-Bulgarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Bulgarian.zip"
        "KeePass2-Burmese.zip::https://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Catalan.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Catalan.zip"
        "KeePass2-Chinese_Simplified.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::https://downloads.sourceforge.net/keepass/KeePass-2.44-Czech.zip"
        "KeePass2-Danish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Danish.zip"
        "KeePass2-Dutch.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Dutch.zip"
        "KeePass2-Estonian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.38-Estonian.zip"
        "KeePass2-Finnish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Finnish.zip"
        "KeePass2-French.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-French.zip"
        "KeePass2-German.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-German.zip"
        "KeePass2-Greek.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Greek.zip"
        "KeePass2-Hebrew-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.35-Hebrew-b.zip"
        "KeePass2-Hungarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Hungarian.zip"
        "KeePass2-Icelandic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Icelandic.zip"
        "KeePass2-Indonesian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Italian.zip"
        "KeePass2-Japanese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Japanese.zip"
        "KeePass2-Korean.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Korean.zip"
        "KeePass2-Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Latvian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Latvian.zip"
        "KeePass2-Lithuanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.46-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Persian.zip"
        "KeePass2-Polish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Polish.zip"
        "KeePass2-Portuguese_BR.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Russian-b.zip"
        "KeePass2-Serbian_Cyrillic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Serbian_Cyrillic.zip"
        "KeePass2-Serbian_Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Serbian_Latin.zip"
        "KeePass2-Slovak.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Slovak.zip"
        "KeePass2-Slovenian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Slovenian.zip"
        "KeePass2-Spanish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Spanish.zip"
        "KeePass2-Swedish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Swedish.zip"
        "KeePass2-Tamil.zip::https://downloads.sourceforge.net/keepass/KeePass-2.49-Tamil.zip"
        "KeePass2-Thai.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Thai.zip"
        "KeePass2-Turkish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Turkish.zip"
        "KeePass2-Ukrainian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Vietnamese.zip")
sha512sums=('f862807e1568d42d1558a001230ed3b8d8db80c1ce9bb19be9b3053a3f8a999111a65eb19f0bba350ec30c86c3b0372f937b0e5d31f94dcd08b2109b6fdc9528'
            '703786dcde84a11076cc6f74acd60d1c15c754a85726a8e2ee3848b5a53f0274ef9e26d42a7689bbfbd21868586d470c6f9ddd17391557edc9b7c655bced4ba7'
            'c529970242d9c766dc25dc74b52a09fd92c5f6c288db72a1d5c694dfff1abaf87d64d3c7be6ac3a3004ba6969d00f62ab5a525a4a45fdf067d16dd921462efed'
            'be3675bbbe47d929a1ca6c5dfefd31b674c7304cc4bfac914d5be9656937554919478feb363fd3a51561bcf879941fcb54b701648057422c452bf677d500a839'
            '44eacfbbdf36938f992876689a447ce72a8f6e0cd8af84315ccb40fe86d4a76203a61a24edf58dad39a857366628ea5cb6cc84f2f5897ced12e89da18180d02d'
            '5eda910e2d7d7391506f27ad0f2e53099f024fe2741b6d259393a870933aa659eea8806d012a5a987c6109cb6fef440cc47dc62fb892215ec96eb9ec77d3e180'
            'e86fb2273f33e2ccddc4c6e52e8bb7100ece485e089d7b0d3edecc7a34fa50786e774d63b11a24422673e628db40da4fb93d7626cb34f95ac382fb963e74e8d1'
            '8548df07918d101548e828e038bda9c593f909f17cd11cb568c987094b19ed66306f79e3e58d3128a3aeef20deb7061f9c1f1fc001e28aef355b42ec75a519d2'
            '13e3fc26f228ce632a85b97eeecda0b65bbf7b9f0b8a6e096910f6155118b1e44169bcc01ef21cf8a43b7d2c3c2a5690e00dc03ff293865747ab7fc58f298491'
            '8e94f5107735abe1c22bd200bdbc2aecd9d6daff1990e5fd4b2068902471ba290857fc98cb84a691c854f2d3539c7516da59ae6e35b97b9594acef9ea328e958'
            '2adf85960a72010dc3ba5b859b2774dbd093ee4aca452fcab31277e7085154fc4acba7af44b4183c9f86b12bc4060cf06d9f96fb3f836319ddcccefc0f6015cd'
            'a3584859709ef51bbf68f1703eb82178686d1694bdbf1a8ad992f6023bcfe67269313e1279e75c5450b59e693037dd93ab87285c8f43cb60e2dcd75bfc216020'
            'f0e38f8fb1a82ccb41b64042107814f9ec9774b7028f9003ab293fea8847e1b507ce120053905e1bccf79d6a4eaaa2aa8cb6bfe392db8071d700f3dd339992ad'
            '21bda17b2e01f2cd42740ec10b28ccf073a56d2c462de0e07634ad1ca3facdfba737750811f1fafb69b2e38d180dd29aa46fdf4f71065e5e80d7cb80af014530'
            '80487152dafd374a91db9bbd906e9d0d901685993f654ebbe8c2b0a2cd7487de62c0af6c0b36364555697c63a372de87a97c57a8e00971c8b9db92f7849f5b36'
            '2ef568588a24db4777969f35afd5e803989ae4814bbda6c7fcb674c0b40791ba43dbbce3613f05324d7855c519642e10d7f14397fea7bc95b1b208afc1a62648'
            '2b6e89777d5cbe16ce171c779dcacf2c4fc864e69bf1c6adb814a39de22cce73df67e884d2c9b401b57e9843433c1ceb6c0486a7ff9cd07c687d39070995de0f'
            '6b5cb01124401ca1a7bec8068a50d91a9f5177ed18157d430ddc3823266dbf26f2161a2bd1ef039125e8bce89b6430acfdde861c100bc45ae301cc82fc392b63'
            '9453ec173cb7de3620fed0645b647701a661bf12b94f001aa9166e301a3c257764e03a67fca53d8325f801b4b6ddcb0216a8160bb55dc25c8275336ca3c2a79a'
            'ac15c87901e9302076c1314135672b27515b79991fb13c485b07ea454d2c93048f830abe3e0d29ff6cba24a59cff47f3fb8a704851ba81cbb70f96b8808f9494'
            '6330ec5779b877b702badfb813cfb28c32b6bbbe4f6271586f39a7f166eeb10228c31af0d5e4d98e7c0f8de48525d4756663d562f184ff79b2ce8c91dc2bfc9d'
            'cc1b404c05030f77a004ac0db7631779510d19e64650848496048b64ff6b6b27374ffae1c0664690402545e97cca82e93004e2c494a6cd842a528f17f55aae50'
            '3392ffd64a3df314f04474ec25d2aa0d83d8916e4e3ef2529e7a42ec8ab6384384a0c246865a2b97ffcd69579fd3cd9c5b40a20b9cd365b727ac0775b12a5a72'
            'fc4926c62a7fa7bed1394535b7245b7abe3ac33af5f3e06bb6358dbf62fcfb967e4528f85043351ee1e030960627abc74afb8f6b145c6bf3ce56f81691ba18fb'
            '663e38556ca3fd6e345e15d4ea08aee79c9c91274bf03dcf2b9a716f930f093e5c61ff9e5f613cf320fbe97a38f5945b7bb00c3513ac984ab516032ae6904cbd'
            '184a78d7bcc3202d2e2dd4381014164b59e9dcf734c3aa7a82bc4e85860c8ca660e71468038b4d812f369b6845d65281431eb65dcd025f76df51196f32da6e6c'
            'd4ed195f7425699a8e925fb8ee82ed1c3b3fedbf9d6728be330ba9f4474decf12e2339960cadf52aae5fcca5a1007930f1f6edd888e4f4efbbbd57b39055e223'
            'af80a6a57248c14ef710fdfac05531d42fe937105e62c15de4ecf16185e998b2c8719b4b32e1eb4bf1fc0b7cb577f97565a94d20778efd5ab65b59c5baddb3c2'
            '63d6c9cdcc615454040d2ef9172c23da80807319d89126dcde24f6e5d34a7f4539353f429ef13dc9d9133ff2174864dc14ce25ec5a0ec94980bc51e768ecc2de'
            'cd5e00e59b0d681f1b80c20734ec06ef9d317320cb56425ad2dfc55c4263c4bb16def97a2c4c7761079153abf8760dc32335a5bf26800431bc099e27b9c9d022'
            'd09412be0abb999e698d7fdc706172d4c09a52abf8dcf8a44c27ec3f3a2d97765ead60c3efaa6ba8951eecd78fb6a12133681a35a671b7e29a5f6e89a0c44908'
            '17c185bbc43090d4d22e137441e97c868c4cd6417d120bc72509b008a85a8b0eab0ca0b4e4f7f3e8030b01dc0b5e126f2d71108f176bfef59133e43b651b093a'
            '8022561dc66a39a07fad700fcdc741a83030ae0e750c5f1e60c5926e243d91e1edf1c676770d488d948774744aa80c167eb113e43c97dd98c9c814712173c505'
            '35df6299181a69623cb0f00fb974c1043b8c1f2e14e9ad322dc84d62d4c7fbd53d7be36db9922a943eaf13e143bf6bccaebd828e79a4d3901af3755dbc3a7e4a'
            'bd423ed175d4a1fbcdcb6be29072cdfeacbf68875bc13b27781b5e2b8fea849016107e44fe05063d7a5f41241338fd1ee73d2ee3cc5b65005c2c28567726c16c'
            '8ed8d160c0f3bad225e2809b8e323e4915a929c9f390c7421caeec57c4c2a0fe8d007671c1c06a97d68f68d339871ad1fec640eced1b8619f8c67fc064fccbdb'
            'c5b393380b0ddbfe22ab48c4175d963a1d0e730afbf1835696708cf542ca30ead26b65d42628cb0b8fcb54ed1a545177ecb4720c21a2f86d8af4b0f3f2bc81e9'
            'b6a419155d71aded652aa1549922ef7870da90bab1878c83b6599d2cffbde142d43d417d56162bc1c1bbd2adfd3cb490bff2b806c918b95720abe0189a3347eb'
            'f0458271af286a22a71a44a917b03531a5fdc6e80010699022a32df1c52b685330456b9e5c2e3f698016dfc7bf322fab3f146b8b454922c1042135deb89cb5df'
            'fdf7bc97c5dfd04674273dfd17939090f01d82f9ceac4a6d0f9aa529db9b923688c1b750bdac78898fb1efa9c25aaa8595d0073563be7559469e6bb7ce6e035a'
            'aae331deee71b8cdeff6cb88b52e43004166050a6b1011989d2e20bc5055a9fbd56cb3acdc25a91ac3b48012a75d89a1a071762877247a8c5553871d1efd572f'
            'b201fe1c661e0d09e27d5bf087f524492ece2f2adb53d9f395c45dc6f9908d307922103a2401ae48010d263d41fc9882bfe1417ae70510b12d6dcaa6e4160e2d'
            'fdc5fd3463aa1394a42718977cf3c8223bf1aff66ab845246d3bdac82d8bed76a742143209b47805de3b9b5b1481e7941785d7dcf539d4af463ca7289496d65d'
            '742455a86facbdd1c208dd6dfd3d43881ca64e9624633057b5a38abd384c0476a69cd0d2d910113928278fceca6ed18b371300a8a9b83de7eb937f5130bbae9f'
            'ca8eaba04e7dc86e7846d07743b0cf5bba600ceb8d84f2f4d22a0e6b560612a3e81ce2642e9038150568ec72cba8bcc44ecf35769f75055df43451ba0755e8eb'
            'aa0b946e8ab47dbe47e299093ae95da0e5232118b4509c66ee370857db76a61854b918e2b8a9868ded6d487b259305fc4ac6d43bfcb0a2d4f3f77343af9c6b12'
            'aac4f25629dc2c0da0a24cdedfc8eae0facd0383f3af0d98236e1b796fbdd26c0f1785fbb6b3ad7535466bb6442891460cce14590f27e915f02e3de7a5a64ba4'
            '3efd8e28d8766b6f6a07187fb074339f66a5c5133f060c7a38bcc335a4b9670daed9950c961dc8be2dd092c03ef4f4d3caab311f8c8e60eb180aa400717e7786'
            'd8976dec90b1cd044fb5a1ae53ce19d46f5ec3e82cb52db5d22e4f17142ef1fdfa1dd80978e19f17f597110b6d2f397feb5182ed3a8040957a61594317c5ced8')

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "KeePass2"/* "KPScript"/* "TrlUtil" "KeePass.config.xml" "${a}"
    cp *.lngx "${a}/Languages"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    #_lc "${a}"/*
}
