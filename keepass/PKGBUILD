# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=keepass
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=2.30
pkgrel=1
pkgdesc="Light-weight and easy-to-use password manager"
url="http://keepass.info/"
arch=('any')
license=('GPL2')
makedepends=("unzip" "p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::http://downloads.sourceforge.net/${_realname}/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "KeePass2-TrlUtil.zip::http://keepass.info/download/v2_trlutil/TrlUtil-${pkgver}.zip"
        "KPScript.zip::http://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"

        # translations
        "KeePass2-Bulgarian.zip::http://downloads.sourceforge.net/keepass/Bulgarian-2.10.zip"
        "KeePass2-Burmese.zip::http://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Chinese_Simplified.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Czech.zip"
        # "KeePass2-Czech-b.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Czech-b.zip"
        "KeePass2-Danish.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Danish.zip"
        "KeePass2-Dutch.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Dutch.zip"
        "KeePass2-Finnish.zip::http://downloads.sourceforge.net/keepass/Finnish-2.18.zip"
        "KeePass2-French.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-French.zip"
        "KeePass2-German.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-German.zip"
        "KeePass2-Greek.zip::http://downloads.sourceforge.net/keepass/KeePass-2.21-Greek.zip"
        "KeePass2-Hungarian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Hungarian.zip"
        "KeePass2-Indonesian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Italian.zip"
        "KeePass2-Japanese.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Japanese.zip"
        "KeePass2-Korean.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Korean.zip"
        "KeePass2-Latin.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Lithuanian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::http://downloads.sourceforge.net/keepass/Persian-2.08.zip"
        "KeePass2-Polish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Polish.zip"
        "KeePass2-Portuguese_BR.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Russian.zip"
        "KeePass2-Serbian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.23-Serbian.zip"
        "KeePass2-Slovak.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Slovak.zip"
        "KeePass2-Slovenian.zip::http://downloads.sourceforge.net/keepass/Slovenian-2.07.zip"
        "KeePass2-Spanish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Spanish.zip"
        "KeePass2-Swedish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Swedish.zip"
        "KeePass2-Turkish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Turkish.zip"
        "KeePass2-Ukrainian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Vietnamese.zip"
)
md5sums=('b73b9fc520e47f47c517be1048be7aec'
         '616a73c4e9431550f39e430989588774'
         '26aa0a32851cebb9532413b1bc2f8513'
         'ac0f1e104f82d295c27646bfff39fecc'
         '26138bb070035de02e04f62ae592e1f3'
         '1d0672b626bc7ba577c5ef40471c6884'
         'cd99c3628180066768cc5a537d3cbc3b'
         '3a208c1fe6cd6cadba98030a1ad6a531'
         '77495b8b2dffcd733809e92ff7340bd6'
         '20255349c03d956887663134af0168bd'
         'f75703e8a0bb7f24ccfb3cb034efb6db'
         'f9188970cc2a71092776c98804aaf055'
         'dc284751a01eb3e12e7d100e96deed7b'
         '43204029213dee42d2ef82b2332ac5fe'
         '261c4ccffd2b0e83491a5100cbbb5100'
         'b4129b1d4c37fa33d3804a17a7576fad'
         'a3efefd5086151fe2020eeaebcf493da'
         '5de5de415f5d4948a2f132301e49e1a2'
         'bce8cb30612b43fe702bc826f6513012'
         '1944335dbe1ae483c5be16728d0dacf2'
         'b743da6cdd130d661de435f44cc4ad89'
         '8b0a0d045f368a1f09bd452dd7df72b5'
         '18796d380af78202e8af827f0c113864'
         '5d7c39922bb9a612dabad000344b8200'
         '31ecbdcb817c24a6725af7d101676b6a'
         '3172ba110fd730ca4c894f9e52f09930'
         '5663781a8ff4e12257c8497d4de1575f'
         '21c31a26e1cfdf14a7c1c8edc370a59d'
         '25eefd1f75e8958d80b1fb91b597930d'
         '1d14dda46ccb4f6c921055a58080f0fe'
         '7dfe3d8ef064462c719b65e7ecd44853'
         'e4b2091d66e182811d3af9bf6d189f31'
         '2f446e6cd5c2b0fbfec98cb4be42527a'
         'fc2424e22acea3f423dd8b9667bea582'
         'd6667924ae50805ebd6631bbb5e86abd'
         '96b783595dad3ae1b79428074df8dc7d'
         '1883051818203c4991a28f927a99ae63'
         '3dc3f16a897100e782beabaa33182b3d'
         '6001dffd67dacad018db67f5998dfcfc')
noextract=("KeePass2-TrlUtil.zip"
           "KeePass2-Portuguese_BR.zip" # bsdtar: Unsupported ZIP compression method (??); unzip: `LZMA' method not supported
)

prepare() {
    unzip -o "KeePass2-TrlUtil.zip" -d "TrlUtil"
    7z x -y -bd "KeePass2-Portuguese_BR.zip"
    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    # _lc *
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r *.{exe,exe.config,dll,lngx} "KeePass.config.xml" "TrlUtil" "XSL" "${a}"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    d="${pkgdir}/docs${_apparch}/${_realname}"
    mkdir -p "${d}"
    cp *.{chm,txt} "${d}"
}
