# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=keepass
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=2.32
pkgrel=1
pkgdesc="Light-weight and easy-to-use password manager"
url="http://keepass.info/"
arch=('any')
license=('GPL2')
makedepends=("unzip" "p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::http://downloads.sourceforge.net/${_realname}/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "KeePass2-TrlUtil.zip::http://keepass.info/download/v2_trlutil/TrlUtil-${pkgver}.zip"
        "KPScript.zip::http://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"

        # translations
        "KeePass2-Bulgarian.zip::http://downloads.sourceforge.net/keepass/Bulgarian-2.10.zip"
        "KeePass2-Burmese.zip::http://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Chinese_Simplified.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Czech.zip"
        # "KeePass2-Czech-b.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Czech-b.zip"
        "KeePass2-Danish.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Danish.zip"
        "KeePass2-Dutch.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Dutch.zip"
        "KeePass2-Finnish.zip::http://downloads.sourceforge.net/keepass/Finnish-2.18.zip"
        "KeePass2-French.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-French.zip"
        # "KeePass2-French-b.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-French-b.zip"
        "KeePass2-German.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-German.zip"
        "KeePass2-Greek.zip::http://downloads.sourceforge.net/keepass/KeePass-2.21-Greek.zip"
        "KeePass2-Hungarian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.31-Hungarian.zip"
        "KeePass2-Indonesian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Italian.zip"
        "KeePass2-Japanese.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Japanese.zip"
        "KeePass2-Korean.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Korean.zip"
        "KeePass2-Latin.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Lithuanian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::http://downloads.sourceforge.net/keepass/Persian-2.08.zip"
        "KeePass2-Polish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Polish.zip"
        "KeePass2-Portuguese_BR.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Russian.zip"
        "KeePass2-Serbian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.23-Serbian.zip"
        "KeePass2-Slovak.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Slovak.zip"
        "KeePass2-Slovenian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Slovenian.zip"
        "KeePass2-Spanish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Spanish.zip"
        "KeePass2-Swedish.zip::http://downloads.sourceforge.net/keepass/KeePass-2.30-Swedish.zip"
        "KeePass2-Turkish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Turkish.zip"
        "KeePass2-Ukrainian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Vietnamese.zip"
)
sha512sums=('b764fd1a17448b50b74830dd88c1f9be3533331b5441b3fc7a524c5c6fe4c320a8b2bb510cbb7579f07bdedfccd93fe4a40b58d023152bc34b9c46116bc15100'
            'fd17481e08f7331af3f8d79a69e5b188e286e421952219bfa5ba7fb18c887af0899e03c88af0d24789f66a40ffcde32cee3ae7397637b8c35ef9ce0e767173f3'
            '1d482931adad913cfc6fea1982f82b643096bac1b4aef159283272580dfe082c7180ad99b7c72229b754af1984742e33d896887cda23b247b22656919d896c73'
            'be3675bbbe47d929a1ca6c5dfefd31b674c7304cc4bfac914d5be9656937554919478feb363fd3a51561bcf879941fcb54b701648057422c452bf677d500a839'
            '121984df8a67b46d243113637227fe36d7b65a699a30704435e65c5c7003d28552dfe3510759db4e149c274eaa18f92232b60faa18f9e4312f87012c95579ff8'
            '8548df07918d101548e828e038bda9c593f909f17cd11cb568c987094b19ed66306f79e3e58d3128a3aeef20deb7061f9c1f1fc001e28aef355b42ec75a519d2'
            '5ad527a6cd0ed6cbc4bb1326d76980ea4f7e7e84385c08eaf7d8dadc6ed2bdf6579b9528925cbca8d45f72f0129e6595581b2c0d09427c1710a2be8f5edc9970'
            '0687f2a36dfa9f710e260b31884055748da8fd991744bae09949964094bd48fc20e85b85705fddbf9225ab94f5e0c25d46d4ab7ac3481b7be0b39439e88a97b4'
            'a3584859709ef51bbf68f1703eb82178686d1694bdbf1a8ad992f6023bcfe67269313e1279e75c5450b59e693037dd93ab87285c8f43cb60e2dcd75bfc216020'
            '750a94a5481b6d205e9c3d03aeec727a4838ab0096ed9af813e6fc019cfa744038f7a10dde81c7943a52117131479de8e2c3aef9b76ef538aa0bfaa436682bf2'
            '6e67c725993c75c4c86fdbfcebe6f3a205803fa81750777a881497fd53409cdd88f49fb04ccd7dd9c88c6e02beedfa7a87c29aa667f470022b76485b9d52f40e'
            '5d3adf9b037ee065ac5bf4af3757053b7d2061964e43aa0b5f7f7a99e39b9756f7ec3bc70bf79337cb3fee011f8c1ae41599c7d0dc2b2e396880a0c927483cb2'
            '13e8932a8834433c0cd941876ed685eaf960a1ed7cdf76db732c4ff6342ffb9a6287e655edd944b3153e4070a737f0b8a9f281d16e20e2796e18bce14a316ec8'
            '4ce1479df7fd3dfbf55d8cd39f0081cee6976f4922fd254804b885769a191abbdc70c6a4b41e6261f558506294cebc435548120dd441e31689334a56bb1d6aa0'
            '44dd5eee1fc78aff739a915c1b4aa59ea6c33c924acffa2c8c631b4fefa59291a9859a44e78a11f670fe451ed5f73274e26e063e1633b2338b842109ce248481'
            'c26806030b4fa681a781f5fff6fb88fcc4cc25672d163de4f78a81fe70e5d0a54cadda9667756ab8461aaef42a1d3183e5b9baa2dd1654acfa16672238b82173'
            'a168b077fdef884d4627529d71e5d475fb6d461c0981303793ffc81f9886f5a158faaf59fb08483d9625f644bb4e3866f63ac3cbd777a5271cd671e11a941ad3'
            'fc4926c62a7fa7bed1394535b7245b7abe3ac33af5f3e06bb6358dbf62fcfb967e4528f85043351ee1e030960627abc74afb8f6b145c6bf3ce56f81691ba18fb'
            '7a60d18a8ab4c541747c25afc6155ae70a139b468839663998039af2d02989769bc90bb2211c4492c1dea30652f259495ae2c08e48b47d4062dcc6900405ef78'
            '67c5cd3a5b19c623312dd4b972de7c1adeff168436e43cfe7b7ef1348aa3251f6fd5698e3795f8ed46ed0de8ac8d24a027965815b98ac15c9fb9b84c245090af'
            'f4d3cf7556a9cd06d7dd5ed0c00ef9575fe74dac4c049f298614915239c18771af1f3bea5bb34c9973deac5e55d990ae11ce382a3a9a761201978c11701caebd'
            'af80a6a57248c14ef710fdfac05531d42fe937105e62c15de4ecf16185e998b2c8719b4b32e1eb4bf1fc0b7cb577f97565a94d20778efd5ab65b59c5baddb3c2'
            '6963c335a44b79b94ed0866bf44534a012f7844256ccd97fa7474ed14fc09385533a4634839c30f4e633c4ef5c8b3fffcbab2d3fdf3b5c4318bdb28a5836dd61'
            'efbd500c1c1e3fe0c98085b4614dbb32ca2bba4e62157c87ee49dbc14ad9eeb552b8086993c61c4948a2e4d0619cc98d6e38b264d346bad4a5bc557a855bf7ca'
            '17c185bbc43090d4d22e137441e97c868c4cd6417d120bc72509b008a85a8b0eab0ca0b4e4f7f3e8030b01dc0b5e126f2d71108f176bfef59133e43b651b093a'
            '2c274ae696d20299aaa9b9c7f5fe22876fee9c852e1a6f6cfe31b137f5df6d55dc38565df86e3fa567ed20e9af71c59b33821a08d825f0ee2edbf81f86d21da3'
            '8944b81f0099db84163c38a1095aecd76478cb526b9cfb9ec9aa2e0762acf404226ae97fd134bdc3e13044056f347724d9c41d6e362518d5545ddc4f55ed8a36'
            'f8088881e1c80ba3c6f782a170f762e0ec62ad36b44c988a52821b1aef87c39dde00df63ddbf1c3b2aafb17eb43fbc64fe4c351f69dc2e880d7f31035d08930e'
            'c698f65d53cbc9bd009331856b60549092668997a06db3b4eca6c6b18b09940bf7d115d705085f7262b6cb94c099917f85b31613f154fa2c2873bf9855f4996f'
            'c5b393380b0ddbfe22ab48c4175d963a1d0e730afbf1835696708cf542ca30ead26b65d42628cb0b8fcb54ed1a545177ecb4720c21a2f86d8af4b0f3f2bc81e9'
            '7b5e850be6c6f6afef702426be4fdb96aa8b51474cb531660e7300bb66e088724da097ddcc592ca220414bb76b5430f88226eefcb7928a6a33503e20942a3da4'
            'e5b90aa6dea5a635020b4b6906ec230f894113320be33db5d9b56cb82c27919c9364fbf97c55f7214daa4b69292583b93690470cb0f8fda778fb1043ccd9644e'
            'c202979ebe1f1342bcac030301711deed28c693ab697fcb2a956e8b2d51057014205791d35c2d0416a7dd1e7ebe550ac1e3b288186fa53c552e80fc656606f7d'
            '08b4b25a43195594335bb9b0cae20b8fbce58e726edaadaff3d6763d639582205b0b9296232d947fbde2d56b1c0860b0d25f86b867436ca12ae93734de45b5fe'
            'e3af41ac71c1c9c85395da2efbbedfb1a7749193890f37d65d3999e4d6254809c3aef4c03df36c937ea51c757654d951e05ba37ed78aa1f923c6ed5da51b232f'
            'e8dc39021d8b66ad14fa839103904a4ffa3b885941857475160ef81079d39cb302b456d54cde9c1db61bfce1f822fad40bddeb0e95b86bd8f7be621c70e352ce'
            '6bb89edf2872322cb744560a3bbad66c240312b27c70aa7a2eb1c2651ff50d030671d0044f07025b0a7530c988c0f262a9ec889c9c422e58e2d145e7e55e85fc'
            '477c2c8d0099e7413a914e0a8064a9a707fab093941ccd701cc11aa40225b89505616816f14b827c3dbce0e95b9f29c74d051b64be7f5bc56622dcb13dc6876a'
            '9084281e13d458bc19097dc6c859c7c463374fe8fc75bab5c4c2282fa6808ecb57e2ab546cf13776137223cfac4acd8f12952ba10dda262a5692687499729b90')
noextract=("KeePass2-TrlUtil.zip"
           "KeePass2-Portuguese_BR.zip" # bsdtar: Unsupported ZIP compression method (??); unzip: `LZMA' method not supported
)

prepare() {
    unzip -o "KeePass2-TrlUtil.zip" -d "TrlUtil"
    7z x -y -bd "KeePass2-Portuguese_BR.zip"
    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    # _lc *
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r *.{exe,exe.config,dll,lngx} "KeePass.config.xml" "TrlUtil" "XSL" "${a}"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    d="${pkgdir}/docs${_apparch}/${_realname}"
    mkdir -p "${d}"
    cp *.{chm,txt} "${d}"
}
