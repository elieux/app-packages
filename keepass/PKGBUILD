# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=keepass
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=2.32
pkgrel=1
pkgdesc="Light-weight and easy-to-use password manager"
url="http://keepass.info/"
arch=('any')
license=('GPL2')
makedepends=("unzip" "p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::http://downloads.sourceforge.net/${_realname}/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "KeePass2-TrlUtil.zip::http://keepass.info/download/v2_trlutil/TrlUtil-${pkgver}.zip"
        "KPScript.zip::http://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"

        # translations
        "KeePass2-Bulgarian.zip::http://downloads.sourceforge.net/keepass/Bulgarian-2.10.zip"
        "KeePass2-Burmese.zip::http://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Chinese_Simplified.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Czech.zip"
        # "KeePass2-Czech-b.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Czech-b.zip"
        "KeePass2-Danish.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Danish.zip"
        "KeePass2-Dutch.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Dutch.zip"
        "KeePass2-Finnish.zip::http://downloads.sourceforge.net/keepass/Finnish-2.18.zip"
        "KeePass2-French.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-French.zip"
        # "KeePass2-French-b.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-French-b.zip"
        "KeePass2-German.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-German.zip"
        "KeePass2-Greek.zip::http://downloads.sourceforge.net/keepass/KeePass-2.21-Greek.zip"
        "KeePass2-Hungarian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.31-Hungarian.zip"
        "KeePass2-Indonesian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Italian.zip"
        "KeePass2-Japanese.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Japanese.zip"
        "KeePass2-Korean.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Korean.zip"
        "KeePass2-Latin.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Lithuanian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::http://downloads.sourceforge.net/keepass/Persian-2.08.zip"
        "KeePass2-Polish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Polish.zip"
        "KeePass2-Portuguese_BR.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Russian.zip"
        "KeePass2-Serbian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.23-Serbian.zip"
        "KeePass2-Slovak.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Slovak.zip"
        "KeePass2-Slovenian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Slovenian.zip"
        "KeePass2-Spanish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Spanish.zip"
        "KeePass2-Swedish.zip::http://downloads.sourceforge.net/keepass/KeePass-2.30-Swedish.zip"
        "KeePass2-Turkish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Turkish.zip"
        "KeePass2-Ukrainian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Vietnamese.zip"
)
md5sums=('b4aeb4ad09d62173e40720e18a35d8bc'
         '94d0e5e15e9628088f01a1f8d1cb30a5'
         '7e86d60e40e9cfff2551e36fae579ff7'
         'ac0f1e104f82d295c27646bfff39fecc'
         '26138bb070035de02e04f62ae592e1f3'
         '1d0672b626bc7ba577c5ef40471c6884'
         '1a7b550c3e8292ecc6c8125101f92fb2'
         'ece4704d65df94717bb84cfa497b0422'
         '77495b8b2dffcd733809e92ff7340bd6'
         '2ebe0cf19df4394e36230bf050344406'
         'f75703e8a0bb7f24ccfb3cb034efb6db'
         '74830360ab434cd57e95d821a01f923b'
         'dc284751a01eb3e12e7d100e96deed7b'
         '72346e92711b141de6614cc21b9dd18c'
         'bb210706c6ecef383dbb1c436ea39f8e'
         'b4129b1d4c37fa33d3804a17a7576fad'
         '95f1cddd1c3c1e73b2fa8673cf41b19b'
         '5de5de415f5d4948a2f132301e49e1a2'
         '0f713b9d8c6a1c2db9afbeb9e9173e26'
         'a3aea80c73ab5a2d88e7fcb4cd68f45a'
         'bd46dc75fc152ec31cc2a15e1f7430b3'
         '8b0a0d045f368a1f09bd452dd7df72b5'
         '8a78626af74f916d703af1e2bdeac7e1'
         '8522b8d1c03d085c27e3137bc08e6b68'
         '31ecbdcb817c24a6725af7d101676b6a'
         '3172ba110fd730ca4c894f9e52f09930'
         'ed660fe59e7b634d5243ac4afc1f6fdc'
         '2b49978a80a5d1bf582666b12e662cb9'
         '6049ecc71cb161fc7ba6d07e3fb818db'
         '1d14dda46ccb4f6c921055a58080f0fe'
         '0dc7b5389f32875bba51abbfac945fdf'
         'e4b2091d66e182811d3af9bf6d189f31'
         '20b55d4a3675f9462cb7b5c5fbd812be'
         '8beafffa4f29c540bd7f226cfc51f66a'
         'b69b0c02529b74c9221835ec10a8d782'
         '96b783595dad3ae1b79428074df8dc7d'
         '933a72ab473980f6dded2e80fbe0a182'
         '852517658a2e4a8e205a8a2a74fbfea7'
         '8e54e7dc05500f156b7dfb26d6f6a61b')
noextract=("KeePass2-TrlUtil.zip"
           "KeePass2-Portuguese_BR.zip" # bsdtar: Unsupported ZIP compression method (??); unzip: `LZMA' method not supported
)

prepare() {
    unzip -o "KeePass2-TrlUtil.zip" -d "TrlUtil"
    7z x -y -bd "KeePass2-Portuguese_BR.zip"
    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    # _lc *
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r *.{exe,exe.config,dll,lngx} "KeePass.config.xml" "TrlUtil" "XSL" "${a}"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    d="${pkgdir}/docs${_apparch}/${_realname}"
    mkdir -p "${d}"
    cp *.{chm,txt} "${d}"
}
