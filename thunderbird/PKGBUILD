# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=45.7.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
sha512sums=('4a8840ccef121cdcb0bdae281524a64be98edb7334e6873f8346eddcf5a3e6f2efbee5cdffae7d73e464e3e24caff096b9a035f5848bb335ff2be322aedec08a'
            'e1b63ae5cd2b731e8e6bf23d7674df2b14687ec36d29b0874daa5c3861181b0414c858ec8b70c5f26fc768d28d2e41c9e8b11edf9f8225e4a905f0bd03aa1a67'
            '8e31c787f7c272346daf5129c9015ea9e6efda784051c0f5682df3a39cdca0015a82a0bec2a1b44d6b8c2bf672571682662b14cdea38f0549c70b2499d620719'
            '7da207c08b1cab949ea2feb01d066c6762494f5ed2d45b1f1a3f33eb81ece4c71d08f3662ca3837893210ee6e481dffc957a787acf55ae5549a48a827b9e68d9'
            '7d2f3a31b092873b78085804c83e4101e3230e77dd4627134117966faa16b0f41d0b9032af3bd6fa703a4fa8079fde7e84f221197a8164bfd692b6bd3d865cf0'
            '43de96e4368e1157f110b666e615b3e9f949b6dc536c3348283a8a88a0d3bb09b2eaf577526f19d64ebe69bd65e68a51c35d8d662b095d15fb1b7c846964b415'
            '12a3706c8f6244f458750de1c4e4e346175f92c6afec3dd360cd0e0b2d882c90da6525027c9c9fc1e0c9fc97e2725d29eaf031f0210677b205cf034d64d3157d'
            '115f657c0dc498d7bf3245e802310f0fe96f253538474043e36c8e3f1eeb34e675fc111d659c88b5c4513e969c25cf02cc5bed47047161885f81646c8f7ab5e5'
            '6a3f4ed02e3f89cc06196af7f3d7f43da2a60aee9759b408420bb93ae82b03ce12adb69e1f54fa55aba85df85c58278f890a1b2ef4b1ca4ac2076c4fb74578c3'
            '3713eb9800d0f4cbcea82032ebb667984bdbfe1de2eb2025752e93a71f54e78cf44e80f23b5284328ad0124ab1eae05ae9683e2b9d2da404b507c9792b40b5fc'
            '2328b206a8019cf7114b5bd05b5e114f289e7cc039be1a8c8e8be341e3baad4b836c6edc0aeb9917d96127eed4500023da19b1a0f85a3df46c128211a6d2fd82'
            '3b3ad4d0856d499d6757d8461928e42b70a41e196f46862318295e3476a0d144e7ad88774ae343975c13e7a413fe741d20f8abeebeca02c3b8061f5211fa52b3'
            'ea066da902768117dcc5b4a139a5b24ca43eafaf906e846526f1d66e58d0eea22e5c4321237ab5f1874de124ed68824069314e82075bd084b6ae7033c93f530b'
            '231cb425c638514437d2fb08437083307439089dceff31035b5cd24e2212af8631bac3099a2a3b1f2203fc969d7f530e8406290a85dfd18d9a541aaba487844c'
            '30a70273ced5852a431727f3946733769e4b67683ad5df8eed03fa5931eccaf506e319bb4b0d16c11f51702247a20f2e670ead56a7853edcba798c9948b930ff'
            '1be9c3933b92c62e383cba5a52b2bde6e378d1b0ebb895567488e6a3033dbb2bc387698289d4c62ea88c5728a01768e71e80d8240ed52e701115b99e1fab125d'
            'dc179fc752ea5acdbcd0b81be508c5780f0a00aa0fa7ffea9fecf6c525d8a8b5bd4a84db99c2efaa8c935c13d5dfc1d04f707d9ce4029f8355e07ab45773e13d'
            '662a6d20cada2c3d8b9d47ac8c8e141ca263f358de0c1c9bed141bd888cadc2606901fa4e75c5e1f6e97f4d96981297c4db2b9f251abb37b4db633e8cc282380'
            'a2e865b54aff50606ecdf8e3c4a5419168f1c8623e702a5b89e26373c793256787ba8c84dd5979514bc1b6bb5fe1d0e2a1a04e9f1506ac838aab7cdf9afe8402'
            '2ce2d11001b3aeeaf4710ef8257a241ebb612cf2627a04b53953412e0dbab8ef479a1b713f9a044f21f0e8a4e491a580a93f63e208b0c7bf67d7f38e31e2a0e4'
            '0f0cd20a60f216c997e689dfd4463bc4a917b26bc9010d9e24c74dd2e3af41abcd4f0591cb0641bcbe4ac3fa73f5b2c9bc42da8a940a30509a447dd8e8bc92ff'
            '64cd3b8c976b3c9c961b5b17ca4a2aeeac2d40b2a4399493c339487e7b439359182fe313a9108245a7381ee35a32c6212f9aa5f7202f083d62732f3f6ae18be7'
            '8049b1265ab1deb1f26c3c4d8149a6414a9e495c1d396f08c29f2da73f630cf49712bf077e5f4b3c55883092511154929b3c61da74c5c90bd93b566d32b0f311'
            '5b2ee8db862e684b186aca6601e20a022b9da49e08103f5c864c1c6c022c6088241d6238f3a7caceb5e386341e67741321e89fcc7a9b047b960d2070d2109ce8'
            'e5fb475f21cf7a008209e0b0595232cc4b43ec21c7a07bb1cb652a7da2f12e1af779ab940b8379f2d772ce9a47cb5447081e662e49237368dd9c413b36bf18f2'
            '1181bbcb1bf36842558ea809c39786f774fca01de706e342efae8f586e385de89ceee4a12bbeba26a24c47c4b1fbd68a036b7952bc5b7d9847cd428fd6f88764'
            '48467ddbb5613d77fb5492d756bee4c9830f4fc08ae36a02361e098f75a4e06dba8c96f277bde193473ea867a95d4fabc97c79bf08e28935e4f30d896a2b1144'
            '4cbfcb171e56a637c8ea0dcb5dcb2856ee5effbe603d8fd769f765826555db980e73fe84f6543c896ba2967181afa6f1859896427d43d154a0f2de22347afc73'
            'd38aeca3ee29bc12835fbecadea86e3e60a32b1a91cebaf88ccebaf4fd98c812f3b26587625a7f090fa9767d23afeb4ca1ab7aeb660e90cd0955bd7b95ac9429'
            '26fd06c13d8655bffc806d60a214ead423ffc479f55ca35b9efc07b546d00bd2a3e6a963be0e068cb4f3cadead341bcb915c3a09e6855cb7d54ca9bbe33a190d'
            '5051e261df224b7a4bfcbf74739a3b828499ec2a41ec3543615ceba5a18a031c0f95688c3a7a3758c33c828fcc597b83d11f5757513a299bea595f11699b4232'
            '43fd026062859d457a6c6f43829205495dcdcb4e8136018fb12acdca8369eeea8c5f8283b4829e06fa1fa39e52d9134c7db585871c8e6083c8c60c816cc90b9b'
            'cb3d540101896cd352b586b1a59dc5905a2e27561735a07d18f61fb95060122a0b457d57a6b1ab21c678a187c0ce2fcf1807cc9d6df62a8c70c9fe79db6f6467'
            '45c93bcdd45c00681b3452bd34462b18bdd1b2f677a69ef1fc0eaa83e4ecd3527b8902103be2487cde6ac02343c4d4f871732f5b6e6567c0c1a8bb4eb1375f61'
            '45f53b6f5aa8f4cee39ddb7ad20cbd72e07c1962def889e8b53462f48967b3510ebf1fa08ea111350f224ff7a798f0d511670c510189cff14ad81cb3cfc0a1c1'
            '082ef7124c7cc6126dc19cd0992d928e5106d943467446729d7ec82e37c0fcb6899a67a05c51d2457450e73d1acfe7a663337666f79449d2f0270de39ab9ce13'
            'bb9d0ec74dd4fc67b3a52099038943f92bd5b477aac4e2c5fe7f1223ec0e583a878b7218d11e4b76eeb99ebd47e08f62eb41d18727a19d3ce8a9c05454c16190'
            'afab6bfd50a4980ea72dd84a62975f1ae4b1001ae40bc67927090ba684bd3e5bdacdbbaed570715de1c141c90a4693bf480c8a176205d7a135a992be3d5ef23c'
            '366ceb48ab106bc12cf9cd0c6e0c66af62c217064d17b12730dfde7609176592e41767b6ef162ee02d502c1c59380b389e41b4acf2555e74bffce453c33f0f53'
            '7c7972e8b87f9cd9a946b87103741511dcb4182add7993e57f512c512794ecf94f14395c0763783075eedf829fabdd02ea5ff9aaf6f5e07ad088d22d2aa24ce9'
            'c24e42b078b991e40cdddb4ccb2d141cce6c667254271d530bf7a94b7212a81a4aee8130da55a2400ec19fe64f5779177831e92c917f3ff6b8507d9350df3438'
            '18af1722b12652cdec1d9c43101fbf94b2623c9998c4eceb58308878fb2ce0d1e836a720bbda841888e8e78528ac72fcd2802717b4059fa0b971e5f0586ab91c'
            '87521a13aba6fa78c86fcbf313043090ce973018a8f3d5f584d00cf03e1535e991653ada42db90406be8b11a0bfda26016e79b35c5e84094dd6a31c6a3b87538'
            '63bd4ce51e98ca4167a66dc3653ffe6f5d95adea7a798982fe2083e92a51c80167e145150f2817de78ce55d63ebad9ca248ffdc0c0d454707ca5bab5a8772336'
            '01480483b55ab081a63d66563244f5f5f886a12b44de33f9b5e2cf209c6b9a5d646ba87da2931ffaeaa840a701689978fee95f27a902eeca4e1c8164b5b45b90'
            'dee29e3afc3c0b0e79c9757f01ed7f588166fd554f1152c0b7c9af8ebb7f65d478418eefa0e3c4f99a21b06e1d172a9c0ba6b37624cda2ccc74df38c7a215adc'
            'aab4cdddadf7c504ab6718e9429fb7b310392b518faf488f336b91304e5660d186e599f0e938b681a3c48053a49af8853eec452f5b9b5880d674530f32dfa0da'
            '20668925533b05ffc50591db80b05edc86230348809305e412af54e8fc8c75966be8b4cf5b8ef717f98af76424ea1e20e9b98843fb0a35e0563314f948502841'
            '05f39f12f11817ded39cdedb4a492d6dad5ff16f3c61660acc63421d62f461b92713beb47b389920b3974a5d496a006b8aae5b01825f69aa23b5594129acd6b5'
            '7f39e44d3177af96bcaf53dcdc15eae0b3f560c75a2681d13ed9a8b8a6b5a65c1b4f8375fdd62ce838bab41aa774355dcd7b067d4c9d59fd0a667cb863e5ea08'
            '36e609c25244a036c37d53b3cb4979bdf26f86abcf365d076e873ea4d2e0ad4f0e0f34d17ec6cbb33bdcfca28b9df99945c37b9e05a920bd94f4e607f7296cce'
            'f03cd702fcb4c5460f0507077f8d5c46ef69a7c4ec43d79c48f0261465fa8424c7f8db3d8b4f6d0b63899711bb0cb883f49b7f92687c2550634cd55211543925'
            '4d2ab08880da12b0f8c85c21ce2780e114732b32ddf77f9b025d82ac27e02c7a8f5f0cadf574250b8a7358012686d55b3b7b8504e62c0093c93f9db98ab45559'
            '640e12842409d562277229212c1531b255851fcb68ff4c1cf62f635ab30c4524abf390e244a415e7ed0490d9a38e251c26c6451a1088fa19f9952277f096fa32'
            '9a5ab4528e04bcf29bb1f7b836bb93e9942ca280e520bd802ca94ae4d1c3b2aea47a9c512595ee71d26d7fe5f84a6fcd920ff878e608636a972d41ac7a02887e'
            'a48b56ffb24729dcc80b8f15631b7652a2836a2826ed5e5c0605a5cb24957fc310578270e07dbe58449f10b713f7b82e1212d45475993bbd33b7f69fb5432064'
            'd121e3674502b8369084e39e57c6066e6110f1c8228286da561451a3bde98f51f8bf04e9a9e6f394528349076d4802fa3e2c3cb89332a9a0ccc06b1e602356fb'
            '23b578294a820d16f6d2a32459b11a68fa9c37394c7086ba6dab34c39af924ffb36a5cea5b59ee8f176a9d75d5efca5bad76f4ecf788804e62dcf9ec2d1895a8'
            'fd94f50425e702983cf567ac4a56c55d585d954e0a21eede11cd58e07d7d00f06680098bce24053b262f003b44fc206b237b2cf3f5cafd4abc26df8183b3b1ec')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
