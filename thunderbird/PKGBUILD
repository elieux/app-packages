# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=45.6.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
sha512sums=('b0b583c35da74c83b999997a04c9929497a91fa12b1128866d459d8eda25e2262ea19355f6f3d156bf6848d65f894ef958e3df01d5e158c9a5ecf3acd2de1be2'
            'a89f2516b014904989a3cca47d458d0bfb0de070b59c6441d6478e62e51f56778ffa34ae2d4d9b37e7ec3800ddf2fdf09917649722b4eff64ad08b6fd439c391'
            '5c69f3b3fb9a78aa7b547f5dd1ee97da1a7bf5b3d1ba168efcc170e48782f5bdfdb1b9c9a54d8dbadaec9a88e184d2694fbc4e7ac4312e4619a22d89556457ac'
            '910b813717b1d8b8e3aec98d331bc7c11a44bdcd5643cd54b2770a8d97cd498a717ca1d6783ba9eff9efbd8693639f1d74d6311ee8e97b79be5413aad26f0d44'
            'e259f93f9b97f00c1e1c1775d3126ae0374d6e94113ec53ba1916b0388be37558dba243e26f60930de5bf0dedbedce9bf47989dd4dbf3339dbf64308260af868'
            'db2c7b143511852428ba59a958fbb81880cc4cab89fa1bbbe8918de818a0332d96c7d094a3fb22fabd51b5ce9527b88a9666db0d66502c8b5794edbca0529218'
            'bf624b19b71bc4f6075b2b543cd07aea5af1fda1feb2aa9d64c59fa65d8d941c93bdfed8a57a0ca99d0794a47c749995ad8a88c3cf1fe67301604eccde88547e'
            '7fa8838ee8bcd998361304d29c9de8c3188190de625139227bed2f08f47577ad04a4e83cc0647c92a69ee76e4e6c7df8b3e882f21f8d56387b3c7f077484a052'
            '3692f5231a0010d351be9211cdd6f1093e2c54676a799540cb3261d3af5b4602e50603b76bdf0328fb97b45659e4d463df04783a6059be938d2844410d10f3e6'
            'be224a5afd73382ec124defd9737714cf59e00fa75171e934da59b42a86880ce89a1e4ace5c89fca623f8a16f06eaaa73e2516da59e2b93ca2629563b314696b'
            '287f801948b7b321a9a8356ba899f157bd446c244ea4fc091a088b7d4771215054dbfa9df48050ca2b00266e08b8a563cf09d8941a76f179ac3580ad498aef8c'
            'c6e86cef98ab1716c6ba25d47bcb558efabfc04c12d8f4080f4214724b6fb4bd91bf70a76a2947de8d9f52a13b51944b908a4b23dc44180b9fb0dd0df91271aa'
            'b095e231fc811845af784ad22dd6e28a46a5701acb3d2d298165d1c770e24adfffacea06d7768bef991b203cf23915ddcf5ea1c3044843a81f035d1cdccea213'
            'ef019e9f054867e1bc3ef9bbf9a23cbb5f2cc416ce4ebceca3faa4b5c76e7b19d725b7b257ed559dc166360a8243356d7f77125c8e64a066bfb8a926d435774d'
            '964bfb66d7328acf02d875414cffe3e2254e827c676eefcb31fa604fedf2747b8e0d9fc3b071682fce732f1097228d6f8a71112f001cbf8c30802b4a3a912c43'
            '3c3429bc81d9d99deea7a748d2b58523f3417c17bb01ae5db74e451ffdc2672860589102bf01368a6ddb066327c68b0184fd186f08f76df183675bfdc200cc74'
            '63a640413acdff512900a3baa9a48d4952964ec3bb7ab6a4ea54d342bb81213754bb44fcd5be56a60d95c34581cc895a4c7888efc4babb9a491bc6e1758fd011'
            '173d51c1c31db602f99ecc84668ec33b36badfc7e1299c69fdb07e01c5ac026e911894180c1c40969837a55b378d1cfbf0572f1f940f1b688d63cb3d6e9156d9'
            '01cea40b397dfbc9a36e1c9fcee8f22d986a0ffd9b93ca7a814ec01ae87800cc4e1d12cc1f324879c8c41dba3b6f4d0a3968463e5624f40a8389e81e8b59cd19'
            'cb85b5bec44720a04fe65566c48af1c28d8c1486ac25626f5cddafffb5cc85f8016a6f366ab7edd271cd35a3868b2766e2574a815854254e7d4f9d8e66abd88d'
            'f1f9fa6710026f978f66a4dfd09d6afa81574fbf774626e564580152041723a11c7819ca3874d66626bb3aba82bdaf687305ba1cf035a2d31c1472590408d49c'
            '4c7712ab05b9de7f3e8bba11b28e46344e140daf1203b658197426aee49d28764b21513c20152b166ba115694dc104b3571412f00679e16be030242e5eec3774'
            '3b597e1a8b32eda2f605fb6237cabe59a9b4328e01db97e91810da97122c967ad90725ad0e31882facff229ff6cfc9b4933fa94a29924bae384b9cfc5b82699e'
            '31a785ead4850da57290eafc183d3ec82047c70480f2db590eb1c250c87f81c09918ec8d4176e2b09f912c21fe719950d1fca7abe201658c8d01bb8bef9856eb'
            'c57b2c7eac81ce9120e1b26fc1d97394a2948062bc606f3264f15531b8ed24a93af9b5d67bccce9454370b35608fdad8e0dbcc14496822117b957a0bd804e25f'
            '8d25e7305c4ab62360889f5288fabcdbbfbcd47d964efa0f2fd8a02624c5edba9903a8324cb561078b14ce5822dd59417a4fa60ea6e90c2a38d10a4a377b93ce'
            '17c80840fb4c42008f90569989ede5bd484e201a9b1eb574b1ca098d1ec01639c19b7766ebb2efadbf9e435ebe8051002a0501bcf76ed0c7292f088db0bf056d'
            '24e56312ff0d19be29e11008219f5cf4feabb9864662370d3286d56929b9d99ed69c6ed94a8471681ecf6c3af17c6bb9648604af9c4f0d15ef7acdbea54985d2'
            'c3d1caad824ef11fbf3ffd7c8ea4ca554f7657805abb2f57ae3d7a1e54ff0e910e4e6aaef78cb6336e3867bce57462fd16674abb50b9415a7cf4848533f86832'
            '5a48874e7994e81478d4477a70fbbdae691eb666d7deb05774da8903f645e6ba8e945cee32e195bf446542ece0790aaac12e37549969b5382eea11f8171e75a6'
            'b0c3f24d0c0384e4361a56f2171bffa90b828a2d4bc36381f48f1843db9cc25e06b3770363f0fd150fe293cf7d32d8950281943594cae4d62b967c0345f7e4d6'
            '026d04d8c6751af880a44ab1c90fc609bbd3236f5ac123eb91eb7e7049f03a3c2a114f902d5d244881ebf2f3681ff70bbe465a844d6fbdb14c025a6313b7d4f0'
            '33c92e809a66f750cf34728939d2e2bc844b968e3b0465c616dd3a1c873825acfa16cb8c3dc22cac7cf6c3c794966d9124e60767cca71d0a2f56fa8d19a4ae01'
            '5ec31352b48003a661cef25f39ccb587ae0eab06540f68782a894de934b558f9550c0c6f1c18ba2dadf2c05ee873d5977de89fb465197d42889709eb26d687df'
            'd45aa062f3c64a0eb35e9a00ff2a75b611d68d1c6f6224455d504df07aff5efe28d5b8787b5f04ca5be70d66a213343572db7e1cf809f24c702f3512412820cf'
            '823d033cb3bdc6ce8b2c817d04ff8f8674072be3450184fdde89527f6747182157dc2f5c92e5d6ab7e548fbfd0fa0ed7c67859e58e7b33f3a0fdce64b02a5ef0'
            '7ccec6c26ccad15b97b9106ba77c4ffc5bb112e7f1ac29ba06e12ae498ec5014ae7a27a568c2516c8763b0e73e239156834abb298a8436bd07a2328fa1421546'
            'f841fc13c5d2944ce33f01567fe5634273ebb344a168b4597b23635ad880ea9eb670328e30bf77a9df57764ef6e95eec8bc46f5077b4972e8f54af5c0e95f79a'
            'e2112aa1ec2bafebc6717412277a1bad60e4e485fcc5cd0d4d1c0a7ffba6781344abbbae2a1e39640d9194f12a57c759ed2faf9a4a42fe6342b04502c4227e46'
            '9472a2f4b4343f31bd10ddadd474fdd30198e3e50ed5eea055d1c073f3cfccf80675376f774a4cc3429c40117327f8c48f937a55e2e8414255862c8847a1aaa0'
            '9ddc5fef2b10261ddc1d10c0168aeb0d712962773a54b66e16509f5839aeb9210dd361b7179373cc76a9cbd21bbe783ed8eb47167c77b87c521630e7b73f12cd'
            'bf7097d1c93a34174d1fe4659fa93226f6615c92863e279c9e99d694810916c2d0def35e5f46b2bedf672e4db8f03cc68f7441e76e2badc435cf400480c19511'
            '067794cda96e3b9cfef292e3fa63456c570c032fac5ae62a9ba4aa98442e16a9b33f4a3874b2a2153806a7b685aaa50f12173651ac34c5fcb1c0cbe5f870356f'
            'ae510a393b22d84ab353b4b6f0cd0719d498748872e6e15d81fc498efd983a23e04c1b44016d94f0eff332034498dbecf3700a8ee6411df2cd147435abc24cb6'
            '79b77696a7eb71c5383d07e162b42fb3825381425a640aef324730deadaefb02e2ff586ab4229518ed31694b3e840c69c7c1c76f39c08acde66d8e77450a58ef'
            'b6eaf4e2bdaec3839f280014b030ddf4d02860895a49c17015469949808aad8b3a90156543fd4918282e1baeaa82447fe0b9d9670582ba62e29092be04c00a5a'
            '53f01689f1d3b386228a5caedf1dede069d01041fe03e51f95832a3f608d7f691a4966cdb30345b1a5d6f4a840f183cb320b76dc0277d19bb5278e132629222d'
            '0047ed76dcc4c043d47a1c2e5d988000996936a83d0d385237234569a394a45df568361927b53c51e7751e126d195ebe8fb29514b72f23110435ce67953474c4'
            'b16cfd0f0808d40723b650ae86cac6247a8dc36ff37a8dc1916fc464ee2dd954f0064d286e8dccbf2cede00a0b7a0dd8da8101fb7c98193a7d26824012c40ac8'
            '2bad5b30e5a95fb31b4fbd87de8ac71f35b303785aaf0d6c84c530d51c952e1d3520779d2961074a47e3bf65c51ef9084109088910f076dcc71765d797b69560'
            '4a32c678aed3a21d72ac78e329b2287c5d4cb850588c231c58083cde9f3debf70764a8e983491b63620d509c2e27eb57920a9cf3ef3f394d4997f57ffddd05c0'
            '67c57bfc936b947f31dbdcacdaedbcab444f2907306d540433ffdff696cdbf5137b9bdd5a1cbd0afea3fc2280bcb9801c6dbba858b5140f4c4cdc21a271487cf'
            'b872d9dde8ee7564b516a0e6cc77db78e0b5d61de5cdf7447a5a66ee11acc0843a97d1b86fc9d6a8443a203b7a2deb43d92995c87d0b2d26e0a1d08be7877b7e'
            '935ef5f335d4a3002b321c14c1b397cac1eca812b27fa0a702433439f3a1c691e90a6ccdeb2ec8d6ef465b7238e40e681936de5ba7f21a0702e61566ea128b59'
            'eedf3dfdccc5baa2e88ce7477554a493a2f8aa0a3bc73f69522bc0ba03a4299afa54ec2d302586c23742f807ee898230723ad27e5a04dd7c07aefc5f7d451b01'
            '3a84e6ed8f24de92751e6f3592a395ae21bbd88239cdf780e7213e29b9ae894fb063114fe4ea4461c2385fdd6fb3809f4aca54dabfce3e4f9063cebe4e421c38'
            '91b0919909143f9017cbac591c29acf55985dbfaba3b8200344161a2b0f41c90a5aad64487fa83a5f14502442a44a49cff2a1184c81332509f589f8717e233a1'
            '6a8b4c39d3f02c92392eafc82b3b0cf88149322c32d1cad876fcf192048140eee93080ebb88147886b59eff5fba8a3b8681d6805e15aa6b0717160e26ea272e2'
            '2bcc1c982219ad4939854d4e2760b6a908d554bbb9b121dcb8b39dac0104c25f920f93c1e2e71046c15e8b2531aa9495d3f1ba9005e3b4f01e655a72d644cfa4')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
