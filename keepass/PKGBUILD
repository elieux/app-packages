# Maintainer: David Macek <david.macek.0@gmail.com>

_extract_subdir() {
    local _file="$(get_filename "${1}")"
    local _dir="${_file%.*}"
    if type bsdtar | head -1 | grep -q 'is a function'
    then
        local _original_bsdtar="$(type bsdtar | tail +2)"
    fi
    bsdtar() {
        local _extra_args=()
        if [ "${1}" = "-xf" ]
        then
            mkdir -p "${_dir}"
            _extra_args=(-C "${_dir}")
        fi
        /usr/bin/bsdtar "${_extra_args[@]}" "${@}"
    }
    extract_file "${_file}"
    unset -f bsdtar
    eval "${_original_bsdtar}"
}

download_https@subdir() {
    download_file "${1/@subdir:/:}"
}

extract_https@subdir() {
    _extract_subdir "${@}"
}

_realname=keepass
_choconame=keepass
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
epoch=1
pkgver=2.53
pkgrel=1
pkgdesc="Light-weight and easy-to-use password manager"
url="https://keepass.info/"
arch=('any')
license=('GPL2')
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::https@subdir://downloads.sourceforge.net/keepass/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "TrlUtil.zip::https@subdir://keepass.info/download/v2_trlutil_2/TrlUtil-${pkgver}.zip"
        "KPScript.zip::https@subdir://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"
        "KeePass2-Arabic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Arabic.zip"
        "KeePass2-Basque.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Basque.zip"
        "KeePass2-Bulgarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Bulgarian.zip"
        "KeePass2-Burmese.zip::https://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Catalan.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Catalan.zip"
        "KeePass2-Chinese_Simplified.zip::https://downloads.sourceforge.net/keepass/KeePass-2.51-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Czech-b.zip"
        "KeePass2-Danish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Danish.zip"
        "KeePass2-Dutch.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Dutch.zip"
        "KeePass2-Estonian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.38-Estonian.zip"
        "KeePass2-Finnish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Finnish.zip"
        "KeePass2-French.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-French.zip"
        "KeePass2-German.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-German.zip"
        "KeePass2-Greek.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Greek.zip"
        "KeePass2-Hebrew-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.35-Hebrew-b.zip"
        "KeePass2-Hungarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Hungarian.zip"
        "KeePass2-Icelandic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Icelandic.zip"
        "KeePass2-Indonesian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Italian.zip"
        "KeePass2-Japanese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Japanese.zip"
        "KeePass2-Korean.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Korean.zip"
        "KeePass2-Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Latvian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Latvian.zip"
        "KeePass2-Lithuanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.46-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Persian.zip"
        "KeePass2-Polish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Polish.zip"
        "KeePass2-Portuguese_BR.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Russian.zip"
        "KeePass2-Serbian_Cyrillic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Serbian_Cyrillic.zip"
        "KeePass2-Serbian_Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Serbian_Latin.zip"
        "KeePass2-Slovak.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Slovak.zip"
        "KeePass2-Slovenian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Slovenian.zip"
        "KeePass2-Spanish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Spanish.zip"
        "KeePass2-Swedish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Swedish.zip"
        "KeePass2-Tamil.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Tamil.zip"
        "KeePass2-Thai.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Thai.zip"
        "KeePass2-Turkish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Turkish.zip"
        "KeePass2-Ukrainian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Vietnamese.zip")
sha512sums=('04770d3c058b1e6e9615652f2f21461c3ad7466192c7a2cdf3616a5e7292124849336f4056a8ced79a9fe79c960e44c31f6b935b1d15feac4c68c98713f803cb'
            '8d8ef06eb538ac635ffee95656f01e9411a5d2c1ada968b73f380987e583d148a057691a6e13e16a06f6cd016fbb2691c4cc480dc67b9c63fe654835556a7e81'
            'f7392c5aa647d5186881ad34fcadf303393bb29e093c413a880092a3ac18ec883557e62133fded90a7495c28c39b330c03915ae274c46ba11cc7dcf3d0134ad9'
            'be3675bbbe47d929a1ca6c5dfefd31b674c7304cc4bfac914d5be9656937554919478feb363fd3a51561bcf879941fcb54b701648057422c452bf677d500a839'
            '4fef35b120c86556b9cc09860f73c3caaefbfaf3d667320a2a7d724a9a3fdac37d5dad68c7ce77616f6006bad195a9eb24f79969607965850ffd915aeeedcd78'
            'af34e2a7b95b53f8b2fc72738a00dbe1f32fae1018a46d31fa30bc06b8950f50d6a6248e1746ae14c0208dca9ad88e82ffa7bbb902827e072e38aa7a3ce5f0e1'
            '88eed8a4309000c5c3410c343840c46c6dfad776a2c8fa2a6f90cd19329f11367795aeb289e330e0851f7a29dac8ab29463e6e8e2d7ac95aaa2ee9ba50065600'
            '8548df07918d101548e828e038bda9c593f909f17cd11cb568c987094b19ed66306f79e3e58d3128a3aeef20deb7061f9c1f1fc001e28aef355b42ec75a519d2'
            '8ee2ec2514cc3280b82ac8a555b2e9f2ca23915adf856abef4090e5baa34c9d598850072fa8eb12c51c3ee0350fe6e6760c8e32351d71a4b240cfdca5f43994f'
            '8e94f5107735abe1c22bd200bdbc2aecd9d6daff1990e5fd4b2068902471ba290857fc98cb84a691c854f2d3539c7516da59ae6e35b97b9594acef9ea328e958'
            '73b42bd8d8a82d8c47f5ddf4b995713fbf1d525c3918f41b894464180d9062172d53af9669285fcae4e12ce1e7c882d81cab1a0ecd5e57fb028d52f2bb0bc723'
            'a3584859709ef51bbf68f1703eb82178686d1694bdbf1a8ad992f6023bcfe67269313e1279e75c5450b59e693037dd93ab87285c8f43cb60e2dcd75bfc216020'
            '810ee9f65a1630c453c51c0d2a3c3c8cc7c0c6bbd4a529b04e51f53728cfff34d7c10554d32eab8b1825e2a2603323babcc74b2188628d2cd6341e4d408c1b89'
            '6f19f0b05bf4b0834540e58b5a8174f79ee0e0e39683bbea73811aa4ff61938ac99c59155bfdaf679d770c41c536c9af7325af07475e52d758737c25c7ba12a7'
            '9c304b48b0ad8bc26129849af2db03e2f4cbe65ff1bc04fe0736ddc6d99770c8e372aaa45b6e4f23f298117011feffd9f3385140119b2e5aaa33f6e1157f47e0'
            '2ef568588a24db4777969f35afd5e803989ae4814bbda6c7fcb674c0b40791ba43dbbce3613f05324d7855c519642e10d7f14397fea7bc95b1b208afc1a62648'
            '0e26e0dea9f67c1c2b60bb921c8b7ccf7fd21113da35d0ab1be6d944e0e6213b85e9586e78fdbbb0f27a04909d72c7ef7fcaca4f574f036f98dbbb6e521401be'
            '3fc9015cde4343f2eab8e0814ef4ff66322a0362b3f3d281ed33b471908ef473b0f3d5e00d44cc3892916eeb463daa0f9d218b8eaacd942283fe33631b780152'
            '109820e9993c291cd2d5c74c81446ef193c850f83e17596f0667e60b6ebb6994d25eb8b3f60b47b0b5ba93f537a61a1796c836b4ebd7125aec52a88d1b6e03c7'
            'ac15c87901e9302076c1314135672b27515b79991fb13c485b07ea454d2c93048f830abe3e0d29ff6cba24a59cff47f3fb8a704851ba81cbb70f96b8808f9494'
            '6330ec5779b877b702badfb813cfb28c32b6bbbe4f6271586f39a7f166eeb10228c31af0d5e4d98e7c0f8de48525d4756663d562f184ff79b2ce8c91dc2bfc9d'
            'e25c70fbb7695f6b0e711e54b5b54fc5a76a845115d45b3f5aa94adcfd90b530e60675030374c3378662b4910011fed4103f17294e65055bba02088d1388b968'
            '3392ffd64a3df314f04474ec25d2aa0d83d8916e4e3ef2529e7a42ec8ab6384384a0c246865a2b97ffcd69579fd3cd9c5b40a20b9cd365b727ac0775b12a5a72'
            'fc4926c62a7fa7bed1394535b7245b7abe3ac33af5f3e06bb6358dbf62fcfb967e4528f85043351ee1e030960627abc74afb8f6b145c6bf3ce56f81691ba18fb'
            'd3f660cad945fcba76219a9510ab430c3b84f8a350986b4b5f27087edbee91e5703daca7b3bf94f4ea7ec7e1c6bf8e33b32e1d86db9e3dd4bcc51fa111f22ce8'
            '940cd116e5ae1f81b623ba80895c0e33f6d0d043e5a53d546a45dea56b97e8741431938c0ca3260fe647608ccba1a4b2eb45d9bc550156a1a8ea37bde0862d30'
            'b1c54b16abb6b020770870f69064de7b55074aa14b245129e77ed722162b90bc273c3db95fa2969ed6b32cc00ca7d02f1983cda939a5ad7c21dc076dd828b921'
            'af80a6a57248c14ef710fdfac05531d42fe937105e62c15de4ecf16185e998b2c8719b4b32e1eb4bf1fc0b7cb577f97565a94d20778efd5ab65b59c5baddb3c2'
            '25cf8f42565d50c5e2157c67d0e7d8bf0a3d9269e45651070775b2db1a998e42febcc77e4e59f9a1cf4357661aa4b5f1fd0258e609e1c199307d2d7d696fc7fc'
            'cd5e00e59b0d681f1b80c20734ec06ef9d317320cb56425ad2dfc55c4263c4bb16def97a2c4c7761079153abf8760dc32335a5bf26800431bc099e27b9c9d022'
            'd09412be0abb999e698d7fdc706172d4c09a52abf8dcf8a44c27ec3f3a2d97765ead60c3efaa6ba8951eecd78fb6a12133681a35a671b7e29a5f6e89a0c44908'
            '17c185bbc43090d4d22e137441e97c868c4cd6417d120bc72509b008a85a8b0eab0ca0b4e4f7f3e8030b01dc0b5e126f2d71108f176bfef59133e43b651b093a'
            'e2619f4b55530e1eeb92c378ea1db2a81450cf7ee11f8adf910199c3bc96890c548447bbf41b02cbc8f6f828a97e48c4cc7bf7cb64ca2d436ba381bcdbddf8e0'
            '6d76c23122751077cbccd46f94f9b0e7f9d919038513cd62c759a1dd665e0d8e34c743131b1ac00ee1ec19a738e297f040243b3926363583f0b7fd71cc5924c7'
            '0696458b1647b0c3a257db684c61c320e27c242091fb2537e7f38f24fe7e73d3db77cf866c9e50cd7f0d9304fe69f6970b27d3bbb8cbfbc23c60b30bcae61b30'
            'f0733dd04eb341d2b2dd55aafb5588c98ea71866f24d1dc6bef874901e47193021deb0eb04d69972e98e2b2cce0d1673a981fb4b0d1049405b56573f967f3086'
            'c5b393380b0ddbfe22ab48c4175d963a1d0e730afbf1835696708cf542ca30ead26b65d42628cb0b8fcb54ed1a545177ecb4720c21a2f86d8af4b0f3f2bc81e9'
            '439ad863a2f0e7c835f9eb8211035051735ae061e9d34c6cac5cf8876c122fe662e0d46f1639f4d4e524f003ee378e0aa5c150dc5c8c5647a5651fbe0f0e251a'
            'dce99d3a6460a771b128bd8beac97c394d0a173d0f814d03f74e9f4dcf467e33579163e4897d4a3f197a2f005cb37800a48f94ff054f1af2794949c422ee5507'
            '6d465aafe64f13ab710ae574b98e75f9d49448d13f447434b3257631113090213ca48bc5be0057f71735609b7ed447725f90ec5e01eadd3190913d0645820df4'
            'f091effe199ff07259e4045b8d5c7ce2127ecdcdc034bcca6609aaa3a72e793aabd8e39e9efc98ee13e910513414cf0c433c87cf108043bcf5b819dc16a9ecc2'
            'b28ae8ad3b7d2f505de48598399a566cf1b3effd7e09968bbb32a7cd2b60a762b73b132d6fd4ae875327ec03637587121be3475c6019cc91e48fb0cb6e496acd'
            'e9ca68ae48260fe3fb1e33e4b0a49136a4fc9b533d815008ee46c40be3dad2ce460d573198f9b1cfbaf411bd175219a7656617af87fc41c201818376481221c0'
            '742455a86facbdd1c208dd6dfd3d43881ca64e9624633057b5a38abd384c0476a69cd0d2d910113928278fceca6ed18b371300a8a9b83de7eb937f5130bbae9f'
            'fef4c95810539540ad280323bc1459610abc5af297596d73253aa033b1b0789d3b8eae1e9beed67df1c38efa0b7bf89d6589568240a4715cf51e089e783718e9'
            'dc40033e099ec350f67aff8d3af730360c88368a2e50c8d14774bb92791a85031e48e227dfec1dcc93ea24ced8f12af5a853a1865265cc50ac0c4386eaa0d85b'
            '65ad20566c3afad57521a271e56ec156a9f66a26a6b39d59908b6b097817f000f8abba7e185cd9d523f54c8006f4a77795296d152b3f843f2384c858d068f816'
            '867279b4fb1450fa0a904cd63130592b16cd11963c75b82e5221c141c37aeb2b2ff905d7824b3509e98ac7bde7e0b7d65ff76ab68b3767c67a515d2e6eaaa1b2'
            'd47ff43293088aa751ceb9377c6ef318810e06a437a14de3f3ee37ea918ad187b486ef99d8b66d4d6762e02fa286e66dcbde72764a1a857c498b4761ef7be94c')

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "KeePass2"/* "KPScript"/* "TrlUtil" "KeePass.config.xml" "${a}"
    cp *.lngx "${a}/Languages"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    #_lc "${a}"/*
}
