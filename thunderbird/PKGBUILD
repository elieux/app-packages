# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=52.1.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "kab.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kab.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
sha512sums=('212d577920685fc9050664c6fda29e43a8781f4305461003fa9aa9c97c0d6bf78fff16d402bebb43b974fd198a81844102759564a0c946d9118e966f1b357b29'
            '77e8fbe84d8c9dfdebca73a3156c8e4fbceef0fb4774e3424ca0d581f24966be650010cbd143f4b45bcd6b35db578ac8b3cd313ae8ec3acb329fcba4da74295f'
            '546ade0f8d81576b57acde16f04ff8af85b9eebbfa510217014622d5c00c1620c8af0ff15a981ecacb76ce5787cd00df84dd6a22126660d945d224a23b596d33'
            '38da99ed8bb316cb3c05819497700122e95b1f5ebbc19fced2aa3c8febb3edab1dda24670149b6e619914c8705e9989ec5919f6e93d59c14c047778aacd00e55'
            '4effd9c6227cd78c86fd3bdcf7f527b83e46a52afe0acd36dbb674152dcd955efe2c782d23b9d4ea551db771e12812453cdcce07f733ecb4252708b9a7fd0e54'
            '68d456ab126944658c40d0bf0162fa5e40405c4da1b825f093467b1a498ea646c324e26812611785f4d094dd4ea3d18c777921951b333f1509744a0ee6134644'
            '77937373dc6c29d8ab319b0c3d22dbc217771c72a697b5de20e287b0cbf5fb960310c9f14595b35c75a6df69a8702f75e5a1db105c5ff7fc95cbebe3540ed896'
            '58062df15d56ed661e6ea3a6fbd0666900b81329e17c4747dadd39939e48ec9a3be336d62883911f70860f838cb58e692ef19673f7372c19c99210cecf169ed0'
            'b99eafc58701fbae092ea6705af37d3df486797d0fde9a82176cfb61939296b54169e5b65e3a02217e94551e52c171f568d567365d5cc58ceae3a9648e6fde84'
            '81cac6c1d6fa8bfdf8d98002fbd92deda6175fa0f6dfa7dd2c3e72bd0d439b8f7074c84361fad56f1259da77e60c88f1f38f0781ad9899f569fdb24fe4c67c25'
            'eeb9564f5520989870d940966f66b09c6c7fdd397b7857949fa7280a97d35fe73daf29040e5e3624e91d753e90e69d448965bbccbcb992fe1476ef8270d3a8ff'
            '16c63b77627d3ef74c23ec57b0e2e1c758b9e9174f94f0e1382e1ba8a8b91b7502a2ab423d360945d91056bb2975bae198a527a5e5bded8fd5802c5d2d6bf6d6'
            '08929cb9aa694629213ceead00eea4f5730fcaba82c6e520473a4295b48f4215fa785868b8ce32a65466201a3eb903aa8e1d5b5afe85d2b2400ebabd601f2927'
            '462efac492eff59c5d8ba7255d52d82d4dacbf909200b883f332ed4f85869fe9671fcabff96766f2c2f9f3b92a4cb81b802f357b19e7069d566c03da33165682'
            'f4605ace7ee7a817494b2989737242d7016d39a5e7428128df92542841023a17788b52554bd3de2fd537201b14252f488f6187f490d101eaf5deb01bdfef3299'
            '4105939373062f3e042182dd976648b6bce79ec0c33a9eacf3ba33867e3c7a652978f4f38b449a592bab7db5b6af92b23014c4a2b7e02ffbdb4e29f5480de282'
            'b3c6a5064b9f073747008a39a047241f7692515382af67e95ac9104597a6efafc76bc9f97c1f2b86b9a5ffde3eab44f0ad9e902250bb19cd4d8c1a704d249b37'
            '1e35e72105eec4c46b0a2448b8df64a38d9296cf2b70db81a2b4b12f713bc7f387cdc9e501ce65f35135804ec7abe3792acf8707ee69b0176e842bd74100b082'
            '2666fcefcc79f4fae6fd6191264966611b0aeca2189da05ae520c791531661c3285d5900003aafb2efd74f4ed10cbf40eb98682886837a25535fd59d2d1f20d3'
            '186f2141cd0364d2bccf85e1bbeee731aec5f1f526ac9ff4ca8e61b832df2b739eae48cd4856c384325bd734f3990a2070f2152a3daa4efc4693d867362111ef'
            '1de18cddd538e95d12705982ee3d4fc267183f71a82afa4fb692e00b0772ef890ac942b291c2595faeb55bcc0e01a455f76d0e42e6fddb523a98ff88cb704f1b'
            '39c0bed36d9de8af819290a8a55eeb124de587bb37d48db8750d6bc9da0b27615f56873cd8538ce26861bf8b4945d7537dba642106529f6e8d84d51da12d80f1'
            'bfa63a056c7b971b7798a0f808f9d2b4134a9cdcf4e57e7bbafc85cb7d5c4c67b3ef535588ecca63750fe2a9ab01f77ce7c03447883b376481267f369bd049c5'
            '422bf2baacb7083ed78cf538b6772d7f86da63aafd83998a6a48959d7ea26b7f79c8c23dab853f67f85683beba5672a7e3efb637fe2a17f78c4b0757a320dc8a'
            '2078b99309f6184c62430f6347700b7e8c68ba0269ff0e15a6a7c66790b65c3610fde05a5a0f4e0658a4701031ee41ca534b1ee25772017378619933f3d98c26'
            'de87699719506b51e49e9edebb77066c15df71dee5f3fb96421dcce81156f6e4fff88a5219a1c91e539355f909032e14707656cecaa4e0f4d4256bd13b332d2d'
            'ac07809df24ed5baf459ab7fce1ad54246ad09b150862243a8989730c574f49a332534499b88d9437e460939adb65cbc14f4d20cf6ea4bc063d80d6a6f055b96'
            'd8609915b17d4bccaa710ef69de20e540bccf43376fbec65e108363aee22e8630f6e83c073897849bda06bc2727d6602135700c97d90b9997bd77bdda71c10a5'
            '3abcc3a977375ab1ac3fb5b575367679e925037f73702ebde519d5feb5de55f8a77193884bc2b7f561c6d9707258817cd5b3c3a2b7e95e33ce02be2e38cc0a2c'
            '5ef1daaf3d135344d6b6d9f1cb4b8edad99b3adf0c68a2bd5e958b4f43a10be3a7817cd788e20441ebdcf4be32733eb2238bbc9a5e74d41a75e73dc0a7608a44'
            'bdb363794fcd93e7fd4684de595293be4313b712e15a9639049050b5f22b0aa31d3e9ff0cc1979ab3976a2a27a339df8be5b04991650ce9341dd0348e5a67b2e'
            '466a37799b2d4fd921000f4a0726ae0084a8033bb0991521c058b4dbc24d2d4cc7ffe97d1e9dac3dfc12e0df88adde53937fc834d97dd9875d67cc8c51a17919'
            '991e2c988539912ff0adf64dcab3a2971e3687a03d5b9c3626a66735e52cbb92da660aa91e66543fb96d167ffd2408734772f0f32508d1505a942d1cf2e8dbfb'
            'a9f88374aae2859216e3764aa167669687f4f0c46689c9d0435ce8db5f28f6e05c719ca620fd957a4416948cd2b33f3d58b372714ba349c5cb2107138a364b13'
            '8bc843bca26809a473a96f9618eb2020b9ba9d34b08e0b49ab3c58dde148d58c33e14ec60388fbecd317f0cee7f936683d5935a56af14129e7891dfe9a9ce84e'
            'acaf1d2408e2147f4245b72ca3b1fe1c61a916881c9b64964d4fa12dd2d271a9e5dd80c77124e8d0e512b19b1e6a6ef02c0ff265d65f889b272b136dc6a50b6d'
            'ee02f27cbec79b948f0d3ce8b985f6535c234d8ce68ad5df6793fd33d1be63fca02d10f2595627cc5de081361a0ec0036eb63efcfdb4c95d93b7fe006a5cf8cc'
            'ed0b68b492bd162f36fa60d5c0f27c26ba125dc9eef0cd36dbb2298c1a6247027e8779fc18d9a0e6d91a18f4cb0a0f2d18ce287c80b4d8ec91aefc4269aa8ac4'
            '6ec0f033269282087bb26052b6c056b2a51fc9442564d36e32e962e8c88f6d075c4212b6689f1d9dc9de6d2fcae4048816bdaee126012b0c2e38e46380f86133'
            '88470e275830f4f33d0d2f8ab615d5d2e2e43924b21978953950f2743e2f779914b9f656f565a1e9b519a5423f9845214d4c63e56f4a89180bdc7fa80cbedfd3'
            'bd3e416e671c855cae087c01dbc9dff7b52fc6e40f16751455f5e0e6a6ece163051db550f60696b6b0069495417c2eeb0eb9f5fb4fefd13108731c9f9662f06c'
            'fbeaa66ce2f0e4afb7dfbecb5e976aab358cf2d7fb14c5a8b054a83f19aed230457a9130db9b1a1afc39382498553c9a8e7c7d39890d9e1de24eadd8d088a28f'
            '03acb3fba883a6971fff9853b8e5957b2d0a30691531f25d61a0a88fa67492b3e84200668c73c65f8d3bfab771e64f25aa2d442872a26072545f570c8f752f3e'
            '1a8e5495f997e0c2737cedfe44a60785bdd8d87e958cfbd7a5d584c6c089855fe521592d7b5db8b566e6cbe1b64727760a2ee1f97bae25933d559a710c79846e'
            'd11fa6c923b28c47312c4f6747b6cf75c295fd284d3348d3072e45a818b764059474a6f9ba4d6e24dfdf149875f1742aba2ac918d37b075e8eddeeac844abbc8'
            'f1d0b32e706f18ab3f598ef6caf6d58973ee26c608972dae0216ec3fc685b37b8a410fbf77e95d44f53b755fc42a10575473465e2a152aeca8799bfc7c73bb57'
            'a2f79cb8c1176f6604e9572ca8b92abf406075ee85d64ab10c0138f9a3ec17a9cb45d76806d277ba67237e64252c0e66b79ba2358a68083892c0fdcbe12259b0'
            '4916e62560f2621481221a383f268963e7169c63c3cb0e326e9f2571a0f4b5c2c6f2c68da8844a3b9b0726f8ecccfa033d3559889c61ecd7f05e41a83bfa8be0'
            '1e7d1e1d03af6aad49e0364f85338cb499be24a08bb31971abc667c48d40377cce463ec45d30b7f00551176467829129f851e32ef205e542522629130d1d4352'
            '6592e398f56bb46cd4bc7233522b5ece98cc68c97075f674874ca42f8e10c576f57af44710151695cb3b2ea46ef330e0c641c2bf1c20d042a539b94bbf2acbbb'
            'c9c546ca53d58018db15a09460d4ea0c025c2976bc8e7853fc01e2bd0ac18fcfb3dea20bc5b0011e3913b6bdcd4daac17ed212bc057d8b131f1f6ad9042941fa'
            '84f9d6c69c5085a69c36311ef831eb163d680eedff3bd8f9453ea67d7ff38d70044c0f72e1644e116afc637f1f1c581e0f982a39b5a5a72df99b86c63cdabce1'
            '958a5b5a26ef7bb36dc0efd1a5efabd12035b178406ab6667a1ab6d6326ab95de301561edd512109536982f47e808d9689172433843255b545fb635b4de9b3f3'
            'df1242bfbb4dfde835f2af2d24f26ba6b21fff49dd96be61761ebab7987b16f34b99af4e49d1e32a8587c93536a79e392b39fc86a6a3876aac21889eb7c5a0b6'
            '689a1ae01771f2ebc507cde38e466004e16fff980f2215704bc9ba44c5764453ad0cc5da841e2f6cb53b985c647e9eb74cf65e8b213e7ed5fe65a76884d70a2d'
            'f69870e0c582c520d271648cf30a30ff894a28a9a0c6129099c467bf9a81e86c29ccbadd6da82915f58c9d15d80895040b8c5618671769a6963a569865dcc039'
            '0f71ba427be5325a4905629e43234f42a4a0e434ac3f78c091d104763c186a0f670e8d106c30ed25371516eeadeb541fa5d0ded435b7991252639a96887135b5'
            '195084e8f57b686e63b4815b451594a8c437285b5b1f538ba9ea14d3572e5adf7bdf37d2cb29d3a80b35b855fa16e9836489f7f96bfae9aad563cbcbc2e5f394'
            '7ec8b3e240a7e40eb105245db6aa83ac4b88ad83e84ed09c2db67531439a872f9649c19c40ff2899bcf0cb1432d3d2763054c6848b3872b13ffd9ad712561da4'
            'd66d23c2650c4b3fe6e70f20f5c40011349e8f6f221c4cbdfe4f4c76a4893db8731069f7212eef558e3a3c64530e11fb4cc9e39bb47d4145a0ddc504239914e4')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    sed -ri -e '/(VCRUNTIME|MSVCP)140.dll/d' -e '/api-ms-win-[0-9a-z-]+.dll/d' "${a}/dependentlibs.list"
    rm "${a}"/api-ms-win-*.dll "${a}"/ucrtbase.dll "${a}"/{vcruntime,msvcp}140.dll "${a}"/maintenanceservice{,_installer}.exe
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
