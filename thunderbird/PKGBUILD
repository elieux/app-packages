# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=52.4.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "kab.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kab.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
sha512sums=('8b765c62495a7d4e0674b1b53d4e4077125be40dd1ed468c633e5ceefe377632cb89c53b2a0296c7091c962f90ab8e74d375651cd203cd0dec2d2e1d808d6dd4'
            '75a4d29a2dbb95fee352e2914395b16e12d115a411873ed4f8b5d0b4563528800b6de7320869372dc8ab8addb944e2e29512935734dcd8c6d21e3d942b2921c4'
            '99ad567419ff50d29368a6fe1906a38d5d344db6cb30fecd063a5facbeb5bb8735760807839f4c46f069b5de989f24744407c1d73d297adf384bd4b93ab282de'
            'f1f7285392793a16a5250e3695fb7249c6f69a7cae5ed2ab79db682a97e5c4f4d782df27896a0454b290d8aab9970d6ff1c90324a05577482cc0a0b48fc1c630'
            '83346872b25bd97b9cd17557071d333c850968e8c81c893c983db07839e2d2db712f754ac6a8b59b4a04a543c65aad7eb839690a2bc1b4f38a9bb8724aa90923'
            '4eee351973d10629729e98eb1d9c47af5d6d02ba758040b5120138d2904c6a2f71376c778c85df41de4f3260325ba46456ed948327c34e1702f4ee01eb4bbf91'
            '43f39392a014773c7cd5558230144a2be3961addf391d5a97782bc4fc8e687ee4201136035d47fae93a271b6e40e4a07f3146d385b5d55ba626deb3b5d560611'
            'd59da1556d5afc935eefba015f90ce0bfec2c40f3a96d3a21268a4549fbd47a04d678e989aa52fd9e8bc3cfa536c0008d01109396edefc991f416352e1b50e30'
            '3f30bafa484f53c178ffb2d9a991fd7f4c383a4e5a37522432161d829b1a84b581a217c043cbf6f945980ba8ab895e5521b9cfad256bcdff704c715d1b44e69a'
            'f96c97b496759851f6822d8fe4cbc60a17da6ad99cc823af0d7da52aa405c0077c6706b8ee48abe15dfde0ecf329f7bc69faa6df9d6d0a52df447683b3e2ef78'
            '1bab02d0df15988c676c56c0ad4d84e63cea6c4f6e7bb905fd1a73157bccec79498ea999f5d644b880e3af880f8d2e171f2749c59f4e8e858c00d3c44c215cc2'
            '0355ba79e9463484faa0f84dc8960c1d80efa33003f150cc56ef42b32bfc5a8bbc50d9f196d8d06b3807285d54ce6cbf8e41f8287a91120336a29b702d8049ff'
            'a3002b91cb170d527a4f787f28167ca88f2bc57bd54ec033cc6aef4cc74299d8e377caa6d93d1fefed7d1b05e41e70c267a7654d1523feec7b5def2bc648a9a9'
            '4461e9c0bab3b90b56c36937f0693d7536f04e441310f86c408a33933442e2e437d66c36c09ad7ffb78d2666348d6915665da10019d335467054e3e8f88c6996'
            'b281dc0d73fb98796cc10f731887163742f46a89386a6271d4497efd46accb98a2bb17d7373b7ebb1f70fc14793c32f1c9d51d2accf17a85af8099e672ee06ba'
            'f6cbe48cde8c8febbe32a8176a21802021957abc9a13fe0c0fc0e0a2adaafe96f53aeba39d4bbacc2fba15088e2cc4da6e0f2f7b4fcd14b12a8a003e280a777e'
            'dc10b1adde7673cef0188ff605cd0d84231c206e176d57af0584cd002ac42002cf379f4aba4eeb2a4c39389f9717fd048400690909c030503a8cf585d4a98e23'
            '34c7c2c5a2b0051204f67e1afbdedf31d7ca5ecf490c76d4386190c68b61be031adf7a57229dfc505b207efe7001cb5358a82075aa4d064088596a663242048c'
            'e01ad361c384f1b51d7e813754fe4fc82d563b3e84e20022857047c1854612554a32a04565fcb5e2db34e0b2767120dec1f0d7f471b7bcd13479236aadc22fcc'
            '399481e90bc2dbe55320ebea487a4f9191d4d781a15809d1b4a214a7952efcce43f5911315f7c0561df224d9a9201f9c6e11c4e31bdf229608cf47878e23db32'
            '6d760464d3aa4ad4a8d25dd0dc50e9a7786282a35ae2c022bd12052bcdbee9bb91761505e0efce13902b6839624ab566ebc9a923b6c0913a4619d5099562dd1f'
            '01dfe83366acf4e5225c55e63f937347aed07178d623e98ce5726bd546325204b68ca925bc4ac338a45a1ac814d7cbe7112e357dc8a0363c4b8601df8967f572'
            'd0ea2cc00bba1416d544a7e69ce58f02b8b8f349a2b930cf71ff63994de6458af2ea3592adfd187185d16de15ff3041970006a298b6f1b2c3e554553915cc221'
            '36fbbc0883e17100b06e6b0de9acca38dae6ae35faf0627984b8f28dd9a8f08e4ca191bdd6ef48650473e8eb0bf25c8d7a431031895db6faa1436bf17e9b496e'
            'b34910d7143a5307aee7702bfc72c265e569f868f11a1eb71f28bc79fccf6404a8e77f4682af26f779cd2b64ed832c2c887c54c15ff20d2fccdff0d6e382697d'
            '9999c6e87f6e7a0b0705b41c8eb59a39e3253833e6e3d03db1b44f1c76b9c19a82d3116889099586833164ff4eb6a0ce26436feeab5bb3764d43be83040de407'
            'eb37b207640a13996b1685498712ee9cf3079b229ec5c28c2de85e73c7561738cdfa9b61cb4620fea405f6c1904e15452a676c3997131949689edbaf4d8b64a7'
            '4b09034cbc0953f813fdffcdc96634abb96f2f788be6c164f89a635ec2f01394a5e5a3af0c5c5d670121e1d9790e114e1615401ba0bc44bec444935249bf4cdf'
            '3f84bc081eb1c37763a8513e3b043decd4e981c5594a8ed9945111338e2ea48ad7ca6194e559697b01432694488fad2fe1f55acc56560467ea475e16c8cf2ac8'
            '36fb6cb89367bd67b25d30c2d0fc2927c45f60c071e00ca8d5305d0534bef7a6ab431abfb33bb305921c6b13ca02ba9d3a0e7f48a2f3cb67371cbe13c93a03b2'
            '38e055af5806830f248ef0935a465b9080d2f306076f667cc00016a44e5c725c981944d79375ee8a4981889fb4d18edc7827f9b1b93e121bc9aa94ceccb1c45f'
            '7b6f6bd487f3772bcdc9dbd7d69cc6943ba0836cbc88460312136c4db5a47a154d2326687632c7fdd0d78eebf5c8e6fd006cd3d4e0ae918def07047adaf70ce7'
            '4dd4491d49aa9d41e1c3f8ce3464251ff405ffcde9c8386d29a5cd9725aa2a4fa5f72360c5fe6703eb5121a2d5daf7e2e2968aa90e28a0720997d80e7f1a3a23'
            '399679ce5d2ddcd88e7f77b8e861916568b23bbcdc646115bbe330222d7f5e709e6aac1a0519071f1b32511eae665890acfe562361c942d0c9de6d388143d2ed'
            'fc15b88e81faa22a18b29dd5fb77532d0ff920a3eca76c7a28ad0916f9b47ba3bc6abe0a0b2ebd516238985e6f37cae07657c48c21c0467b8402a65c6f67253d'
            '141366b8775905fd6d3c7641959d5b810f39ebf85862ae73ed7d5c7716d84c785601bc29640a9439d3b5350d603813b1514ec371ef1be4bdbbef32a095becf45'
            '146881d1386bd674e89baf44e3196d7a37fd8b360e64fa9fea5590e57b8eb4f2c3bc3df38d1412b27713d974ca9502093ca860d5a07e40f17408532559198e2d'
            '7007ff36824c47f1b6b66e4686a27ba0dcee0464fb9bede7025c1d4d8f078bd4b98cbdbe715f64fac5bbe71c9b90fc3eeb290e247a5126a523c0bf11b61a48cc'
            '33a6ab4859d4c12e2065f1078e5022f7376530e49f3455f9e5ba4eb84646a51837f23728f0702c8e3fcb4c2bdb3e3de5232b116bbf1f34048dbd60d162582eec'
            'faea91ac5f17350e1bdc5198f61a6594c68c038b170d63f5eafa6176c49ee7183aeb49d314c000940734d92090472a9938d9f6793c16e6743cb51260c185a059'
            '789a78647d39bfd2fc652059d8191e03c461e4c456ce0bd7cfc608fd426d3647f4a33cd369378395aa5befd7fa40d7ad9116577a560d0b92611f20db3b728a79'
            '73466dc7d930f9bd260ad74a107114fa6ae20476b5cbd1c3a1a0b151ec1476b6695147dd0497d4c0eb9b5da70aaef0a1739f9c06fb22b98ce5d1362151728b09'
            '97872cd7cef2f8766e5e9a5388ad28b34fe6d65b653ec089b88e4709189d438461739401f9aef35601859ac682513c5d143ece09a4cef7a10cf102e39f8d3624'
            '24a81c7de41d43e0673638bc00884e6dbc79c975585963b7ae431377acb64150d88752617f01e7b377bd3c0834b00d06c5cce2ed8a0b088a404cfb84550512e2'
            'eb107805b2f38b17e90a9c8af61909b45844efd893595b95bccbdacf38dce8f26c4b147b3dc0acf3bf6b85466950eedd6f75a6513dc7d078e98cd81795c4a62b'
            '3614847f7c2c4773f17a1ea02e266749fb805b940f81dd31d91deeff4bf3e2aa87bacb9e653ca16b503ce9873e5df94b797c53158cfa85892657ba96361f0cf5'
            'b36ce58b483785bc3af9cc2e16ccbe2b1dd57ae871a102569e11b5364ddb19bac17453cc02c4178d4c94804738b0da640c2511758280d68727ec4a47b87f7c39'
            '4ce0a5f66c8c78f89bd3b387306adf0608bf82ec505ade557e591819586c258dd0d8e38d70ffa8523f197c3af9e1412f0a910a40264f477ae18f673cc6918f63'
            '823402e8e6f68048c17d9a65e4fedef0836c89ce274c13b426bf68afe1825ba6c19d177b6e926c8d3b4bfba157499929c3f55f2769aa9924a93e46f72bd9cddd'
            'b819823b9bbf702a770d8410790e8bd852ee241fdee7d8f1baf44f724515683ff3fc1238f5e0bc299509e6f2113b0121aebf26f3919a31a73a85f767a1e271d8'
            '9e194ca14b816439e79b7af17626d341e3ac7f648020e5940b9b6ec6e78509bee987106d707bfcaa433886970b22b87ea0138f112b7b021999cdfdca1d0b9368'
            'f2f9496045746addf256c459ed8ef391f584a8ab7c00c73049979fff06ab80bf4f34442619daacbdd553c1936d4e70b3683e01243bc1be733575a5f377a0e442'
            'e1ff4f7f2567a6ea6819aba205ec9299e151775fe10427611e1ac512212c9a7d2bee57cd7980825685d48d6bfbae90f1456206311b69974a7334f0d0a638a292'
            '70e02858fd9438c2742394da9a0963d9bcdf91ceb52e297bafbf15aa8d30c0ff0c7e4e8d3efa356462e53f7b9cf4c8c0023ca25e89e8b66a18bd588e7a6265f4'
            '6dce041513b0f550bb05aa21027fa60fe640e939d036ce46ac20f997e4ba87cc1efad823ce8d9eb3f17a38a47c28b1ce14d8998dad349b6d3b7de2ed9a5f1bb0'
            '11ec99af2d31f833c7b655a60097c57fe9b8de6ab626c06189742eaed5906160f6417c5772135c6ea34fac73df1b96f0b2245ec55157c59755d05cd305884bfb'
            '7de22e956cdf0c3660c572134a0675a7d15bdbacd9c3374184faf6e402a276c62155d31c8d5b7f0e7c3687675a1569c037cbc99459d2457cbb9f5e60c2b3e024'
            '771dfb38fb7db47c70191a11f9b3ed675f07c3633f93c7f96f74233db1854fe41cc125503a9e11238b9a7c54464c0ecc23b10d03cd933732570d745161f65897'
            'c706fb9eafdcc354c53e850adaefe65598650d9320c2e8c6f0160cdc264cb0b87bae3bcd41591aba2abcd7b976c229043c1fb23a54f306c7acd0145647354202'
            'ae85becba6a99e8f13332ce4ec17f2acc0bcfc7c266e65125f6b3b96296c4138db19875ef60d98fe9eeb615ee620d62b6f780ebfd5b65101b350f688a51d1d48')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    sed -ri -e '/(VCRUNTIME|MSVCP)140.dll/d' -e '/api-ms-win-[0-9a-z-]+.dll/d' "${a}/dependentlibs.list"
    rm "${a}"/api-ms-win-*.dll "${a}"/ucrtbase.dll "${a}"/{vcruntime,msvcp}140.dll "${a}"/maintenanceservice{,_installer}.exe
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
