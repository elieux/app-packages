# Maintainer: David Macek <david.macek.0@gmail.com>

_chocover() {
    # choco version format: 2.54.0
    echo "${1}" | sed -r -e 's/^([0-9]+)[.]([0-9]+)[.]0$/\1.\2/'
}

_extract_subdir() {
    local _file="$(get_filename "${1}")"
    local _dir="${_file%.*}"
    if type bsdtar | head -1 | grep -q 'is a function'
    then
        local _original_bsdtar="$(type bsdtar | tail +2)"
    fi
    bsdtar() {
        local _extra_args=()
        if [ "${1}" = "-xf" ]
        then
            mkdir -p "${_dir}"
            _extra_args=(-C "${_dir}")
        fi
        /usr/bin/bsdtar "${_extra_args[@]}" "${@}"
    }
    extract_file "${_file}"
    unset -f bsdtar
    eval "${_original_bsdtar}"
}

download_https@subdir() {
    download_file "${1/@subdir:/:}"
}

extract_https@subdir() {
    _extract_subdir "${@}"
}

_realname=keepass
_choconame=keepass
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
epoch=1
pkgver=2.54
pkgrel=1
pkgdesc="Light-weight and easy-to-use password manager"
url="https://keepass.info/"
arch=('any')
license=('GPL2')
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::https@subdir://downloads.sourceforge.net/keepass/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "TrlUtil.zip::https@subdir://keepass.info/download/v2_trlutil_2/TrlUtil-2.54.zip"
        "KPScript.zip::https@subdir://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"
        "KeePass2-Arabic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Arabic.zip"
        "KeePass2-Basque.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Basque.zip"
        "KeePass2-Bulgarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Bulgarian.zip"
        "KeePass2-Burmese.zip::https://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Catalan.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Catalan.zip"
        "KeePass2-Chinese_Simplified.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Czech.zip"
        "KeePass2-Danish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Danish.zip"
        "KeePass2-Dutch.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Dutch.zip"
        "KeePass2-Estonian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.38-Estonian.zip"
        "KeePass2-Finnish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Finnish.zip"
        "KeePass2-French.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-French.zip"
        "KeePass2-German.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-German.zip"
        "KeePass2-Greek.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Greek.zip"
        "KeePass2-Hebrew-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.35-Hebrew-b.zip"
        "KeePass2-Hungarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Hungarian.zip"
        "KeePass2-Icelandic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Icelandic.zip"
        "KeePass2-Indonesian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Italian.zip"
        "KeePass2-Japanese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Japanese.zip"
        "KeePass2-Korean.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Korean.zip"
        "KeePass2-Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Latvian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Latvian.zip"
        "KeePass2-Lithuanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.46-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Persian.zip"
        "KeePass2-Polish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Polish.zip"
        "KeePass2-Portuguese_BR.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Russian.zip"
        "KeePass2-Serbian_Cyrillic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Serbian_Cyrillic.zip"
        "KeePass2-Serbian_Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Serbian_Latin.zip"
        "KeePass2-Slovak.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Slovak.zip"
        "KeePass2-Slovenian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Slovenian.zip"
        "KeePass2-Spanish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Spanish.zip"
        "KeePass2-Swedish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.50-Swedish.zip"
        "KeePass2-Tamil.zip::https://downloads.sourceforge.net/keepass/KeePass-2.52-Tamil.zip"
        "KeePass2-Thai.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Thai.zip"
        "KeePass2-Turkish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.53-Turkish.zip"
        "KeePass2-Ukrainian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.54-Vietnamese.zip")
sha512sums=('f925df61d13524cc727ac10313d78eddf220648ae9357e07cbbdfd853277905804cfb5d0112f83ea70c2d3471440a13eeb2f82940b5e52352b595e931f9dfde4'
            '1a1f7d87bcb5703f7308ecfe25422e861e44e8398e6f118aa1b1cdb300d991654450cbeb6967d0b192439a3948771e2dce80c015b98e81481496f372e7a7684a'
            'abca16eaffaff069d51180efe0f2372fb93bee0ba7246292282b035a9c0e23c8736d70e7c91a8bbbd61d2cb18ac1fc10d802cea9e7e46110395f3ed22205e2a0'
            'be3675bbbe47d929a1ca6c5dfefd31b674c7304cc4bfac914d5be9656937554919478feb363fd3a51561bcf879941fcb54b701648057422c452bf677d500a839'
            '4fef35b120c86556b9cc09860f73c3caaefbfaf3d667320a2a7d724a9a3fdac37d5dad68c7ce77616f6006bad195a9eb24f79969607965850ffd915aeeedcd78'
            '0ce1285591f86503a02c33941629980baaa037e78da9fc80ad40990f09c15115599be8e19c47ee288b53a75827f01932a49ddaab410e2ba7a326cf7644665f4d'
            '6ca8cf74d84ae751459768a4d80921f45555c2223e99f2ebdf37c22e2ff24d5986d5cbeb2fd9c7434ecc8764176e8ef562b0608728b4e236f9836ee5d930a406'
            '8548df07918d101548e828e038bda9c593f909f17cd11cb568c987094b19ed66306f79e3e58d3128a3aeef20deb7061f9c1f1fc001e28aef355b42ec75a519d2'
            '0923b548fe6a82a8b8faab260670a4ead6b1262eed0f65426064ed19ed71b03ff7d52730854e549f561fcdca3cbb4d8618cd82271355ca1d7009a08d63fb10eb'
            '53e4e67b5410301ef8eef16923a930eb4dffe0390e8089b768877210f4b0300b1688c71709e8ac3d0fb9b1b19e30ff5e2773d012ac39e68378568dd424ed5136'
            'db47ccdf1bba38b7d236465f08bcd8c7acac0698dfdd9fab4af1674125ebb422744898f47f18ec9ace7219643f3270fd3b484c6856814e9679c1f34ecc5d1dd3'
            'a3584859709ef51bbf68f1703eb82178686d1694bdbf1a8ad992f6023bcfe67269313e1279e75c5450b59e693037dd93ab87285c8f43cb60e2dcd75bfc216020'
            '2a52ed8066f187164b0442674f218942aa3ab9b8edfbc3742af6657a8098164d59d220cd3111af3dbab605ccc8e9f4aec4eb9fef515bb9295f0250efef2f4ca1'
            '6f19f0b05bf4b0834540e58b5a8174f79ee0e0e39683bbea73811aa4ff61938ac99c59155bfdaf679d770c41c536c9af7325af07475e52d758737c25c7ba12a7'
            'e7ceb592632d9031036e6ffde8c1722b35193992a420dbf0f840408ffd3bd88dd331ea59bf24df43f612c53dfda4fcfa520ca0d9ee955c3d476a0118a44d98f1'
            '2ef568588a24db4777969f35afd5e803989ae4814bbda6c7fcb674c0b40791ba43dbbce3613f05324d7855c519642e10d7f14397fea7bc95b1b208afc1a62648'
            'fb744303602d4c437aea892812fc6b9df3589793a4eb416c7da7241639571654eb71208e3a15b0e0bcbd58de0f509edb977e622ea27382a22f098f40399a1434'
            'b620ff90336c094edc9f5e00041847e8026f2b2484bcd2ce9e7a9232dde31db65f98e6b1aa104106f7e7fc812f689c834bbc49b72880ba6111002f928111f7f8'
            'c05c9e06775221a6a47f76b543dedeb307ec8cb76d6e8bda509d58c19ec824b198f87ce1e56cce4c910d3f1c38b6d0347cad5ace6e208550043c44fe18108b0b'
            'cef49be6a61dc5fd20580fbde2f1df090450290204ef6a652eff1a043924a3be7142fa9c990c704c19711e87b9b5d368887fed2181253c1b20c9e98b65ae6877'
            '6330ec5779b877b702badfb813cfb28c32b6bbbe4f6271586f39a7f166eeb10228c31af0d5e4d98e7c0f8de48525d4756663d562f184ff79b2ce8c91dc2bfc9d'
            '477a90c86a6917b0672f08612c802136c2d61f3fb118ef144a487f3975f30091c4079641a633b69a701773ef964b81557c2b53437afd280105f1520941324cf6'
            '3392ffd64a3df314f04474ec25d2aa0d83d8916e4e3ef2529e7a42ec8ab6384384a0c246865a2b97ffcd69579fd3cd9c5b40a20b9cd365b727ac0775b12a5a72'
            'fc4926c62a7fa7bed1394535b7245b7abe3ac33af5f3e06bb6358dbf62fcfb967e4528f85043351ee1e030960627abc74afb8f6b145c6bf3ce56f81691ba18fb'
            'c29f335eb1856493cd2f32a4b44e6596ad7b267ff60558b0fbcda240a1bcf5f4b577f82661fd60bbf76b4f8ba354e0af9210876fbb845e30d40c9ebf0a2a9db1'
            '64dcc7f3dd3302897e70b920fd8b79efdc5d43f9d1428ae163d3b75047dd8c1524ea44d85eeea3fb6d02642db2134ac43015e3a7152ff30e1ae3983118261217'
            '5351f4bb2596bc86a208da2ba6eab6ce42f812ddcc4e7a5911ea2ce0a101d63f474a53f894b3380c9e21b54e3263d4b07743f8eb77d91ef1b0d7b6bb0507a8e1'
            'af80a6a57248c14ef710fdfac05531d42fe937105e62c15de4ecf16185e998b2c8719b4b32e1eb4bf1fc0b7cb577f97565a94d20778efd5ab65b59c5baddb3c2'
            '25cf8f42565d50c5e2157c67d0e7d8bf0a3d9269e45651070775b2db1a998e42febcc77e4e59f9a1cf4357661aa4b5f1fd0258e609e1c199307d2d7d696fc7fc'
            'cd5e00e59b0d681f1b80c20734ec06ef9d317320cb56425ad2dfc55c4263c4bb16def97a2c4c7761079153abf8760dc32335a5bf26800431bc099e27b9c9d022'
            'd09412be0abb999e698d7fdc706172d4c09a52abf8dcf8a44c27ec3f3a2d97765ead60c3efaa6ba8951eecd78fb6a12133681a35a671b7e29a5f6e89a0c44908'
            '17c185bbc43090d4d22e137441e97c868c4cd6417d120bc72509b008a85a8b0eab0ca0b4e4f7f3e8030b01dc0b5e126f2d71108f176bfef59133e43b651b093a'
            'e2619f4b55530e1eeb92c378ea1db2a81450cf7ee11f8adf910199c3bc96890c548447bbf41b02cbc8f6f828a97e48c4cc7bf7cb64ca2d436ba381bcdbddf8e0'
            '2d9776f06283612c10598afb8c42f64e4f30bdbb551a1b3a6af74eb5b0b879318f14d2e631c4b34a26008e87985b3739dc40c6e6f298b0fda2f7ce89c2d326ff'
            '6c6394fc1da31f487389f3416a62c72a30e68ecebd3d626c2d2def7534cd9a4a4a82776b3d2b7195b8c97cd82d9b1b6f46292013f8c31a276c366027c82a7d2e'
            '1eb3809947507240f0a66662538ae16dd5a1f9efaf2cd365a7d1fa1d6597bd2f9f1913b147e32f067d00d0de663a4a07cab72c0426db8af20ec3ff401b4a52da'
            'c5b393380b0ddbfe22ab48c4175d963a1d0e730afbf1835696708cf542ca30ead26b65d42628cb0b8fcb54ed1a545177ecb4720c21a2f86d8af4b0f3f2bc81e9'
            '70fb9411de3184b5f663dad1a4805686bb7904740fd98b06de46e13667ebf389a3ecb718d7cb85bdf75d84699447e2bfce144474f26e1ab5c058b408d2e5e5e6'
            '05d98c2775b2783fca341d08109f4e5a9bc95594927525cd7bb34e9324edcc209a386a7c3396d05bfefef94e3bcadf04b6da5bcc2ec8f1a866fb2f0c1be4db2c'
            'dcf76c9fcc32921047da8f1a1e7eab1e768d8a876428757c5a5586230f0490a4f0b87db14d47bcb114974dc890fa73a1186937923b660174085b9d0194d825b9'
            '62f574ff065f92f24f03355c90d0ded1b1e5988f0cbafe2b740de8d6ee71015c0621b47c384a5168976619168c37b148899455277ffe62e9def47246bc7b902b'
            '1e4d58682b57568e59a9a732ddd475bfce99ebb5a7fbecc723d36b564415b687303c92257b383980b4a45c03fcce6dc99c9dacd0a8d3bf1a556eae18d39a0995'
            'c7e0a3efdc8b56edec77b6bfe58991282005e820b15749f570e6f58b4a6247b47fce41c3fa9160fcf2838136fe3f123f709c4069adf1bb34e23be1a833446015'
            '742455a86facbdd1c208dd6dfd3d43881ca64e9624633057b5a38abd384c0476a69cd0d2d910113928278fceca6ed18b371300a8a9b83de7eb937f5130bbae9f'
            'fef4c95810539540ad280323bc1459610abc5af297596d73253aa033b1b0789d3b8eae1e9beed67df1c38efa0b7bf89d6589568240a4715cf51e089e783718e9'
            '43a43d377b887a30eafda4bbb80c3624a018f4addc6dcf7c07eecd3f5c0ad65f724782dc266a9632b5f734beb39c8d6907fe5568d02b760c7fd14c4b034174f0'
            '65ad20566c3afad57521a271e56ec156a9f66a26a6b39d59908b6b097817f000f8abba7e185cd9d523f54c8006f4a77795296d152b3f843f2384c858d068f816'
            '091470bfc4fbb317cd87dd811e906e63e26fa41849d8e84f342a6060620c77ab1f67b47acd8a5fb72a1bc6a8fa19e2e5198a21990322b860beee1ca3bcee17c4'
            'b2f3cd8cb26584bf28cc3ffe71048f1ef9776c65a7272a4233f878836a3b678ca7dc1a9cab01feb1a05ed4f714e949b6e913f96d7c6703981dd05f32366274c8')

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "KeePass2"/* "KPScript"/* "TrlUtil" "KeePass.config.xml" "${a}"
    cp *.lngx "${a}/Languages"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    #_lc "${a}"/*
}
