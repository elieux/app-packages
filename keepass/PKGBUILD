# Maintainer: David Macek <david.macek.0@gmail.com>

_extract_subdir() {
    local _file="$(get_filename "${1}")"
    local _dir="${_file%.*}"
    if type bsdtar | head -1 | grep -q 'is a function'
    then
        local _original_bsdtar="$(type bsdtar | tail +2)"
    fi
    bsdtar() {
        local _extra_args=()
        if [ "${1}" = "-xf" ]
        then
            mkdir -p "${_dir}"
            _extra_args=(-C "${_dir}")
        fi
        /usr/bin/bsdtar "${_extra_args[@]}" "${@}"
    }
    extract_file "${_file}"
    unset -f bsdtar
    eval "${_original_bsdtar}"
}

download_https@subdir() {
    download_file "${1/@subdir:/:}"
}

extract_https@subdir() {
    _extract_subdir "${@}"
}

_realname=keepass
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
epoch=1
pkgver=2.45
pkgrel=6
pkgdesc="Light-weight and easy-to-use password manager"
url="https://keepass.info/"
arch=('any')
license=('GPL2')
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::https@subdir://downloads.sourceforge.net/keepass/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "TrlUtil.zip::https@subdir://keepass.info/download/v2_trlutil_2/TrlUtil-${pkgver}.zip"
        "KPScript.zip::https@subdir://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"
        "KeePass2-Arabic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.39-Arabic.zip"
        "KeePass2-Bulgarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Bulgarian.zip"
        "KeePass2-Burmese.zip::https://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Catalan.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Catalan.zip"
        "KeePass2-Chinese_Simplified.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::https://downloads.sourceforge.net/keepass/KeePass-2.44-Czech.zip"
        "KeePass2-Danish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Danish.zip"
        "KeePass2-Dutch.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Dutch.zip"
        "KeePass2-Estonian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.38-Estonian.zip"
        "KeePass2-Finnish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Finnish.zip"
        "KeePass2-French-c.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-French-c.zip"
        "KeePass2-German.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-German.zip"
        "KeePass2-Greek.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Greek.zip"
        "KeePass2-Hebrew-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.35-Hebrew-b.zip"
        "KeePass2-Hungarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Hungarian.zip"
        "KeePass2-Icelandic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Icelandic.zip"
        "KeePass2-Indonesian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Italian.zip"
        "KeePass2-Japanese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Japanese.zip"
        "KeePass2-Korean.zip::https://downloads.sourceforge.net/keepass/KeePass-2.36-Korean.zip"
        "KeePass2-Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Latvian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Latvian.zip"
        "KeePass2-Lithuanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.43-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::https://downloads.sourceforge.net/keepass/KeePass-2.43-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.41-Persian.zip"
        "KeePass2-Polish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Polish.zip"
        "KeePass2-Portuguese_BR.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Russian.zip"
        "KeePass2-Serbian_Cyrillic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Serbian_Cyrillic.zip"
        "KeePass2-Serbian_Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Serbian_Latin.zip"
        "KeePass2-Slovak.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Slovak.zip"
        "KeePass2-Slovenian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.37-Slovenian.zip"
        "KeePass2-Spanish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Spanish.zip"
        "KeePass2-Swedish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.43-Swedish.zip"
        "KeePass2-Turkish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Turkish.zip"
        "KeePass2-Ukrainian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Vietnamese.zip")
sha512sums=('e7b38972377097e157dbe40f421795473fb9a1ad7a3726561898b2c538a187492872ad6eee41bfbcdff6404f91129e24a9b0fbabca843c064e4fb2bcd3b201ad'
            'd7675c729689e7b51d8959b86cd6838bc8445588cbb3387a596f5d613161227d6dd0852127e90d70ba9a871b117729cbc0a4c492bb98b15aa39791dbb0f04ec5'
            '8a5f8062f81328b5c8eab473fe33808788bfdc123b723777b78f8148cbc8a37d21e79305256ed069d7075ee112c473f616b1e2d639c1fa9433ec01c8b12c76e0'
            'be3675bbbe47d929a1ca6c5dfefd31b674c7304cc4bfac914d5be9656937554919478feb363fd3a51561bcf879941fcb54b701648057422c452bf677d500a839'
            '44eacfbbdf36938f992876689a447ce72a8f6e0cd8af84315ccb40fe86d4a76203a61a24edf58dad39a857366628ea5cb6cc84f2f5897ced12e89da18180d02d'
            '31574644d01144395a81853453b9057763cafe88379e62d6e9365926f84ad0f23be34fbba7eb1193a7ff5deebaadb34522bea2719cf6340d50827fc2c6d8b48a'
            '8548df07918d101548e828e038bda9c593f909f17cd11cb568c987094b19ed66306f79e3e58d3128a3aeef20deb7061f9c1f1fc001e28aef355b42ec75a519d2'
            'b99f9fec53bd6f52ea5dfc0d00530a6ba3a11e31fcf910ad330fc8c591bb01a2ecf63bba53ded902948bfcb9961c0208392d385b33f75515fbeaff648971f4e1'
            'da63d6867a7235f8925e3196fa29acb2225647aea84dbb01308206058cb1965406fcca15f571c00c6f96f81c34decccaa4c391c96ccc21013c723d511e4f85e4'
            '2eacd2221ad1224a345d02f3afecf4404f828b8856bded1183468943d062183760eab7ed1ea589d27dfd4f9045bdb82add61bff02a7adebb9ee9b11a43ed7e60'
            'a3584859709ef51bbf68f1703eb82178686d1694bdbf1a8ad992f6023bcfe67269313e1279e75c5450b59e693037dd93ab87285c8f43cb60e2dcd75bfc216020'
            'f0e38f8fb1a82ccb41b64042107814f9ec9774b7028f9003ab293fea8847e1b507ce120053905e1bccf79d6a4eaaa2aa8cb6bfe392db8071d700f3dd339992ad'
            '21bda17b2e01f2cd42740ec10b28ccf073a56d2c462de0e07634ad1ca3facdfba737750811f1fafb69b2e38d180dd29aa46fdf4f71065e5e80d7cb80af014530'
            '60ad3cf05e851611e2fee3705f8601150d13b92c251e5e9e30dbf35ffce8779c8e985f91c27d573678ed890d65f28edf23ba9d13b64fa696279f88db03caf638'
            '2ef568588a24db4777969f35afd5e803989ae4814bbda6c7fcb674c0b40791ba43dbbce3613f05324d7855c519642e10d7f14397fea7bc95b1b208afc1a62648'
            'd4062083280fd1586c16d1a82099a646b6a191230e4ee7437e788935a1a354ea6c0be2bfb9b1163ef4e0d163a9b6da8f98c13b6fc09e3c68c64565a13e49c3f7'
            '8d3b0e5215d163cafacc36eb2358dab15be9dd5e643d85996102320cfc5d9e5eb22c81820aaa8021d235e0598acaccb2d167c53b54a0b8f59960b8da40ab432a'
            '6c3aac87d723f40d2d402d9b7e58718d7ea34fe8c7f0b304e450666695a0f7f53be6fe677f721d6edfa915e038426be293b2315908928a9c4d94d1d92ba306af'
            'dbfbd2e5350062ce3b673bf4701360d418b4e42bc962f3f9e8469a78ac58345d9b77e33e3f9d4a248cfd83549027b2b856c44cf8a82df72a5d2ab4e2374bf8d2'
            '6330ec5779b877b702badfb813cfb28c32b6bbbe4f6271586f39a7f166eeb10228c31af0d5e4d98e7c0f8de48525d4756663d562f184ff79b2ce8c91dc2bfc9d'
            '3745f84a190170a5974d7cc4fb65df8b247163e3c90d6608b1988ef5fdb027b84a6cd231fc3760157264511bf707af54ab381d8bc19b1afdb89feae5b5c56ded'
            '3392ffd64a3df314f04474ec25d2aa0d83d8916e4e3ef2529e7a42ec8ab6384384a0c246865a2b97ffcd69579fd3cd9c5b40a20b9cd365b727ac0775b12a5a72'
            'fc4926c62a7fa7bed1394535b7245b7abe3ac33af5f3e06bb6358dbf62fcfb967e4528f85043351ee1e030960627abc74afb8f6b145c6bf3ce56f81691ba18fb'
            'dccdc4433cfff89dbb275701f78028f10a7d8344e948a86a0db2baef0e3eeb5a903ce0bb51706658e1be383411acd4c0ddceea15efb75ba6962d2147a6ec39b7'
            '4513c3215791a134702ea3370ba077b293ba368eafa0b8ae7b44a21897c232c3bba8c1d36ef4a4f2bafa3cea3cefb720fbb358afb176d46e1d17b3f9f4b94ace'
            'a9acb1ec07163dd54f8a4a350ab13bc06f5738517f6ea57cf2798a7a1345dc4214ac05a7eb13944eaa03182b7e44781ade98dc97d708ee3842dee9fae8c833f3'
            'af80a6a57248c14ef710fdfac05531d42fe937105e62c15de4ecf16185e998b2c8719b4b32e1eb4bf1fc0b7cb577f97565a94d20778efd5ab65b59c5baddb3c2'
            '3abb2d131b2fd9f3bc749d8009eafaab22ee153331725bddb8cdfbdd5218dbba532b06c87a69f62eee523c0745c2874811d7bce1c36e0acc6e0e36c9465e021e'
            '19da69a8603b8714d60fe01abfb6bc0972c4d463391a0eb4465a507b097d5a1c50d324d71870cb71df5b0afb28a4060bf229669b19ac4b47e15d12c6a6567c38'
            '4038da7f0a58e53d5f83ecd9e9ddd15bc750cbdf721b51397d91def9bcaf28016af2a2eee6cec6506ed2d2341185a1d38567c5139f123cad769398cbc3dec700'
            '17c185bbc43090d4d22e137441e97c868c4cd6417d120bc72509b008a85a8b0eab0ca0b4e4f7f3e8030b01dc0b5e126f2d71108f176bfef59133e43b651b093a'
            '5605b97a6110b7d362f8c35f2a145ec458f09f1605aa99a8115da41a042d26805caa211515504725eeaacd13182cf71d05827dd8a62594fb2860ce98d0b71ca2'
            '64b8357ee7b64fb372ae01877fd72638dd7267a322c6794f60e719c2dfcc55444a183a00705747705b3c8ce6a4cfc4e95baed0b4c6f559a8f5bd7249ab3a1491'
            'bf6230424b975aeb859e890fe9c534fd086ab66d9136d082bb1378f11568a0875e2390192a4e3f61bb74b331a48effe01763052a2808e769239a91545241fbd5'
            'ba9f9443a6ab78874cb20a52549be7963adcd1db8425d1b02d757322e145b7ad053e978cf252666603727f59ecb61c3e802b3167172a990863394aaad5a3e8e1'
            'c5b393380b0ddbfe22ab48c4175d963a1d0e730afbf1835696708cf542ca30ead26b65d42628cb0b8fcb54ed1a545177ecb4720c21a2f86d8af4b0f3f2bc81e9'
            '1b67ce7646474dc68f1e588aa07e12b147df2b66ca155d3b1e1a7b08c94c220b19cd1f62da28b2c2d01c519fa6b273a3ac03af91b063786bc0899b9a6da846d9'
            'df2e7143b7d730250a74cfcb9eeb38bd706f56a646c5def67e18541d1d27ee58e85dbc948b1a43e0c3c62821acdc8f8b1a4eeb8fbebd65af5b64ffa9364132e6'
            '1b52b5c91dffbacefec3ab1392bff07eab4931cb442af4de608e0d05e231829164acdc407b58198a5c8b356c4db7e6aae4153ed7ca2ef3a61e371a57a9bf100e'
            '283fc7a52ed9b6b78aa9010dfbed6ceae3ae1c43141d6f4d37698cb504dddcbb3f30cd48ac2e182ce6b8a9a180b7aff1e3282992a02485c0e886f115d538cb46'
            '1140d20e4ae6debb6a6ee39ebfb89d66089e893704b4a7969b36ff5977e8b9467e255e6017ea5874a6abbad4ae058339a0f96a08f07942ebec91f1a4b6f84d28'
            'ff410a5c764e61e63d343b5c391cf7a356518d6c0f46da75d368a3228efd684c82c828a10698d3921651c4d7a4ee853d811ed12a94e0f1bff231c63f43ea8dda'
            '98ea2f0f70fd7afa3ba61aca881c941ed1739baae438cba05d759876ad008071fc47d415e62b0d33aac86475508148cf29913d0102d3d139c871335130acee83'
            '48f23639781e034fe9fc4738670e59b3605aba856ca3858dc20bb3d729e418d91088ab169060585f1cb918c441eb8f1ae09e1d990f085ce081d5eea45e2ed2d9'
            '4df61a2221cf585480c421c2be97b0511c13cb15924fe759723a31f68eab189cbbec02137ae17f29468e48b7bd5fe6529ad0c16c02ed1b5141805f8846b7e437'
            'f3068a47016ddcc3f85d4a73b3fe5c8f5ec1acefb994c7038d4357429b3146471ecb0fe690d96e90313b0fd2792f0a1e06d3fda865dcafe852228003da79c08c')

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "KeePass2"/* "KPScript"/* "TrlUtil" "KeePass.config.xml" "${a}"
    cp *.lngx "${a}/Languages"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    #_lc "${a}"/*
}
