# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=52.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
sha512sums=('2890ed230ee82443c7e394cacc92b3fae7a4f28d3f88bf587660b62e9f29eef1a104e7d708b286908e2c6a6a92f19bfe37e74bba17ff133c908c7dd45551809b'
            '640a3a084d4dc36c6bba6f0e17bb0de3a98fb78bab31190076560590da8dc6a00100643e3328ffed30faad58ab1b26940d36a494ee0bffed262637d9b879bf91'
            '989d3c1a5d65bfeec2d724cd403e6ca198c4f1d26a87d1ae0b4094a72d71155b314ce8eee381f47e481818d9de917a746a0b56d6f3214f0b59778c60de77e12f'
            '2f8c6471f8bee55e4f19a49c2b522da8bfdabfac755d1040ce48206910a5410319f12ae9f35b8bfd068ec0a9caa13ad6ab0a6cffaf448d323d4b93b461469bed'
            '6ef7f0b1fceeaf3913375e2d7b2bfef93cea8a79c670f059c12fb23a5e1844a51350655defb65b69b07de0e9b9d2c3da73605f9e8920d81333a1d2ed2b3efca1'
            '2d7bb99099b0f132fbec5115dfbbef63774e7f968f67ed97e41179396a044689c1928a01ef52ea38243a9feac0ceeb5ee233ce4a8b1547efe166cd98ad009d45'
            '86429f7eb2335ab92e605afea79f813c45232119998e8bd164efcbb546a2ab46992ce993eefaeaa45d7cfd9577a9cdd3c804036ba6680961b9e7ede169319070'
            'df12aa7198e3fc31b006adb29a219f646f6f0392b2c096be9acc8e81a3251c7ba9acdfd575178e2dc6546d3e1bdbf7e171cabffb26fb9896ec1312344d3bef82'
            '14c92a3ab10451e9f99393324d4e067556fe8eaca5589f240379d8661a7f6183c4ba94a341a2b8fccd252805dcda37694cc10a75981c9dfda29dc193fdc0d5d4'
            '06f3032ca6bf01f5f121464530963f02146aa4a5eb06ea646e1621139eb2be6338c3db8fa00bc8cdea88692f4456c4a3d512671edf3971fc9ec22717165f09e5'
            '6410e6b4559c86db2b7dfc1d79514b2d22c0a09040e9277b244fb5107e9ba835ffbb77a1769fed366b58a6b35e6f71cebdbc296f7adc5b6b0f976f0892719a88'
            '2bcaaa083e4adff53816957938b8646c5de523a797b7129c84762f4905c7c5038b466aaee4d7d183237bdbe8bf2ba8c1bbdf4eea71205d2537f1fff443445bc2'
            'a01c53ddda9fa16552a4cce0c75e8921f209942eabaca93ca3fdbf9a55cbe58407ba36196d25d8decf139092e75636caac22b19ba5f7ef03f38266da199c4075'
            '6e2ea462e879b1e77e02f8ab9de9e5c9fcd9f9416f3151de4ab8aa37f00384ff8489314a5a867a8f1031db4cfed2326a8fb860ef98e19130f302b5c696d4b8b6'
            '5a2607f7f1dc480d56fd2d874edb0ef72120020a4aef9bcafe43c7d5fca6fdd206a9f73eafb8a5859e40b0ba83bb5bdc5b293ed1c22fe086d05fa9fd1dd8ed26'
            'f699e2462bdfc03933e8baa151fb50710abc4f539019dc288af9fdbfe7610b9f274d70389bf3062b3b40edf7a09ff2cb3fd57c1059a36b4af7dd960848e85869'
            '60a494aab7b1e9ee7ba1eb5d806cffb7edcc82023d768649fc3f82a3848bde1f3a8e0e82212303ba900cdd44b7477f2cd6589f73be841709a8eaa56a21ef0648'
            '88a522cf0306432f18d512092d8767225113aa4ad515c8ec4945f681c55d3ae93487037282d49e895a5b98cebdfe83ddb045048a96f1fc702c1d64fadf99caa1'
            'db0334faa47c2c98e096624e8d82099ee91629e1a899ec79fcc808c6d0c6d31c81a6b68bb8ac0220c2f7d4a177a1e7caddebcb4fa1311d2651dd79051f145cf9'
            '650168e195a449732c0a4644a0cd38c6d2305041fbc505dbb8018d9fd77bd97ec42286dea14a97a483f9063c6bb3bc1cfa1bab6efbb7736b5f603ca3f247251d'
            '6a7e1dc18254d83078d876f28faa7c5c2cbffcd6db9b7cc949b114c271639f1ef504062450812d40f013df844751653826795c23b61d12d395261b6df257fbb6'
            '77ac55fcbba4ca594517675809fe734bbfd14a63d0242524fa0ab37bfc596c4f0a1b4061aed7abf230f62da753fa49e67dbfd1b3f970d6fd73bcd6cf876f6171'
            'e6ecd4e6498391791482cb8d2a5df643abd10a7554a998ba13824243c57386b256088c24b9751e1884e34b4545d1c4376463e6578375f61ed7478f94ed564e09'
            '7d5594933f4a16ef13bef66f6f22fa1dbe02623d5e65a20e8df428271c83f7e7dbc1fcf84ebb79635d23fdbb8b0c8a3fc71a7965e1382ad5864c275e1bb8ec77'
            'b2123691b8f35f7ee9994305837561402a5ad0054578407f78f7abd458348a9fb722a81a60077b9ee43b83fe5cdfe53048ac5770e35307a9f9cbc8255a97e7b9'
            '4b82d377cde76a3a215726661e97ecc6562dd047f0e28cea259d9aa86f4e3811c91c8cc677d6024d26070b910ca89f0a5f6187f360bbeda1c06df53e994768c5'
            '0503c09f1b2460c6a4ec07648e5f64c33add3ad490d2f00cdc94286fbe9016e0cfd54df1bf8a86d90860a4cdb93e2a5094acace7a3f3ec7de8c8b70bc8023a74'
            '6f06b47b93a5955fc6c0c0f185029ea4ce9eaac1d8f6d973d35b1cb2fa4f0126dbaabc55097bec654073a79f51f4137b42243e38c9a9144b398705120f45f52f'
            '74dff5ba77c43973ead47a9bc8340067b2feddeba26720cfad971cd4c163569dc887b402a7c8c1bf8731bc29d4f66fd229d99a6eabdfac923d525ff14acc9890'
            '4e68b300655fcc5f38938f14ce7651019df869fc98d5add3b5296f5e49f83bac225effc2de63c3f2026019fb637002a7060f3d0b78a89a4345bc43ca54f9f34b'
            '8814e576bea57435ad42c7c72369603488ffab91eacee0242671b089f0a2f1e4ee1448e738e522c43b00e0f8f77bfda191cc2cadde7c2cc07276a6027ad045ae'
            'a6c59e6338fbe2eac5390de1d9a08a2c68eabcddb6f15fc5f47da8ccbd8b2225f485b325c387738c2137ba22c5523de37f2552d9abd8e6ce41ecc026e2990e6a'
            'e280601d70a19fb5fde37d120273a446ebaeb45d79a9439457bf6cddae67ab977ae3ee18bc1e2564ceabd1c547e2a5147c73b4a7d996e5356e8ecce68e8e4176'
            '80df4bc7bd54e9bc46cc1aa3c95bf30bdd0a2de93cdb453b9014a142679c2f75e6368ecb08733670a76d37daed6acfd859a5d9ad44a309fa4ae2961ae1584426'
            '7ef23d598a3f1f43020ac683c71f6064b4c56289e67f5aa1b63bb81bbe1a4e78620e438ee3cb696f1292530a8bcc05ca9ac5a2907f6a77ceae033183a7d6f810'
            '62982b34dc2a2d694892c5422f4a280da3c9dd7289174d49c077b6524f46e110bd4190677978b63e458a416a05a9679b8643e207e0f94e822125581472fa94fd'
            '7f31f7851a022ec084622a28e1c4cde14ceb63b081b351e347185406fdfec223b9f7eb1cb67f1134a1991617316d9c470b166b9ac0e426a42b3fc9f9a4c94716'
            'a72a9cd79cafbc174c35ee9ae5c30bd7f25a5b7a31c2628cccfe6611ec220ec89d9cfc65848fb2cbaff05222f7cdd24a19e8a3444b8603d5e90a223ccf277d52'
            'bb3c470ccdd697e437511f92661f6bb8126b9b7414b78793c48727eceed98dea2e075bab7a870b8432d68b1a38f7703600bc8cb8e9f2c0741899d6826a54a57c'
            'b095d1edcf30d6d5c33dee167be40eaa9de9eacfdc9858ae0f4e50da083a15cb31001046d18a95dbc113d3c42bc0dedb09cda817d5d9a3274a0e3ee570d24d0f'
            'f96ae1aef0c5839e73f46c2b5a1783a2b00e89abc787c1d79664e8ebedb1393e075aad4a4d4db308ea0c41862e657c28d59167d0c9d7ff72c06756154f83f230'
            '2c9af829d4a47f482c74abe73083ce2d599ee26b1d88c29767a509e5fb929575f1ce53d43b865a59fede875aabb924f450d961476fbc32daf8b243eb0c389be0'
            '062adcb21da6efffa1a3c631439ce0633fc6b3dd9e177942e2a1452feb519ef78aebc84dd2a3f149c29f064b2ed78cc5dce697f64c2a26f9aaa2f3f41af56489'
            'd939733a3a8123cf351033e75dc9444e3b8f15d6956e9444758769c520db5c75c3870c640e7c69f3567d0cdd3120d0031740eb5ac0c81a7d655ed9c52c699122'
            'a52866d85cee83b28045c3268ae15351673f12b1cfd06e0b93cf93777f0c9fb308c63bcc1c199500171f70b8c1e08f76d99be93b59f74a583ff70f0217ee7b87'
            'accec1589e20343c585bebf52f461a3393bbd7ef1add250ca5ae44c363c8b523e8f9d0901cddfd869d068346bb3c8b29d5bada21c0a664e34279a2384a3c72d5'
            'd285d1d4e43c00fcecd7f2041edc5bc269c1affcbbae622da2d6eb7691378227c3a12861b6beb915a46ef3d30395687ccaaf7fcf446a6b040c3021a38f556f58'
            '58a59026d1317f5e482c00f655646a8646eac725f75ae1a22f67ba68a32137082846b114b6657a7d840f04d951309e8c7676b8d7dc2c592216fa43d845abcd5d'
            '2865aa10461124dda55dcdb89dcf1e62fac8e69a319a3fbaa41e6c2cdcc0aed67a6f72df86d77110707f18449493fd5fa70917214c7f15353e9d64e340f53d0e'
            '3ee802bfd2845da962c829f0fd7ba976cc16717cd93e50573f7b76df16892683d5cc6b65f95d23060dedd5124268f8eb47fc3803a7a2ebd792728c13c0940122'
            '065b43088c143804a954e3c5d9f5880a6c743d86dccf82eba84ea3c9f3865889e3ffdb262d95916169f210038833e5f0bc50b349e6eb15865d5e57960d5be0f9'
            '5c66eecba0d30056db085bea8cc3cc195445a8be8276e08602f45d9571db44171d8d782a16f6a7b3c6ba45aeb16c6068645cf40453331f48e6c5ee031dc3c808'
            'e2b6c731662e6f92da11ab949d4cdedac1809b244dc7b2822061265b3819246f86f6a88140a7276a6b3398bb23740969bccb4993dce2394d9479fc9664473ebd'
            'ebf35d4916ecefc5c6d81d1505719fedd2251f3be4cbd343693f9194bb4dc37fccb0a40d5b17445ac11351ba0cc8c8a6b7646f576fd758fa1c66309b2f9cdadc'
            '89c45c0ad85ad7e6839ec663054f81702afe09369827779e6ea0b931f8fc6a124cf16333b2441d5d6b305cc341fd7a2db377f7cc435f24a3783dc0b6f266a60b'
            '03d292da95d268ccd9353563944d5cc86036f0054d4ef9803b7dcb3127832d78c0e758e79352570421ffd0b6af9f24d8ca2b96e4ad5591acab62d094f1bb7036'
            'd3d6abf961763af8804662649db6ae1dee7c866d3118b4ad1e0192e154982f73e02cf5b7d6551216f2d40d9277ef4d15c58dde67d5a4f06fe3a2542da5851db2'
            '4839bd632346917ce2f3d12b2584ae679f040eaffdd19edc7b685a4fa9f2ad92f5a19f6e98f48b8fb779e25a94140c0e96f266e9ac94dca3f0672c3ad46c4b86'
            'ac8cec9408a509c77ebb807536d044f1b1d7a90ccabc3aadfaf46bb71ccfc6a3c900343ac6c95f46ec258441e18acd109da64ae9182dc20995c2b39568fda2f8')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    sed -ri -e '/(VCRUNTIME|MSVCP)140.dll/d' -e '/api-ms-win-[0-9a-z-]+.dll/d' "${a}/dependentlibs.list"
    rm "${a}"/api-ms-win-*.dll "${a}"/ucrtbase.dll "${a}"/{vcruntime,msvcp}140.dll "${a}"/maintenanceservice{,_installer}.exe
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
