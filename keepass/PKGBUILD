# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=keepass
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=2.31
pkgrel=1
pkgdesc="Light-weight and easy-to-use password manager"
url="http://keepass.info/"
arch=('any')
license=('GPL2')
makedepends=("unzip" "p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::http://downloads.sourceforge.net/${_realname}/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "KeePass2-TrlUtil.zip::http://keepass.info/download/v2_trlutil/TrlUtil-${pkgver}.zip"
        "KPScript.zip::http://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"

        # translations
        "KeePass2-Bulgarian.zip::http://downloads.sourceforge.net/keepass/Bulgarian-2.10.zip"
        "KeePass2-Burmese.zip::http://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Chinese_Simplified.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Czech.zip"
        # "KeePass2-Czech-b.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Czech-b.zip"
        "KeePass2-Danish.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Danish.zip"
        "KeePass2-Dutch.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Dutch.zip"
        "KeePass2-Finnish.zip::http://downloads.sourceforge.net/keepass/Finnish-2.18.zip"
        "KeePass2-French.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-French.zip"
        # "KeePass2-French-b.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-French-b.zip"
        "KeePass2-German.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-German.zip"
        "KeePass2-Greek.zip::http://downloads.sourceforge.net/keepass/KeePass-2.21-Greek.zip"
        "KeePass2-Hungarian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Hungarian.zip"
        "KeePass2-Indonesian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Italian.zip"
        "KeePass2-Japanese.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Japanese.zip"
        "KeePass2-Korean.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Korean.zip"
        "KeePass2-Latin.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Lithuanian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::http://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::http://downloads.sourceforge.net/keepass/Persian-2.08.zip"
        "KeePass2-Polish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Polish.zip"
        "KeePass2-Portuguese_BR.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Russian.zip"
        "KeePass2-Serbian.zip::http://downloads.sourceforge.net/keepass/KeePass-2.23-Serbian.zip"
        "KeePass2-Slovak.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Slovak.zip"
        "KeePass2-Slovenian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Slovenian.zip"
        "KeePass2-Spanish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Spanish.zip"
        "KeePass2-Swedish.zip::http://downloads.sourceforge.net/keepass/KeePass-2.30-Swedish.zip"
        "KeePass2-Turkish.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Turkish.zip"
        "KeePass2-Ukrainian.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::http://downloads.sourceforge.net/keepass/KeePass-${pkgver}-Vietnamese.zip"
)
md5sums=('7e3c31cd76eea49fc0f7a2319c1fb07b'
         'da66d128e7e7d767fef64b9f4e151082'
         '36665841c495ccf1c7a84f3f329be381'
         'ac0f1e104f82d295c27646bfff39fecc'
         '26138bb070035de02e04f62ae592e1f3'
         '1d0672b626bc7ba577c5ef40471c6884'
         '0b9cbe0900be2dff566e275c3d9c5eb6'
         '6218837c8a292cba0ac1cd0bc6cec718'
         '77495b8b2dffcd733809e92ff7340bd6'
         '9ba6813596327e52f748c0558d1d2231'
         'f75703e8a0bb7f24ccfb3cb034efb6db'
         'b0b04ac412168cd8dbb33314af21e36c'
         'dc284751a01eb3e12e7d100e96deed7b'
         'ac52b41f19211e1d74ff5fe57445c925'
         'aae8f81171419f2d96cfad43645d875e'
         'b4129b1d4c37fa33d3804a17a7576fad'
         '95f1cddd1c3c1e73b2fa8673cf41b19b'
         '5de5de415f5d4948a2f132301e49e1a2'
         '845f89051aa856381a1479b17646d08c'
         '613e724cb9eedf8615c4ace7cc27aeca'
         'ffe83a2434f1b4c039a9ddfdc5d759ac'
         '8b0a0d045f368a1f09bd452dd7df72b5'
         '7483953e924df38ebf41464d0ba0ca13'
         '5e5d4c8acb1c8f43a15e4e5c3ce29eda'
         '31ecbdcb817c24a6725af7d101676b6a'
         '3172ba110fd730ca4c894f9e52f09930'
         'b993ca69e4ba65ab1b27de2f8f6c5793'
         '1bf960170782d7225bb9c0190eca008c'
         '4da2b3503c93e3eec4f22b0f55d75d4f'
         '1d14dda46ccb4f6c921055a58080f0fe'
         '4bd5a297d723c7a8dd61150fc3d80d5d'
         'e4b2091d66e182811d3af9bf6d189f31'
         'b22ea084d12a41ed956e76242de25d0d'
         'be787cbd5e00e2601af1b591aba16f30'
         '6fa05fc799bdf2b371ed6c15ceb9145c'
         '96b783595dad3ae1b79428074df8dc7d'
         'ec82420b8a3b326e135b81acdc2afb90'
         'f31f3605ec4650607289d978aa10d60e'
         '41a4418e42e51e421a08f673af62a715')
noextract=("KeePass2-TrlUtil.zip"
           "KeePass2-Portuguese_BR.zip" # bsdtar: Unsupported ZIP compression method (??); unzip: `LZMA' method not supported
)

prepare() {
    unzip -o "KeePass2-TrlUtil.zip" -d "TrlUtil"
    7z x -y -bd "KeePass2-Portuguese_BR.zip"
    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    # _lc *
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r *.{exe,exe.config,dll,lngx} "KeePass.config.xml" "TrlUtil" "XSL" "${a}"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    d="${pkgdir}/docs${_apparch}/${_realname}"
    mkdir -p "${d}"
    cp *.{chm,txt} "${d}"
}
