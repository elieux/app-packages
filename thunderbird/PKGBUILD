# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=45.4.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
sha512sums=('ae922ea93e852e190c099079960a0b7f1d2337f65ff2c078ec421d36e2b98d1fac8bf9e3fc173931d3d0ec58c173fdf62ca1804a56b7efe70e9a19bf8880c65c'
            'd77487e7fa03881f3ffe5afb7b0205d10dd0c6a42c99b7cac08be2d4ce4b4483008fa9f7529d0bba6dabe1ff9bb2596ae3e90df0605dfd6c242b08e2676d2926'
            '0b0e5ac97aafdbabfb970cd2bb72145ed8de617bf39e2eb9ce316d57377ff5d6d9374244045eacab2c859df4dbfe82f30700ecb2a43477b63d42888ce33a2a2b'
            'f06d2079f2c9ce4ff04cd638387dc70a96ef8bce5a34fbbabe50cb3a3d4cf9822b353c908312bec5c19e4864730825306998b604273572c3bb72003227af7b97'
            '180ceeb823d8e1c78867e297c5f7a95cd869a44f891f4ed4734d7412be71271dbd33987bb1dccf09fd0687fa74a010201e86818847a3984ad80b8b8aa42e548f'
            '95fd70b0b87fd1d6631a40e7378f9abf81fffdb80d613c5d9b354191464e0bfcf97c9655d470e13cc7f4fe5b2a202ad85be68758c887b254e0470b10e7303ff1'
            '7f84f8c94e86e9d81b565a1fc909f733bdc9edf2e67ba6f1c688e13b72c55f6a97195e4c694adaeaec8ff1c9f94325f6400b94fc12d2ab77c5f057387d45b62b'
            'a56d59b52f442ec88251f4dd68b610118202917968a3835f4a130549129ead7d6b3de9107249483792969caa3a51567f4d0c93fbc2dc799e660f5dbafff50dd9'
            'f288d4381639e90facf520476991e80f23275068d09fd744abe1144d0dd85f3e782f70ef6c06b88bab40f396e53c511267cf75da52b710851edb6709dbe9bc15'
            '661e632774a9dfa6565e47ebc11d9b7e0ee40f98e72a4efb1a048147b65668b6283c10f1e787447074b874ee3778dac8e0fbb2c40f4a692e11f569f57a0e4787'
            'a90417c57b54d1e57355d926146e352f80e282eb7ea683af2e92e1710cc2bceea8356cdc0b3e03b30586b2ac706d1e154d3731c5ccf10c6409f0d5121feee5f6'
            '57527daeb9a7bcc7e70b7a1410fdaa43a511d1b0685944483f4c2f11a8011d111424ecd1d35a2fee3460405bdbc11c9f624a9f1660aaa29d0f3bc703cc9910d4'
            'd24c49637254e4c0a731b0ac6aec68aaf0fce766b92bbbaa9be56b9f5196299a50eab20f0c600b1f2ce1b2113378aea6a2770d8eae8d26f6aca01a3ba47de134'
            '919f5e5c4e25aa1de47ff5bbd951ede4a02c7ffad5a31e6b6eac47eec575c5cf25fa843671bc09a8b4f4792b87b481db69459ee5f8da99c3cdb0a48e4f6fd7e8'
            '91859da711cd3572ac2cda97a7536996f3d8d8dffbfde3efb46480a95623defcb9263ded6161448a57d5bc14a2b56685cc8d44d846ce2ec5c150120c54b63e8c'
            '4cc2979d76dc59ddb5e02c556bd722788ad4f725aa72e56c429a75fab612f5d486ed01521c283b97d4fc06f29c12ff0c321e3a34e2d20294cc5861b83df8ac9d'
            '8f436a039dcd7983d695d76ebf8823b20d7298c92375ec90856e8daee6afa69a184dcf4c0747a1aee99ae8d5961600919a2b15bbbd1cd557e8f465fb59aa135f'
            '01b2bc78ba6a27fd0d812c9ed37c8c86e74ad08232550a6f03a915cfcaefc156d4da73d6363be09bd0569aa86ba05ab671ee39a101e7a71ba77ec4d824b72796'
            '4474385edfaed95581b68ca3cc514e2aad09e405a5f5ac1815ddd6e3c7643675e13ccde368011d13e6a2ef3cfa86d66f73762147a038e1dc4603c116ad1e51f6'
            '4cacafed1edac0c737d72f35b17b30a0fe3a4d207c8a52a8afe690222d87836044832716d6e26b475d2df8c522aa6e14c10e75661d0a8266384ce7e29ca0577a'
            'c691b6db71bb6715a297c0a1b44167e5ba4e5c8c847cf7de376f85ab9f05642c8fbd727e82a8afebb39b717cf13e4ee93222f0032a663fdfa4094df8797dfa41'
            '43b2e8f1c259df2e0a4680382cc740d5e7bff0129d261adcd90006d48ebcdafa6c1c68ce060fb18c24518c8f43219ade0051c6d4afc371a54753f79e42447630'
            '8b8306e0437cb2d2309dff988e009d8a8e8116c3bc02862bebc26e27204c08247a1eced6bfb054ca7628a9d621db9f8e54e3ce550884d8d0af14acc1b7c38319'
            '022b47356875c4050cb510ecb890377b8162ed19f9148d12f58656f95cb0ecd06fadc74342bac9582037bd1a1b7b9e20b67d735e516d71cb8a39d019f91f4b92'
            'b4f08ebb716be226a1fe515daac8a3c1f077c36abbdc04a9afcaf0aa1a295f508f77c10e2cc6acf7109df4601bc2ccdeee199e4c210154f567086288bae13e2a'
            'c8a14d5d07c87cf6b82dfd9b73c27368b88274793b8a8c95be2395a54549447f62a62a1e84a2e239434b5ce0355178323070b0080a698bec99389f104ae69610'
            'b30937ff94f11c4a74d61507f330eb1b3895d0a70666ceaca0820403fa7a5cb6431225277388f668de7c412da95f13c72568cda83d0db83a1b82787f7d693ce6'
            '19abd5f0fadf343b53a327a4527928db7c297b38b465a252ffc0b0e563b4c339c8fc7f12b035f14b7ddcec154ac71870020cf4855a37fcf429ef21a30609020b'
            '5a4ca6b1900cb321bafde6d5e5a6745b672d464d90f7d12aac2a22850c7403841519b22ea8fd73c932f908bff3cf970a8461ff73a1137523d79fd39fa6a0cb9a'
            '063654d543ee36aa52ff7fedc9b20fd4f6cfb98e6fadd7b3dce94a108db8e35497b96196499f9885c7e83291063fcbf4270ff708c254e0bcce30c563506b40a6'
            '068107c0bb300d8867286e8b5444f5780847bea22660858e67bdd13493092f01f6b6578946e8b7028e1bc42bdbb07560791c5554980f2e3f37650e60202a38d4'
            '6d5db5169b25d5c785b580fe62a372a16852d52e8616a1fa65f8b82d4aa210f24c1d5ed678c4b9643d944909e7948e7e1911b55dfa8017cd3de1f8c1a6d77176'
            '98108e137d47a156cf4a19906864b9770666d9013da41e3a14a846f3b35398623a3f699992d17f9346bb029f68b452a22a4f6b54adbf9ec3fe03cf56ab28fac2'
            '224c37c25b25755840076e6dcee338e0a2f8ad8751b8cb142a6573f258a60f18c53c64f7836d97364da9bd0d0810414401809d7765f8e6f47072f60bdb65f02e'
            '8c8fd8119f98cb9cb427911424dd5490bf6da69a437840766ac07ca138d33b1c37add18c61be0dfe382a04061fd92729b1acfe9de50b734867b34e4ce034eb57'
            'fede216dd5e4ab344589a56cc38ba4ab747ed8b37b3f289b740cbbfc1b3dca365155b24998da80789a0581da053ee97388f2659bfff16b6267a129dcdfc571d8'
            '12fd0e478df052655cb0f9a7ee842660348c70d57e8659f417e28b0a130d0cdbd8345002ad0c59d5a7bc12326c5b51712ead66a2148cd0ce17f3426c30410150'
            '62ee1bd831583a3022c6d15d9fa65d577c67733555db88990c0bb5b0ce084660e7a0396d53fb6e6d1430ce5bdb03cca77b978b5664a6006638b48ff1e17b8d4b'
            'd95034a78d447f2d3001f40b7d7562b084bf71bdd710028a3bb1d4ffc6ff169d29d3c1899f17addb7c6f7c81069e850616a84372128e87ba11eb47375d0a3866'
            'fdd7af72dc00371cac2df00a35de3518ac1a2544e59b02c790cfe8b1f5d2836446ba712e5282d5fd2ef5469088b35671f8745b89ae65c726f3edf0eba4a95155'
            'd826897a9643c0d4834faad923dbcebaa63bde9e3a01d3743fa5ef887ccef9328cbe12095d28667b74da63bdb77d2159ce214430921e1a7050b1b4561a3741ed'
            'b4d639baabcf725b34ac866b8c74931640da64eed973734c7dca5edf7e7c5298fb771bddc41c3ce6c427de3f2f0c41a04622fde582afb0e354eadd60bfc1c2ac'
            '504decf38176620c0836cf2049dd1266315413025ea7706873c3b625b0521002f15007f72df19752d6d3443b0cd04be532cbf9d958b202efa47b45321ad95efd'
            'a43af521dd077a27634ff2c5f8860a3dfa3a4e9063d523412169fd9507ead71fe3ff5be77c7c62a4316add42b35c59aabf3f80230045f6005f1e876871d9b32a'
            '56f7e85ff422d6dfde3c037b22775d3b5d596dac41562ee5584ddf468f2bdba62005690d1cf7cac5ea2744a88e1e8b3666974a4f15851f2080000e0a213f554d'
            '5d59ce867c0ee5bd18c05a228e425b7931c9132d73003c0202caa5f2ab8a3bda8a2dee5f772314e7f432347cc6f8e42a92251c891fce6abc52b02efc79125dd4'
            'c71a258c59da179711b29dcc79cbef0247ed2d20ef24b4c5170493fa77a925086f2f556b155f4efa56d47993a72ef41df368809008fe85e7cc89ebc26563c542'
            'f21f2df1ef9b1bd76a9c9d7db0e504f721c1552508b911eb90212b0ca6c1355742db746a3e65bdd537fe5b35c96ca3aa0884e50514f432daba9faf3b4543cdd3'
            'fd0467f70b05e0b159e7e0b442b94ca90d4d9fa2f6b39e0ce255526ac4067046faca7083f30786c3a6926753623fd934a52f6a99c8bd044f8b279b7545c610f9'
            '096726489efda113979adf906b2fc9c4264efceaff5f1f4976a2481712a7220a25e89bdf8c4cc38b97670f99da7bef5b3875ed12ff801a4faa4c3fe4b8ee7aca'
            'd78f81a5ef43ff0069b8f825cad92f05467eca8eb96f79dab15603dd90f737ad1f42ad0834ff841ae9ad1aa3290e29b213e83c4de00e12710f86cac0f4df8da8'
            '90850598261772c6991cf0e052ddb58c350a538deba1fd3dad1d91916014913044609c9737b2723d2125ad3c8f63f0c7dd4cf31e220c498db091868e3be695a5'
            '23dbb978720de4ac9f4e7fa11f2b3e7d0258f1c84122b0b1582bf107d6feb4b97cc445e5ab2142106978c23317e31d814be9180e1857704fe7ef6596c635143b'
            'f7ea504548a41797ded2c857af65569decdd02e40451e1df82bc2d755e175b88b8be644f74d1db905def4bad4d363d0352e866b99c561b65e610d304d2edebc5'
            'ea6b18656e28bbf8b285056c4373c5dd5816802934c81ccae1dd707f1a725ffe905a0e4d8eb3760ee787650a56341bd4c374c97a03824e8bf8ad3c81e88052e8'
            'd038f4105d0343130b579beb8dacf653b60f25bbd79a9a41bbc069f1bb633dc98dbe4dbd9e823cecb9eceb2a954294188373abd8a35ebabd44b903ede7bbb35d'
            'be0836f893f84e2cc8c129797304ff5b71ca10d618381f12f62d15e98b9d96ee77553b7da7bf550d696e8d3e7d85006467f8c84ea8a2627dad505d7d71d96761'
            'f41bcd2493de3f5c051f0414dfd98566f20a69ea14e6ec3f81c35c7e88002c5f108cf8a97cf32c3c61989c49902d3fd9d28d0e6fb7a2e794f1741d64f418d92a'
            '64d17cd691179a31659e63da73abc9b0a8c80e127c6fe7806bd163ea48f440cbecf1c6358845c4dcc57d1726d42b315bc0d0d9b5ff9fc91aef592775fabd6cbe')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
    sed -i '/MSVC[RP]120.dll/d' "core/dependentlibs.list"
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    rm "${a}"/msvc{p,r}120.dll "${a}"/maintenanceservice{.exe,_installer.exe}
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
