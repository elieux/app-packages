# Maintainer: David Macek <david.macek.0@gmail.com>

_realname=thunderbird
_apparch=32
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
pkgver=52.2.0
pkgrel=1
pkgdesc="Standalone, easy to customize mail/news reader"
url="http://www.mozilla.org/thunderbird/"
arch=('any')
license=('GPL' 'MPL')
makedepends=("p7zip")
provides=("${pkgbase}")
options=(!strip)
source=("ThunderbirdSetup.exe::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/en-US/Thunderbird%20Setup%20${pkgver}.exe"
        "ar.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ar.xpi"
        "ast.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ast.xpi"
        "be.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/be.xpi"
        "bg.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bg.xpi"
        "bn-BD.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/bn-BD.xpi"
        "br.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/br.xpi"
        "ca.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ca.xpi"
        "cs.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cs.xpi"
        "cy.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/cy.xpi"
        "da.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/da.xpi"
        "de.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/de.xpi"
        "dsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/dsb.xpi"
        "el.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/el.xpi"
        "en-GB.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-GB.xpi"
        "en-US.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/en-US.xpi"
        "es-AR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-AR.xpi"
        "es-ES.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/es-ES.xpi"
        "et.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/et.xpi"
        "eu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/eu.xpi"
        "fi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fi.xpi"
        "fr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fr.xpi"
        "fy-NL.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/fy-NL.xpi"
        "ga-IE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ga-IE.xpi"
        "gd.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gd.xpi"
        "gl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/gl.xpi"
        "he.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/he.xpi"
        "hr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hr.xpi"
        "hsb.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hsb.xpi"
        "hu.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hu.xpi"
        "hy-AM.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/hy-AM.xpi"
        "id.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/id.xpi"
        "is.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/is.xpi"
        "it.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/it.xpi"
        "ja.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ja.xpi"
        "kab.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/kab.xpi"
        "ko.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ko.xpi"
        "lt.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/lt.xpi"
        "nb-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nb-NO.xpi"
        "nl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nl.xpi"
        "nn-NO.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/nn-NO.xpi"
        "pa-IN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pa-IN.xpi"
        "pl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pl.xpi"
        "pt-BR.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-BR.xpi"
        "pt-PT.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/pt-PT.xpi"
        "rm.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/rm.xpi"
        "ro.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ro.xpi"
        "ru.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ru.xpi"
        "si.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/si.xpi"
        "sk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sk.xpi"
        "sl.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sl.xpi"
        "sq.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sq.xpi"
        "sr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sr.xpi"
        "sv-SE.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/sv-SE.xpi"
        "ta-LK.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/ta-LK.xpi"
        "tr.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/tr.xpi"
        "uk.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/uk.xpi"
        "vi.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/vi.xpi"
        "zh-CN.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-CN.xpi"
        "zh-TW.xpi::http://ftp.mozilla.org/pub/${_realname}/releases/${pkgver}/win32/xpi/zh-TW.xpi")
sha512sums=('79b73bbf21c8e11932f570c65058842f3f530a6c7c7dc40ef0a0ecfc9dc44e23883095f0a61de596d9aaf630b3718d34b6a7b1005c12a2268c7f66562b58c5e2'
            '1fe13012122c3f2db9a8b3b4bb60d2f10ffd56352ed4ac20dc15aa5bec912561b7b670d273efdbcd7fb0daeaf565801503aac88dbf4cc2c3de237884d9f7bc76'
            '2c6642d2455c57faadb42ff564d361ff7df32d19854ca6796e753e6b1de0fb29c966597fa3db0e6ea71b59056e150ec6dc34ce3238b45ba96ddad265a4af76a9'
            '93e44c15fd75e48f64f6a0378e31f910aca65287117d9b3d82326e67f02c17c060f8911ce3bd2c45a18f8702511e260819219dc88be113a0b82bdfa04f310c6b'
            '0c8c5708e21e14cc7c1471cf3e49a57c12945b4ee44f354cb5ae411ec3e0367d8dd14c74da4dfe1fd1f68f5d1eb6a9223213d6ff8496b8eff26c9a28b23875ee'
            'a20097fdf468158a8e279b393142ac9ab13827251d99561325f1eb7953551a088ae4e1b6157e368fc46f451b1aa32a7657d6e2200f25e92b9b68a6a290f431ed'
            '22ec255dbfc75bf2a24fc2675f4084ba61918959c49362137a3118bb4072560768e02dde4246c48bba294fd53d407b09c56258557fe7de26257a85c3420c5624'
            'ac1ead7ed27a5a8b768c1fbb3611359a205f3694a2f4b70c4d4bbc4b29e33fb35d4e017b7440245e874b3fc999d0b8982ade80e81bf76a58e10059fa68f63099'
            '4478595e51e8a9d75dcc82a7d8c036dd7f5f461b3eb0b71e1906b87ab9725e8f2632043a7946674d2ea7f87fbd0541dc70b3150098bc031de9691aa449d903c3'
            '188ea8d49611d699ae8c942442eafbd16c0ab6e69fb5e9583d629eeb1cb7821b68e2bc45a79d4e4be5f9f3247b034cfa0928618e3f396fd0b6178bae79bc41f4'
            '06b5c019f1bff1db873e4e585d5834ab4ca5584dd4b0cb0f8d97edd2c2b6e2883d71cfb52fb79a76a146ecdd6d81986f21d2265023f55ae8be9fa52f2bc29405'
            '04b00b520a7ac330e64da3b8d733126329669fa8b135c01a3303d0a775fcc77557722a8a7a57494c46a2e61bdbe9326a7b3a847e46d70868aec3064cddf1e218'
            '012b8f07bf98b22814218e7f0aa17e7eac023fc3f9a22ce375de3583467925ec84e636f7fdf59dfc5c2644c7187c9675fb9f38d24e727b0555041fce2233b138'
            'cb85b70f578c6fc5b2ba86ac6b8613227f44a47656fc729b09c02dcaa9e1a4418a4577666c0ec94f1b6f0bd03cd48c4bf1f602e644669b2fe5ac095e91740160'
            'e14d0d3c6ff0c02d1a61e34a9e9f12b8d9e9d9a8d38618b56906c1ddc5fad85906dc45e65949524797fcc178722d961b5f39efe3d8a4377de2dd3c0427627372'
            'd9ca6c5cb0edf0950b539ab8694cb6a846eacef6b523c941616fdc183dd4613b9a5a6d7fee9c33c1462c92a59f1e8a09e0658c61d01b28a1be64071ebb2e0a54'
            'c0781370ccfa7f86159ca2b3472a62e617ad7632e9ee24f1edf2ed6b7e56b91d6146e2e550ecfb00f279e01d0cd136005b642ee49d405fa1a260d7774acb2594'
            'f61cd2970ccc9424d27484bda192cc9dd8f203530f3dc5793422e6353a81d46549d1c10cdfbb3deef688ef5cf2abd9e71b98a1679c7ab64374e898db4939d80a'
            'b5cb48d123ea0d3c2a478d67cf43bae197194a6bf02494a0b3faec929b3cc95cd2434ee83fa4175d970c75e5efe13937b3f51e6ac2fda65ef4c6f11a898e034d'
            '9c5af4aff16e00872e001f542f21e42029c4d44080c662a1618dd221ce9feb6b2c24a62bee299412b42ecf38d227a41adbdcdf26d07fe360b985fc01d940ea4c'
            '429535f68db4131201c2f9fcb282a8ef601b375543ebe5e08317646ee67febde216e808bad589366be9943cb53dc17fa9eafaf65fc1e74c69af89d81696cfd28'
            '62bff3b3edf284eb85712c42c0455af302b4e2278ca56b3d108e804e117553495dde2b6df2b9fa8ceefa6560cbc7bb365430b945d5be2249d8ec32e7485ddd9e'
            '7009f54c05ac870e20eac7b62f1a39187a8d6667883e45579a89a7d390caa44d32eba54e9e48d3ef3a28ad741078e85cf88f5499287417bbd1fc89146d72916d'
            '5c95387126ab2dea0f4eec7b4ac827d5a6fa16efc93a3986780d73777142b677e6616a8b1882a18d8a8e247e2af37611f1f2f86fa855f927ca20688b527954ed'
            '1cb4a0d7cf5325b8a5a1768cddd88b5c4af8a58a68ea27c179a865897a8e0e3ba3cea9452f7ec87a52fa39d2279b062824e0397eeef190cb8c1d97d429b82795'
            '12822a565691ae1679dd282b62e6867ebc187f6d3ed341ea636fc547c8289b54a03794597877bbd691094a83f4369ce17a323e3a2867f0d31d86bad965f67b01'
            'b3066f1944058d1da90025022afe929597594e1a0ccf2998f7c0d88fc638fe17d3dc87761202020d1a5d1d880fb2b140070018a8f865d32fc14f5ff74a1ee4d5'
            'e311045ce599a113e1d3a74642ac84c54ac1f491b6bf3bae27d00679c440e55e699b434417c624a665aa4268a639f9f8208e3451130f136a24cca747b0f51391'
            '39be352961fa922afb57a6cb5079ad327b59556b1d5f20e168d20c8097230eeb7c768eca2878a440e30f1271763660bec1d191a11b64e9ba42f81ea8c324b50b'
            'f442c6c09ca0204fac6e9aee4e4729391069ce5be70f79ce96a98f75941c75124ea5a7747e50801545e1baeb1962aa1a2a2c7315b84c60024c2f0006559ac718'
            '5d70c4d27eb2b8d526d088e35c33076a1d79c619645d37e3c97ffe4ece7c3e1241ead012c62d72edf13f30f533e11e747050206e6b35f1d2705f4f11c6057f08'
            '7bed12ae0b148f9409483130ebffe467a014a820c9e2925ff086a279d4cfbada43fa2cfa2257e1140a4197244d2abbefde6e6be10c57de80558520d0a526f871'
            '41ec7ce488d2c6a308d9c54660428b9a0fcc538553e9748048efccbff6ab4b4e72c0b0bcf944798633d39139f489f0c4a93381f056328191326b02e7e8404b24'
            '37256546101d0e99742e283af22457bb9d2f170fea07ecbb1799d076e86a27ac43c298c8de4975a12a5c04cd665060d3f5b6d5b11d68cb46d7462a95e6b9e08e'
            '09ec3561cefba075116e19856f0627c1e6252b47b6af5923f2ba1ed5a223a894755dd35bd7cd0e81f6ed514e7a99263962aa565af747989ab006ac0e8ab9e931'
            'f103f84c73b7542a673b528d00694456a1059763abd79b8dbdab8430a4d4dc46910e90bb09962854cea9abb62c15e13d9299d14dc006b16f27cdeb3e17e0396a'
            'd639dafcffcc1d41339209492ed448cd46b10f47126d2134eebd5e9b69ee7694ffeb6e690598f0b9e91cb446fd730979b780940cd3f5be341923411a5ff4af41'
            '475934797245ebe806f158aa17c657069be11cd3770e327672ea6a72a56423f1178a002fb107a74788092186bcccfeeacf6f79382c97361af3d5ce171dc8e3aa'
            'd9c776f59cac6e0303fc7ca6e3a7e4c8b33ab68faaa2441d381354c541eb548ff03c517ce6753ed1777f84557a0ea49431bd31cd1ae23a2c34e570832ab7737b'
            '75fd6e90b84afe2d84b2e0f0d6e21c519a4029c1c6c05743802da917d9ebe081a7b8edced1cd3744fb496ed549c336638ac4c69a6ac376f10b9c81b045ca5014'
            'ef799a397aff9fd465a85046ecbab082aa332b7c34f41e4bb86a4cb687153c9ecd6035485b9455374556e71418c6ba57e573ccf428e8b0a63005733d8c1290b9'
            '7bd7dd825f01ffc910eb55474e9ed38c1cc128a687f2cab2e7c9f48cfaeb79cbacdd062325fee4a8a2957e5b35398960e087529eb55ed2660bc4390b89c8b988'
            '7e528e5b7ef8b18800895025a062ad882cab8165904a0295a7b3f97d74d315bad187858adc09f918cfe7cc9ff10b7697d02e7d45ef6fe80b22ecabf7e5225ecf'
            'ccf586026de025b5fdaa598d74862a2b21c72fc44fe7eabb4cc4813d5e374acd680b52a1c11e15d82e974e22b7abbe7e33f91b187c3a7ac90b9a90b4bf39afda'
            '86279837bbfeaa00ba90b1955d5629264cb06f4260f147ac2d342460b5509f2f26c4846ed30db63fd3fbc7f9d361765558d6dd8498c111f7f0044952253f0de8'
            '933c39ba2ab768fc4b05cfab5a9f6e58f398111f7466a47dcc33896aff75180c940c63bf418d596ec87e3f7a167e3de1d6246b7390a36b1da8cfec0610fdb4ec'
            '6fbf8221b22d848c02b51f90b1a4220b56dc8cfcbc0f135f6183884952ca48e3e461afcd9474e444ad2af7f37f12d8f5caa8b0d19850776769109b4a8559fdb6'
            '1a5f97a1de2857b03c72e21063260eab2edeee28e41063fd90ba40ee189ab0bb2450d6fa8cb0a24b591408ecc1ec4d66f812b85ef23ce32a948807632656954c'
            '52e14b61c0fd3dec15b076a9ecd06d69786eb2d4b24747543b749f1585a08c8bf2b12cd287dcb6f415c1e9043aab44fd350709dae12d5af776c78f599f09051a'
            '07b27b41cfc39de11a41b97b0d073b97b89dee26c70977ee710ae980b29afeaa29757fc8165a2fc6144ce111e2bce2216d8082c279514a69406644650c8a0cb9'
            '814d607297e27e0a95fb780d49d7ed0c6aa4c4fb48e8822626093b9b6066b59219083bd1c5c5f75b6d0e729ed791b00595a89007bac8b5827826da3031c5c730'
            '69d2f2ecad512869780ae3be4378452eccda78960706b6b61446fcda8dfb88ea49268039b9963459fa2a11a1536ecedadfe1226370022f1940ed6e3f725593c2'
            '121e9762151f4278e807162eb9f8a36bab33f770020c472d8f9056b2550a1c5299cc7b50f358f00b98e71a70e9c3a5c036d21162b171ed57f5c5a2e09094504e'
            'e753005e8db505e2313f3af39b690a456148607794b5bd68b3dce73ba90304b1a97e176ad454903537c7f82c45f0dada104ebb9bb1c876cb7a92b0222225c57d'
            '5e9cfab5b697d35e014a19f2b532438ba5039f92726a1b135de803b6ffedc87b4807c110c0ee5b59db3e62575a534c53461a1a8d61fdac22c5571222fb50c4f7'
            'b05c69d0f90d29105e48a82fbc990830f477bf014221f7a9e8413f4487a4310cca0c7087ac9531a074ca2f7120d28787ae85baf9047868193bc104901faddbf2'
            '544dc6e881e53b4118249c661629decd0cb3e16dc09f19fa96b097f3042a3bb4fcecf76932e80adac4fde59d7b4f8454812e11cd26cfa02743aba1f4aa0c77cc'
            '1e46c3294a59dc8e0543f5a4f8872330dbb419d4bddcd91e5cfd4852fd17d74672821c242b652b06c2606812978f7a1ae56edd90c75596f1c5a5b4b77954f697'
            '8381f039d3a5e552f507ff648e892da1056cdc800f15a1f6e75174cf9a69627d8839cedbf819d89e12a0417b4e3c5a0e63334f7258dcd05a636e1e9c32209d07'
            '7e43dba0e96ee9fa7a8f3ed57d581c5d7a18207f38f4b45b8b734bd01fbd5ae08c492cbd6464c158ea45225f70833829a76c7d08fd8645178d065c0b85b55536')
noextract=("${source[@]%%::*}")

_lc() {
    local d f n

    for f in "${@}"
    do
        d="$(dirname "${f}")"
        f="$(basename "${f}")"
        n="$(echo "${f}" | tr 'A-Z' 'a-z')"
        if test "${f}" != "${n}"
        then
            mv "${d}/${f}" "${d}/${n}"
        fi
    done
}

prepare() {
    7z x -y -bd "ThunderbirdSetup.exe"
    _lc "core"/*
}

package() {
    a="${pkgdir}/apps${_apparch}/${_realname}"
    mkdir -p "${a}"
    cp -r "core"/* "${a}"
    sed -ri -e '/(VCRUNTIME|MSVCP)140.dll/d' -e '/api-ms-win-[0-9a-z-]+.dll/d' "${a}/dependentlibs.list"
    rm "${a}"/api-ms-win-*.dll "${a}"/ucrtbase.dll "${a}"/{vcruntime,msvcp}140.dll "${a}"/maintenanceservice{,_installer}.exe
    for f in *.xpi
    do
        f="${f##*/}"
        f="${f%%.xpi}"
        cp "${f}.xpi" "${a}/extensions/langpack-${f}@thunderbird.mozilla.org.xpi"
    done
}
