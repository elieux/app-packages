# Maintainer: David Macek <david.macek.0@gmail.com>

_extract_subdir() {
    local _file="$(get_filename "${1}")"
    local _dir="${_file%.*}"
    if type bsdtar | head -1 | grep -q 'is a function'
    then
        local _original_bsdtar="$(type bsdtar | tail +2)"
    fi
    bsdtar() {
        local _extra_args=()
        if [ "${1}" = "-xf" ]
        then
            mkdir -p "${_dir}"
            _extra_args=(-C "${_dir}")
        fi
        /usr/bin/bsdtar "${_extra_args[@]}" "${@}"
    }
    extract_file "${_file}"
    unset -f bsdtar
    eval "${_original_bsdtar}"
}

download_https@subdir() {
    download_file "${1/@subdir:/:}"
}

extract_https@subdir() {
    _extract_subdir "${@}"
}

_realname=keepass
_choconame=keepass
pkgbase="app-${_realname}"
pkgname=("app-i686-${_realname}")
epoch=1
pkgver=2.47
pkgrel=2
pkgdesc="Light-weight and easy-to-use password manager"
url="https://keepass.info/"
arch=('any')
license=('GPL2')
provides=("${pkgbase}")
options=(!strip)
source=("KeePass2.zip::https@subdir://downloads.sourceforge.net/keepass/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip"
        "TrlUtil.zip::https@subdir://keepass.info/download/v2_trlutil_2/TrlUtil-2.48.zip"
        "KPScript.zip::https@subdir://keepass.info/extensions/v2/kpscript/KPScript-${pkgver}.zip"
        "KeePass.config.xml"
        "KeePass2-Arabic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.39-Arabic.zip"
        "KeePass2-Basque.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Basque.zip"
        "KeePass2-Bulgarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Bulgarian.zip"
        "KeePass2-Burmese.zip::https://downloads.sourceforge.net/keepass/Burmese-2.19.zip"
        "KeePass2-Catalan.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Catalan.zip"
        "KeePass2-Chinese_Simplified.zip::https://downloads.sourceforge.net/keepass/KeePass-2.46-Chinese_Simplified.zip"
        "KeePass2-Chinese_Traditional.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Chinese_Traditional.zip"
        "KeePass2-Croatian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Croatian.zip"
        "KeePass2-Czech.zip::https://downloads.sourceforge.net/keepass/KeePass-2.44-Czech.zip"
        "KeePass2-Danish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Danish.zip"
        "KeePass2-Dutch.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Dutch.zip"
        "KeePass2-Estonian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.38-Estonian.zip"
        "KeePass2-Finnish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Finnish.zip"
        "KeePass2-French-c.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-French-c.zip"
        "KeePass2-German.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-German.zip"
        "KeePass2-Greek.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Greek.zip"
        "KeePass2-Hebrew-b.zip::https://downloads.sourceforge.net/keepass/KeePass-2.35-Hebrew-b.zip"
        "KeePass2-Hungarian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Hungarian.zip"
        "KeePass2-Icelandic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.45-Icelandic.zip"
        "KeePass2-Indonesian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.23-Indonesian.zip"
        "KeePass2-Italian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Italian.zip"
        "KeePass2-Japanese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Japanese.zip"
        "KeePass2-Korean.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Korean.zip"
        "KeePass2-Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Latin.zip"
        "KeePass2-Latvian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.46-Latvian.zip"
        "KeePass2-Lithuanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.46-Lithuanian.zip"
        "KeePass2-Norwegian_NB.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Norwegian_NB.zip"
        "KeePass2-Pashto.zip::https://downloads.sourceforge.net/keepass/KeePass-2.29-Pashto.zip"
        "KeePass2-Persian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.41-Persian.zip"
        "KeePass2-Polish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Polish.zip"
        "KeePass2-Portuguese_BR.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Portuguese_BR.zip"
        "KeePass2-Portuguese_PT.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Portuguese_PT.zip"
        "KeePass2-Romanian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.22-Romanian.zip"
        "KeePass2-Russian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Russian.zip"
        "KeePass2-Serbian_Cyrillic.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Serbian_Cyrillic.zip"
        "KeePass2-Serbian_Latin.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Serbian_Latin.zip"
        "KeePass2-Slovak.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Slovak.zip"
        "KeePass2-Slovenian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.37-Slovenian.zip"
        "KeePass2-Spanish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Spanish.zip"
        "KeePass2-Swedish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.43-Swedish.zip"
        "KeePass2-Thai.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Thai.zip"
        "KeePass2-Turkish.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Turkish.zip"
        "KeePass2-Ukrainian.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Ukrainian.zip"
        "KeePass2-Vietnamese.zip::https://downloads.sourceforge.net/keepass/KeePass-2.47-Vietnamese.zip")
sha512sums=('67b47ae1679a882dabdfa770dc4cf7502c6383a1b4c2c4f45d3d056be35777ec79c1e58ae19cea148d7769d8962cc55262035ad6a8ddcefbbfd87a85454f1121'
            '58d2460328cfc2c34cf6dd68520c296a4b65b198e3716ffd05a03bf7572ce8f5cb36d2c88354a3a90617a0871ecb6d74ec80cb38c8cbc2a17fe994fc63d5123b'
            '726e8b3d2c8086db161bc94f117e174a1fdff39f900114e2513218c6b1b4574f27767dfeee97325028e69aa9d09935fa1c37f8edf6d2e7b30186dd868f05d33d'
            'be3675bbbe47d929a1ca6c5dfefd31b674c7304cc4bfac914d5be9656937554919478feb363fd3a51561bcf879941fcb54b701648057422c452bf677d500a839'
            '44eacfbbdf36938f992876689a447ce72a8f6e0cd8af84315ccb40fe86d4a76203a61a24edf58dad39a857366628ea5cb6cc84f2f5897ced12e89da18180d02d'
            '5f1aa21c1a9012b960c010409fe311bf38c86dfd83bf3f2b51638d00bc651cb75d803da01fcfa7e60b0496c986306bd752f76904549a3d6e2420fb5f6262f788'
            'ad99927810cf2321c9bb8f78e71d67048b102b9d711b2b29f87d12502f9ddb873c0e8fd63153c8007d96bae719704cca79957c60f7b04b115de2ebb84b72fa67'
            '8548df07918d101548e828e038bda9c593f909f17cd11cb568c987094b19ed66306f79e3e58d3128a3aeef20deb7061f9c1f1fc001e28aef355b42ec75a519d2'
            '79245c374a49db0c7816c71200fba690a30d4bfd29bc96090bfc1d51f19fb384e6fdaf8487bdc0ae078c1077e735a2539192ddee07c4c12707719ab377431fee'
            'f2d859d386f16c3cbb450d02efc88434a485d77bef5b89249635e073b16b1294d8ab007f4f8cd6a904bd07b7d72b4c03084e3120c6a2be63722268735f872d1c'
            '04fdd482f0ba38d25c876abdde746c1bd8b861db733c785362ee1a05a8ac7da700e8b0169a745147fef35f86b42e509b4bf6f12767441de99d893c7d8a486f3f'
            'a3584859709ef51bbf68f1703eb82178686d1694bdbf1a8ad992f6023bcfe67269313e1279e75c5450b59e693037dd93ab87285c8f43cb60e2dcd75bfc216020'
            'f0e38f8fb1a82ccb41b64042107814f9ec9774b7028f9003ab293fea8847e1b507ce120053905e1bccf79d6a4eaaa2aa8cb6bfe392db8071d700f3dd339992ad'
            '21bda17b2e01f2cd42740ec10b28ccf073a56d2c462de0e07634ad1ca3facdfba737750811f1fafb69b2e38d180dd29aa46fdf4f71065e5e80d7cb80af014530'
            'a348db40e6501becf39e34d87b483d5146829a0df475ee9979bee5c6566d584e6d460a1dfa86a923418590f5b630a75ffc4c9d608eb578d35407518d2fb040aa'
            '2ef568588a24db4777969f35afd5e803989ae4814bbda6c7fcb674c0b40791ba43dbbce3613f05324d7855c519642e10d7f14397fea7bc95b1b208afc1a62648'
            '6743f738dde8aa2ec2ed96babd3a0c635f14c6e8b2bd7deef8e2af00df7cd32ccdd61021c194379390e52d79ccf79384063539427b9cb9b9f7f691484ea5d1de'
            '2ff8da06c586330f532c08fbd93c4e4f1a3042a4b123a9b2bffe48298366b202dcd4ca14cd84e4ee1c2e3a4fbb9bc0ce39e3db4c64bf5d2f39690b96788b002a'
            '1c9f2f81d3f461acee272626a39ab0e4fbd58f77716cbfabf6fae2fedf0ad0e6efaf0e6b368b1b2ac3407e8d88ffe1d492beb6eb33334e07b813833775e7e775'
            'b67173ff5b7484fe9a63c1f33fcbd75a7674a3a902e699df3035387b75f914f82d22f363d0a1132e39971ac048b7a436b9f08fed03f78a0f8a75fd71e7effc4d'
            '6330ec5779b877b702badfb813cfb28c32b6bbbe4f6271586f39a7f166eeb10228c31af0d5e4d98e7c0f8de48525d4756663d562f184ff79b2ce8c91dc2bfc9d'
            '585e05adddc83bd02c6a5a36670a0b851c4c7a9d4410bf8c2ba7443e6dc2b142bbd362287fcdaf26a92233ec91c6d32db19087751b0a704036befcf2121958a0'
            '3392ffd64a3df314f04474ec25d2aa0d83d8916e4e3ef2529e7a42ec8ab6384384a0c246865a2b97ffcd69579fd3cd9c5b40a20b9cd365b727ac0775b12a5a72'
            'fc4926c62a7fa7bed1394535b7245b7abe3ac33af5f3e06bb6358dbf62fcfb967e4528f85043351ee1e030960627abc74afb8f6b145c6bf3ce56f81691ba18fb'
            '0e8d114739b3afacf50576cdddb06a9d897e026217ca52768228285e6dca55ff94e07327ded75c50983129e103f28b03eceea49a3110c978f8eea597eec2835c'
            'f0ecf638ecefe50f1b66d1228856369557a846848dd95143ff1599c33af06f9b21803b829cf4b6b859eb13e006369f1ab065c6dd8c1e31455cc140fb42285ba7'
            'f45b53bef1ca4573d51026a6ce2419df1a7f3a4ecbedb9a8d3c5d2b9f575a12d666613b16bbb9d855749a2212ddd6622c6159af76d33241c57a01028feae6a8a'
            'af80a6a57248c14ef710fdfac05531d42fe937105e62c15de4ecf16185e998b2c8719b4b32e1eb4bf1fc0b7cb577f97565a94d20778efd5ab65b59c5baddb3c2'
            'e46f0379faac861dc6da511493b14b2e9ead26b7a3630039ad2fdd6d3dfdf8969d571cbb9cad1e4e20501d1e556a2adb7f285906dbf591f78cbd0d2cb1f6fb7c'
            'cd5e00e59b0d681f1b80c20734ec06ef9d317320cb56425ad2dfc55c4263c4bb16def97a2c4c7761079153abf8760dc32335a5bf26800431bc099e27b9c9d022'
            '06f4ea7e8f8443260d9a33ffacddf6d083f0d0e899dd440d206ec069e2c82ea67f7d12dd8fd3b852ef05c4d94e21e42a84f891353944ebdaaf566148f05ce560'
            '17c185bbc43090d4d22e137441e97c868c4cd6417d120bc72509b008a85a8b0eab0ca0b4e4f7f3e8030b01dc0b5e126f2d71108f176bfef59133e43b651b093a'
            '5605b97a6110b7d362f8c35f2a145ec458f09f1605aa99a8115da41a042d26805caa211515504725eeaacd13182cf71d05827dd8a62594fb2860ce98d0b71ca2'
            '192a68b4a0ded3edf2d906a023eb1e907e67819ca5f63e4d0314dba02758fca6dc964225cfeac60cd423e35da6b1057740c3e5ae0179e446da62ddd982255e43'
            '57f2aa7369fa4a722f6aa0fc00d0e263b953a1d23620d9ab8899952df2081161d1a9392b854cbaa74f641d8cbed5b489994bc5f2aac2efc163301bbcb72f7bb8'
            '8002b6aa4a7c473daf466f7c5d75300b99faccb9115d2819847d52906cd69985107d00f18e82ee6dce58a947e6d27f55f3648bbff8aa07a0ef6460aadc031799'
            'c5b393380b0ddbfe22ab48c4175d963a1d0e730afbf1835696708cf542ca30ead26b65d42628cb0b8fcb54ed1a545177ecb4720c21a2f86d8af4b0f3f2bc81e9'
            'ddf27946fb2195e6ae414d021b69ceb22b96bc8fd86fb22bbec395af7f3691e15a48cda69ec57349d3705812adf50d7801d86235084c668ca6155374f239c2c4'
            '1a9e4bc01065600e1bfe93cd457566a849e13a5f3c8b7871540272d3d18dee52694175220118d432d033e1e6114f098b603dc7ebab85583875ee65ffdbcc9852'
            'fb25c2b0aaf571ec6461abd8cd4e44ed38cdcc741df15a55e4c1e4638d3cfaabbdaf50c98f904296910fcc25a809c11220b51dd9f6f16a725fda4380312cad9e'
            'f47bf3eb3d028ffb40b88ba1816913b0c168f5078ccf5be854a5409232512aedec0052d46af8ccaba01ff434500460b634acccc7d05cd2d54b33e7819c875b9d'
            '1140d20e4ae6debb6a6ee39ebfb89d66089e893704b4a7969b36ff5977e8b9467e255e6017ea5874a6abbad4ae058339a0f96a08f07942ebec91f1a4b6f84d28'
            'dff1b0b3da66ffe97bc0d31fb874c702e902ed53f837cb937f511bf116ab8ffdbb89950d72de32545429e90779b56f29b42f426ffa44687d7de0f625d6cb908d'
            '98ea2f0f70fd7afa3ba61aca881c941ed1739baae438cba05d759876ad008071fc47d415e62b0d33aac86475508148cf29913d0102d3d139c871335130acee83'
            'bf314693b0f31f05575387c536719643a9ab2f7154ee85ab1faabe8e8bdb1760e6cd72a054fe27d8c5916a9fb0c4f0c73de9f4bea1877308f9e29a1b8c2076f6'
            'fa86b74bb22022b9457ebfbe221df22e4c80d0d243150a1897eefc20cbb12f31e03ecd7b35da382e0b7661666294047791da058b82006553713862d4719aed96'
            '10eb7d40117ab4765fdf7ca4cd78c346daeeba17bcd4f4d5c391bd685e5c80663d01aa97820a7e8f9cebbabfc060ca5278208e2ee507e15603bed382bc77d48b'
            'a3dabb2987c78ccba6f6f6157b2e74227147f38b3ef4b1831383d5e692ccd5efc1f0d01ebface6508242bf4f1a23a5fae04e9c76d46db670aee17127e67cd5c7')

package() {
    local a="${pkgdir}/apps/${_realname}"
    mkdir -p "${a}"
    cp -R "KeePass2"/* "KPScript"/* "TrlUtil" "KeePass.config.xml" "${a}"
    cp *.lngx "${a}/Languages"
    cp "KeePass.config.xml" "${a}/TrlUtil"

    # when KPScript.exe is lowercased, it fails to load, so let's just keep everything as is
    #_lc "${a}"/*
}
